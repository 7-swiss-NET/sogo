{"version":3,"sources":["Contacts/Contacts.app.js","Contacts/AddressBookController.js","Contacts/AddressBooksController.js","Contacts/CardController.js","Contacts/sgAddress.directive.js"],"names":["configure","$stateProvider","$urlRouterProvider","state","url","abstract","views","addressbooks","templateUrl","controller","controllerAs","resolve","stateAddressbooks","addressbook","stateAddressbook","card","stateCard","stateNewCard","template","onEnter","onEnterCard","onExit","onExitCard","card@app.addressbook","otherwise","AddressBook","$findAll","window","contactFolders","$q","$state","$stateParams","_","find","id","addressbookId","selectedCard","$reload","reject","Card","tag","contactType","pid","c_component","$cards","cardObject","cardId","go","stateMailbox","runBlock","$rootScope","$log","$on","event","toState","toParams","fromState","fromParams","error","current","previous","rejection","angular","module","config","run","$inject","AddressBookController","$scope","$window","$timeout","$mdDialog","$mdToast","Account","Dialog","Settings","sgHotkeys","_registerHotkeys","keys","push","createHotkey","key","l","description","callback","bind","vm","newComponent","toggleCardSelection","_nextCard","_previousCard","_addNextCardToSelection","_addPreviousCardToSelection","confirmDeleteSelectedCards","forEach","registerHotkey","selectCard","$event","selectedFolder","$selectedCard","selected","mode","multiple","preventDefault","stopPropagation","type","unselectCards","index","$selectedCardIndex","isDefined","length","$topIndex","hasSelectedCard","selectedCards","$selectedCards","size","confirm","ok","then","$deleteCards","_selectedCardsOperation","operation","dstId","srcFolder","allCards","cards","ids","clearCardView","promise","success","filter","$isCard","show","simple","content","position","hideDelay","$copyCards","$moveCards","map","indexOf","copySelectedCards","folder","moveSelectedCards","selectAll","sort","field","$filter","sortedBy","$query","cancelSearch","search","newMessage","recipients","accounts","account","o","$getMailboxes","mailboxes","$newMessage","message","extend","editable","to","parent","element","document","body","targetEvent","clickOutsideToClose","escapeToClose","locals","stateAccount","stateMessage","newMessageWithRecipient","recipient","fn","newMessageWithSelectedCards","promises","$isList","expandable","refs","ref","email","$shortFormat","c_mail","all","uniq","this","hotkeys","service","deregisterHotkey","AddressBooksController","$mdMedia","$mdSidenav","FileUploader","sgConstant","focus","User","confirmDelete","select","params","editMode","value","close","newAddressbook","prompt","name","isEditable","isRemote","owner","UserLogin","$add","edit","originalAddressbook","$omit","revertEditing","save","$rename","data","status","alert","isSubscription","$delete","catch","response","statusText","importCards","CardsImportDialogController","scope","filterByExtension","item","isTextFile","test","join","uploader","ApplicationBaseURL","autoUpload","queueLimit","filters","onSuccessItem","headers","msg","hide","imported","onErrorItem","showLinks","LinksDialogController","showProperties","PropertiesDialogController","srcAddressBook","saveProperties","$save","init","cancel","share","$acl","$users","usersWithACL","users","subscribeToFolder","addressbookData","console","debug","$subscribe","isDroppableFolder","dstFolder","isOwned","acls","objectCreator","dragSelectedCards","activeUser","CardController","currentFolder","$selectedCount","transformCategory","input","isString","addOrgUnit","i","$addOrgUnit","addBirthday","birthday","Date","addScreenName","$addScreenName","addEmail","$addEmail","addPhone","$addPhone","addUrl","$addUrl","addAddress","$addAddress","userFilter","excludedCards","dry","excludeLists","$$cards","form","$valid","copy","reset","$reset","isNew","$fullname","toggleRawSource","showRawSource","rawSource","$$resource","post","allEmailTypes","$EMAIL_TYPES","allTelTypes","$TEL_TYPES","allUrlTypes","$URL_TYPES","allAddressTypes","$ADDRESS_TYPES","categories","userFilterResults","sgAddress","restrict","addressLines","lines","locality_region","street","street2","locality","region","country","postalcode","directive"],"mappings":"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","file":"Contacts.js","sourcesContent":["/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n/* JavaScript for SOGoContacts */\n\n(function() {\n  'use strict';\n\n  angular.module('SOGo.ContactsUI', ['ngCookies', 'ui.router', 'angularFileUpload', 'ck', 'SOGo.Common', 'SOGo.PreferencesUI', 'SOGo.MailerUI'])\n    .config(configure)\n    .run(runBlock);\n\n  /**\n   * @ngInject\n   */\n  configure.$inject = ['$stateProvider', '$urlRouterProvider'];\n  function configure($stateProvider, $urlRouterProvider) {\n    $stateProvider\n      .state('app', {\n        url: '/addressbooks',\n        abstract: true,\n        views: {\n          addressbooks: {\n            templateUrl: 'UIxContactFoldersView', // UI/Templates/Contacts/UIxContactFoldersView.wox\n            controller: 'AddressBooksController',\n            controllerAs: 'app'\n          }\n        },\n        resolve: {\n          stateAddressbooks: stateAddressbooks\n        }\n      })\n      .state('app.addressbook', {\n        url: '/:addressbookId',\n        views: {\n          addressbook: {\n            templateUrl: 'addressbook',\n            controller: 'AddressBookController',\n            controllerAs: 'addressbook'\n          }\n        },\n        resolve: {\n          stateAddressbook: stateAddressbook\n        }\n      })\n      .state('app.addressbook.new', {\n        url: '/{contactType:(?:card|list)}/new',\n        views: {\n          card: {\n            templateUrl: 'UIxContactEditorTemplate', // UI/Templates/Contacts/UIxContactEditorTemplate.wox\n            controller: 'CardController',\n            controllerAs: 'editor'\n          }\n        },\n        resolve: {\n          stateCard: stateNewCard\n        }\n      })\n      .state('app.addressbook.card', {\n        url: '/:cardId',\n        abstract: true,\n        views: {\n          card: {\n            template: '<ui-view/>'\n          }\n        },\n        resolve: {\n          stateCard: stateCard\n        },\n        onEnter: onEnterCard,\n        onExit: onExitCard\n      })\n      .state('app.addressbook.card.view', {\n        url: '/view',\n        views: {\n          'card@app.addressbook': {\n            templateUrl: 'UIxContactViewTemplate', // UI/Templates/Contacts/UIxContactViewTemplate.wox\n            controller: 'CardController',\n            controllerAs: 'editor'\n          }\n        }\n      })\n      .state('app.addressbook.card.editor', {\n        url: '/edit',\n        views: {\n          'card@app.addressbook': {\n            templateUrl: 'UIxContactEditorTemplate', // UI/Templates/Contacts/UIxContactEditorTemplate.wox\n            controller: 'CardController',\n            controllerAs: 'editor'\n          }\n        }\n      });\n\n    // if none of the above states are matched, use this as the fallback\n    $urlRouterProvider.otherwise('/addressbooks/personal');\n  }\n\n  /**\n   * @ngInject\n   */\n  stateAddressbooks.$inject = ['AddressBook'];\n  function stateAddressbooks(AddressBook) {\n    return AddressBook.$findAll(window.contactFolders);\n  }\n\n  /**\n   * @ngInject\n   */\n  stateAddressbook.$inject = ['$q', '$state', '$stateParams', 'AddressBook'];\n  function stateAddressbook($q, $state, $stateParams, AddressBook) {\n    var addressbook = _.find(AddressBook.$findAll(), function(addressbook) {\n      return addressbook.id == $stateParams.addressbookId;\n    });\n    if (addressbook) {\n      delete addressbook.selectedCard;\n      addressbook.$reload();\n      return addressbook;\n    }\n    return $q.reject('Addressbook ' + $stateParams.addressbookId + ' not found');\n  }\n\n  /**\n   * @ngInject\n   */\n  stateNewCard.$inject = ['$stateParams', 'stateAddressbook', 'Card'];\n  function stateNewCard($stateParams, stateAddressbook, Card) {\n    var tag = 'v' + $stateParams.contactType,\n        card = new Card({ pid: $stateParams.addressbookId, c_component: tag });\n    stateAddressbook.selectedCard = true;\n    return card;\n  }\n\n  /**\n   * @ngInject\n   */\n  stateCard.$inject = ['$state', '$stateParams', 'stateAddressbook'];\n  function stateCard($state, $stateParams, stateAddressbook) {\n    var card;\n\n    card = _.find(stateAddressbook.$cards, function(cardObject) {\n      return (cardObject.id == $stateParams.cardId);\n    });\n\n    if (card) {\n      return card.$reload();\n    }\n    else {\n      // Card not found\n      $state.go('app.addressbook');\n    }\n  }\n\n  /**\n   * @ngInject\n   */\n  onEnterCard.$inject = ['$stateParams', 'stateAddressbook'];\n  function onEnterCard($stateParams, stateAddressbook) {\n    stateAddressbook.selectedCard = $stateParams.cardId;\n  }\n\n  /**\n   * @ngInject\n   */\n  onExitCard.$inject = ['stateAddressbook'];\n  function onExitCard(stateMailbox) {\n    delete stateAddressbook.selectedCard;\n  }\n\n  /**\n   * @ngInject\n   */\n  runBlock.$inject = ['$rootScope', '$log', '$state'];\n  function runBlock($rootScope, $log, $state) {\n    $rootScope.$on('$stateChangeError', function(event, toState, toParams, fromState, fromParams, error) {\n      $log.error(error);\n      $state.go('app.addressbook', { addressbookId: 'personal' });\n    });\n    $rootScope.$on('$routeChangeError', function(event, current, previous, rejection) {\n      $log.error(event, current, previous, rejection);\n    });\n  }\n\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * @ngInject\n   */\n  AddressBookController.$inject = ['$scope', '$q', '$window', '$state', '$timeout', '$mdDialog', '$mdToast', 'Account', 'Card', 'AddressBook', 'Dialog', 'sgSettings', 'sgHotkeys', 'stateAddressbooks', 'stateAddressbook'];\n  function AddressBookController($scope, $q, $window, $state, $timeout, $mdDialog, $mdToast, Account, Card, AddressBook, Dialog, Settings, sgHotkeys, stateAddressbooks, stateAddressbook) {\n    var vm = this, hotkeys = [];\n\n    AddressBook.selectedFolder = stateAddressbook;\n\n    vm.service = AddressBook;\n    vm.selectedFolder = stateAddressbook;\n    vm.selectCard = selectCard;\n    vm.toggleCardSelection = toggleCardSelection;\n    vm.newComponent = newComponent;\n    vm.unselectCards = unselectCards;\n    vm.confirmDeleteSelectedCards = confirmDeleteSelectedCards;\n    vm.copySelectedCards = copySelectedCards;\n    vm.moveSelectedCards = moveSelectedCards;\n    vm.selectAll = selectAll;\n    vm.sort = sort;\n    vm.sortedBy = sortedBy;\n    vm.cancelSearch = cancelSearch;\n    vm.newMessage = newMessage;\n    vm.newMessageWithSelectedCards = newMessageWithSelectedCards;\n    vm.newMessageWithRecipient = newMessageWithRecipient;\n    vm.mode = { search: false, multiple: 0 };\n\n\n    _registerHotkeys(hotkeys);\n\n    $scope.$on('$destroy', function() {\n      // Deregister hotkeys\n      _.forEach(hotkeys, function(key) {\n        sgHotkeys.deregisterHotkey(key);\n      });\n    });\n\n\n    function _registerHotkeys(keys) {\n      keys.push(sgHotkeys.createHotkey({\n        key: l('key_create_card'),\n        description: l('Create a new address book card'),\n        callback: angular.bind(vm, newComponent, 'card')\n      }));\n      keys.push(sgHotkeys.createHotkey({\n        key: l('key_create_list'),\n        description: l('Create a new list'),\n        callback: angular.bind(vm, newComponent, 'list')\n      }));\n      keys.push(sgHotkeys.createHotkey({\n        key: 'space',\n        description: l('Toggle item'),\n        callback: toggleCardSelection\n      }));\n      keys.push(sgHotkeys.createHotkey({\n        key: 'up',\n        description: l('View next item'),\n        callback: _nextCard\n      }));\n      keys.push(sgHotkeys.createHotkey({\n        key: 'down',\n        description: l('View previous item'),\n        callback: _previousCard\n      }));\n      keys.push(sgHotkeys.createHotkey({\n        key: 'shift+up',\n        description: l('Add next item to selection'),\n        callback: _addNextCardToSelection\n      }));\n      keys.push(sgHotkeys.createHotkey({\n        key: 'shift+down',\n        description: l('Add previous item to selection'),\n        callback: _addPreviousCardToSelection\n      }));\n      keys.push(sgHotkeys.createHotkey({\n        key: 'backspace',\n        description: l('Delete selected card or address book'),\n        callback: confirmDeleteSelectedCards\n      }));\n\n      // Register the hotkeys\n      _.forEach(keys, function(key) {\n        sgHotkeys.registerHotkey(key);\n      });\n    }\n\n    function selectCard(card) {\n      $state.go('app.addressbook.card.view', {cardId: card.id});\n    }\n\n    function toggleCardSelection($event, card) {\n      if (!card) card = vm.selectedFolder.$selectedCard();\n      card.selected = !card.selected;\n      vm.mode.multiple += card.selected? 1 : -1;\n      $event.preventDefault();\n      $event.stopPropagation();\n    }\n\n    function newComponent(type) {\n      $state.go('app.addressbook.new', { contactType: type });\n    }\n\n    function unselectCards() {\n      _.forEach(vm.selectedFolder.$cards, function(card) {\n        card.selected = false;\n      });\n      vm.mode.multiple = 0;\n    }\n\n    /**\n     * User has pressed up arrow key\n     */\n    function _nextCard($event) {\n      var index = vm.selectedFolder.$selectedCardIndex();\n\n      if (angular.isDefined(index))\n        index--;\n      else\n        // No message is selected, show oldest message\n        index = vm.selectedFolder.$cards.length() - 1;\n\n      if (index > -1)\n        selectCard(vm.selectedFolder.$cards[index]);\n\n      if (vm.selectedFolder.$topIndex > 0)\n        vm.selectedFolder.$topIndex--;\n\n      $event.preventDefault();\n\n      return index;\n    }\n\n    /**\n     * User has pressed the down arrow key\n     */\n    function _previousCard($event) {\n      var index = vm.selectedFolder.$selectedCardIndex();\n\n      if (angular.isDefined(index))\n        index++;\n      else\n        // No message is selected, show newest\n        index = 0;\n\n      if (index < vm.selectedFolder.$cards.length)\n        selectCard(vm.selectedFolder.$cards[index]);\n      else\n        index = -1;\n\n      if (vm.selectedFolder.$topIndex < vm.selectedFolder.$cards.length)\n        vm.selectedFolder.$topIndex++;\n\n      $event.preventDefault();\n\n      return index;\n    }\n\n    function _addNextCardToSelection($event) {\n      var index;\n\n      if (vm.selectedFolder.hasSelectedCard()) {\n        index = _nextCard($event);\n        if (index >= 0)\n          toggleCardSelection($event, vm.selectedFolder.$cards[index]);\n      }\n    }\n\n    function _addPreviousCardToSelection($event) {\n      var index;\n\n      if (vm.selectedFolder.hasSelectedCard()) {\n        index = _previousCard($event);\n        if (index >= 0)\n          toggleCardSelection($event, vm.selectedFolder.$cards[index]);\n      }\n    }\n\n    function confirmDeleteSelectedCards($event) {\n      var selectedCards = vm.selectedFolder.$selectedCards();\n\n      if (_.size(selectedCards) > 0)\n        Dialog.confirm(l('Warning'),\n                       l('Are you sure you want to delete the selected contacts?'),\n                       { ok: l('Delete') })\n        .then(function() {\n          // User confirmed the deletion\n          vm.selectedFolder.$deleteCards(selectedCards).then(function() {\n            vm.mode.multiple = 0;\n            if (!vm.selectedFolder.selectedCard)\n              $state.go('app.addressbook');\n          });\n        });\n\n      $event.preventDefault();\n    }\n\n    /**\n     * @see AddressBooksController.dragSelectedCards\n     */\n    function _selectedCardsOperation(operation, dstId) {\n      var srcFolder, allCards, cards, ids, clearCardView, promise, success;\n\n      srcFolder = vm.selectedFolder;\n      clearCardView = false;\n      allCards = srcFolder.$selectedCards();\n      cards = _.filter(allCards, function(card) {\n        return card.$isCard();\n      });\n\n      if (cards.length != allCards.length)\n        $mdToast.show(\n          $mdToast.simple()\n            .content(l(\"Lists can't be moved or copied.\"))\n            .position('top right')\n            .hideDelay(2000));\n\n      if (cards.length) {\n        if (operation == 'copy') {\n          promise = srcFolder.$copyCards(cards, dstId);\n          success = l('%{0} card(s) copied', cards.length);\n        }\n        else {\n          promise = srcFolder.$moveCards(cards, dstId);\n          success = l('%{0} card(s) moved', cards.length);\n          // Check if currently displayed card will be moved\n          ids = _.map(cards, 'id');\n          clearCardView = (srcFolder.selectedCard && ids.indexOf(srcFolder.selectedCard) >= 0);\n        }\n\n        // Show success toast when action succeeds\n        promise.then(function() {\n          if (clearCardView)\n            $state.go('app.addressbook');\n          $mdToast.show(\n            $mdToast.simple()\n              .content(success)\n              .position('top right')\n              .hideDelay(2000));\n        });\n      }\n    }\n\n    function copySelectedCards(folder) {\n      _selectedCardsOperation('copy', folder);\n    }\n\n    function moveSelectedCards(folder) {\n      _selectedCardsOperation('move', folder);\n    }\n\n    function selectAll() {\n      _.forEach(vm.selectedFolder.$cards, function(card) {\n        card.selected = true;\n      });\n      vm.mode.multiple = vm.selectedFolder.$cards.length;\n    }\n\n    function sort(field) {\n      vm.selectedFolder.$filter('', { sort: field });\n    }\n\n    function sortedBy(field) {\n      return AddressBook.$query.sort == field;\n    }\n\n    function cancelSearch() {\n      vm.mode.search = false;\n      vm.selectedFolder.$filter('');\n    }\n\n    function newMessage($event, recipients) {\n      Account.$findAll().then(function(accounts) {\n        var account = _.find(accounts, function(o) {\n          if (o.id === 0)\n            return o;\n        });\n\n        // We must initialize the Account with its mailbox\n        // list before proceeding with message's creation\n        account.$getMailboxes().then(function(mailboxes) {\n          account.$newMessage().then(function(message) {\n            angular.extend(message.editable, { to: recipients });\n            $mdDialog.show({\n              parent: angular.element(document.body),\n              targetEvent: $event,\n              clickOutsideToClose: false,\n              escapeToClose: false,\n              templateUrl: '../Mail/UIxMailEditor',\n              controller: 'MessageEditorController',\n              controllerAs: 'editor',\n              locals: {\n                stateAccount: account,\n                stateMessage: message\n              }\n            });\n          });\n        });\n      });\n    }\n\n    function newMessageWithRecipient($event, recipient, fn) {\n      var recipients = [fn + ' <' + recipient + '>'];\n      vm.newMessage($event, recipients);\n      $event.stopPropagation();\n      $event.preventDefault();\n    }\n\n    function newMessageWithSelectedCards($event) {\n      var selectedCards = _.filter(vm.selectedFolder.$cards, function(card) { return card.selected; });\n      var promises = [], recipients = [];\n\n      _.forEach(selectedCards, function(card) {\n        if (card.$isList({expandable: true})) {\n          // If the list's members were already fetch, use them\n          if (angular.isDefined(card.refs) && card.refs.length) {\n            _.forEach(card.refs, function(ref) {\n              if (ref.email.length)\n                recipients.push(ref.$shortFormat());\n            });\n          }\n          else {\n            promises.push(card.$reload().then(function(card) {\n              _.forEach(card.refs, function(ref) {\n                if (ref.email.length)\n                  recipients.push(ref.$shortFormat());\n              });\n            }));\n          }\n        }\n        else if (card.c_mail.length) {\n          recipients.push(card.$shortFormat());\n        }\n      });\n\n      $q.all(promises).then(function() {\n        recipients = _.uniq(recipients);\n        if (recipients.length)\n          vm.newMessage($event, recipients);\n      });\n    }\n  }\n\n  angular\n    .module('SOGo.ContactsUI')\n    .controller('AddressBookController', AddressBookController);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * @ngInject\n   */\n  AddressBooksController.$inject = ['$state', '$scope', '$rootScope', '$stateParams', '$timeout', '$window', '$mdDialog', '$mdToast', '$mdMedia', '$mdSidenav', 'FileUploader', 'sgConstant', 'sgHotkeys', 'sgFocus', 'Card', 'AddressBook', 'Dialog', 'sgSettings', 'User', 'stateAddressbooks'];\n  function AddressBooksController($state, $scope, $rootScope, $stateParams, $timeout, $window, $mdDialog, $mdToast, $mdMedia, $mdSidenav, FileUploader, sgConstant, sgHotkeys, focus, Card, AddressBook, Dialog, Settings, User, stateAddressbooks) {\n    var vm = this, hotkeys = [];\n\n    vm.activeUser = Settings.activeUser;\n    vm.service = AddressBook;\n    vm.select = select;\n    vm.newAddressbook = newAddressbook;\n    vm.edit = edit;\n    vm.revertEditing = revertEditing;\n    vm.save = save;\n    vm.confirmDelete = confirmDelete;\n    vm.importCards = importCards;\n    vm.showLinks = showLinks;\n    vm.showProperties = showProperties;\n    vm.share = share;\n    vm.subscribeToFolder = subscribeToFolder;\n    vm.isDroppableFolder = isDroppableFolder;\n    vm.dragSelectedCards = dragSelectedCards;\n\n\n    _registerHotkeys(hotkeys);\n\n    $scope.$on('$destroy', function() {\n      // Deregister hotkeys\n      _.forEach(hotkeys, function(key) {\n        sgHotkeys.deregisterHotkey(key);\n      });\n    });\n\n\n    function _registerHotkeys(keys) {\n      keys.push(sgHotkeys.createHotkey({\n        key: 'backspace',\n        description: l('Delete selected card or address book'),\n        callback: function() {\n          if (AddressBook.selectedFolder && !AddressBook.selectedFolder.hasSelectedCard())\n            confirmDelete();\n        }\n      }));\n\n      // Register the hotkeys\n      _.forEach(keys, function(key) {\n        sgHotkeys.registerHotkey(key);\n      });\n    }\n\n    function select($event, folder) {\n      if ($state.params.addressbookId != folder.id &&\n          vm.editMode != folder.id) {\n        vm.editMode = false;\n        AddressBook.$query.value = '';\n        // Close sidenav on small devices\n        if (!$mdMedia(sgConstant['gt-md']))\n          $mdSidenav('left').close();\n        $state.go('app.addressbook', {addressbookId: folder.id});\n      }\n      else {\n        $event.preventDefault();\n        $event.stopPropagation();\n      }\n    }\n\n    function newAddressbook() {\n      Dialog.prompt(l('New addressbook'),\n                    l('Name of new addressbook'))\n        .then(function(name) {\n          var addressbook = new AddressBook(\n            {\n              name: name,\n              isEditable: true,\n              isRemote: false,\n              owner: UserLogin\n            }\n          );\n          AddressBook.$add(addressbook);\n        });\n    }\n\n    function edit(folder) {\n      if (!folder.isRemote) {\n        vm.editMode = folder.id;\n        vm.originalAddressbook = angular.extend({}, folder.$omit());\n        focus('addressBookName_' + folder.id);\n      }\n    }\n\n    function revertEditing(folder) {\n      folder.name = vm.originalAddressbook.name;\n      vm.editMode = false;\n    }\n\n    function save(folder) {\n      var name = folder.name;\n      if (name && name.length > 0 && name != vm.originalAddressbook.name) {\n        folder.$rename(name)\n          .then(function(data) {\n            vm.editMode = false;\n          }, function(data, status) {\n            Dialog.alert(l('Warning'), data);\n          });\n      }\n    }\n\n    function confirmDelete() {\n      if (vm.service.selectedFolder.isSubscription) {\n        // Unsubscribe without confirmation\n        vm.service.selectedFolder.$delete()\n          .then(function() {\n            vm.service.selectedFolder = null;\n            $state.go('app.addressbook', { addressbookId: 'personal' });\n          }, function(data, status) {\n            Dialog.alert(l('An error occured while deleting the addressbook \"%{0}\".',\n                           vm.service.selectedFolder.name),\n                         l(data.error));\n          });\n      }\n      else {\n        Dialog.confirm(l('Warning'), l('Are you sure you want to delete the addressbook \"%{0}\"?',\n                                       vm.service.selectedFolder.name),\n                       { ok: l('Delete') })\n          .then(function() {\n            return vm.service.selectedFolder.$delete();\n          })\n          .then(function() {\n            vm.service.selectedFolder = null;\n            $state.go('app.addressbook', { addressbookId: 'personal' });\n            return true;\n          })\n          .catch(function(response) {\n            if (response) {\n              var message = response.data.message || response.statusText;\n              Dialog.alert(l('An error occured while deleting the addressbook \"%{0}\".',\n                             vm.service.selectedFolder.name),\n                           message);\n            }\n          });\n      }\n    }\n\n    function importCards($event, folder) {\n      $mdDialog.show({\n        parent: angular.element(document.body),\n        targetEvent: $event,\n        clickOutsideToClose: true,\n        escapeToClose: true,\n        templateUrl: 'UIxContactsImportDialog',\n        controller: CardsImportDialogController,\n        controllerAs: '$CardsImportDialogController',\n        locals: {\n          folder: folder\n        }\n      });\n\n      /**\n       * @ngInject\n       */\n      CardsImportDialogController.$inject = ['scope', '$mdDialog', 'folder'];\n      function CardsImportDialogController(scope, $mdDialog, folder) {\n        var vm = this;\n\n        vm.uploader = new FileUploader({\n          url: ApplicationBaseURL + [folder.id, 'import'].join('/'),\n          autoUpload: true,\n          queueLimit: 1,\n          filters: [{ name: filterByExtension, fn: filterByExtension }],\n          onSuccessItem: function(item, response, status, headers) {\n            var msg;\n\n            $mdDialog.hide();\n\n            if (response.imported === 0)\n              msg = l('No card was imported.');\n            else {\n              msg = l('A total of %{0} cards were imported in the addressbook.', response.imported);\n              AddressBook.selectedFolder.$reload();\n            }\n\n            $mdToast.show(\n              $mdToast.simple()\n                .content(msg)\n                .position('top right')\n                .hideDelay(3000));\n          },\n          onErrorItem: function(item, response, status, headers) {\n            $mdToast.show({\n              template: [\n                '<md-toast>',\n                '  <div class=\"md-toast-content\">',\n                '    <md-icon class=\"md-warn md-hue-1\">error_outline</md-icon>',\n                '    <span>' + l('An error occured while importing contacts.') + '</span>',\n                '  </div>',\n                '</md-toast>'\n              ].join(''),\n              position: 'top right',\n              hideDelay: 3000\n            });\n          }\n        });\n\n        vm.close = function() {\n          $mdDialog.hide();\n        };\n\n        function filterByExtension(item) {\n          var isTextFile = item.type.indexOf('text') === 0 ||\n              /\\.(ldif|vcf|vcard)$/.test(item.name);\n\n          if (!isTextFile)\n            $mdToast.show({\n              template: [\n                '<md-toast>',\n                '  <div class=\"md-toast-content\">',\n                '    <md-icon class=\"md-warn md-hue-1\">error_outline</md-icon>',\n                '    <span>' + l('Select a vCard or LDIF file.') + '</span>',\n                '  </div>',\n                '</md-toast>'\n              ].join(''),\n              position: 'top right',\n              hideDelay: 3000\n            });\n\n          return isTextFile;\n        }\n      }\n    }\n\n    function showLinks(addressbook) {\n      $mdDialog.show({\n        parent: angular.element(document.body),\n        clickOutsideToClose: true,\n        escapeToClose: true,\n        templateUrl: addressbook.id + '/links',\n        controller: LinksDialogController,\n        controllerAs: 'links',\n        locals: {\n          addressbook: addressbook\n        }\n      });\n\n      /**\n       * @ngInject\n       */\n      LinksDialogController.$inject = ['$mdDialog', 'addressbook'];\n      function LinksDialogController($mdDialog, addressbook) {\n        var vm = this;\n        this.addressbook = addressbook;\n        this.close = close;\n\n        function close() {\n          $mdDialog.hide();\n        }\n      }\n    }\n\n    function showProperties(addressbook) {\n      $mdDialog.show({\n        templateUrl: addressbook.id + '/properties',\n        controller: PropertiesDialogController,\n        controllerAs: 'properties',\n        clickOutsideToClose: true,\n        escapeToClose: true,\n        locals: {\n          srcAddressBook: addressbook\n        }\n      }).catch(function() {\n        // Do nothing\n      });\n\n      /**\n       * @ngInject\n       */\n      PropertiesDialogController.$inject = ['$scope', '$mdDialog', 'srcAddressBook'];\n      function PropertiesDialogController($scope, $mdDialog, srcAddressBook) {\n        var vm = this;\n\n        vm.addressbook = new AddressBook(srcAddressBook.$omit());\n        vm.saveProperties = saveProperties;\n        vm.close = close;\n\n        function saveProperties() {\n          vm.addressbook.$save().then(function() {\n            // Refresh list instance\n            srcAddressBook.init(vm.addressbook.$omit());\n            $mdDialog.hide();\n          });\n        }\n\n        function close() {\n          $mdDialog.cancel();\n        }\n      }\n    }\n\n    function share(addressbook) {\n      // Fetch list of ACL users\n      addressbook.$acl.$users().then(function() {\n        // Show ACL editor\n        $mdDialog.show({\n          templateUrl: addressbook.id + '/UIxAclEditor', // UI/Templates/UIxAclEditor.wox\n          controller: 'AclController', // from the ng module SOGo.Common\n          controllerAs: 'acl',\n          clickOutsideToClose: true,\n          escapeToClose: true,\n          locals: {\n            usersWithACL: addressbook.$acl.users,\n            User: User,\n            folder: addressbook\n          }\n        });\n      });\n    }\n\n    /**\n     * subscribeToFolder - Callback of sgSubscribe directive\n     */\n    function subscribeToFolder(addressbookData) {\n      console.debug('subscribeToFolder ' + addressbookData.owner + addressbookData.name);\n      AddressBook.$subscribe(addressbookData.owner, addressbookData.name).then(function(data) {\n         $mdToast.show(\n           $mdToast.simple()\n             .content(l('Successfully subscribed to address book'))\n             .position('top right')\n             .hideDelay(3000));\n      });\n    }\n\n    function isDroppableFolder(srcFolder, dstFolder) {\n      return (dstFolder.id != srcFolder.id) && (dstFolder.isOwned || dstFolder.acls.objectCreator);\n    }\n\n    /**\n     * @see AddressBookController._selectedCardsOperation\n     */\n    function dragSelectedCards(srcFolder, dstFolder, mode) {\n      var dstId, allCards, cards, ids, clearCardView, promise, success;\n\n      dstId = dstFolder.id;\n      clearCardView = false;\n      allCards = srcFolder.$selectedCards();\n      if (allCards.length === 0)\n        allCards = [srcFolder.$selectedCard()];\n      cards = _.filter(allCards, function(card) {\n        return card.$isCard();\n      });\n\n      if (cards.length != allCards.length)\n        $mdToast.show(\n          $mdToast.simple()\n            .content(l(\"Lists can't be moved or copied.\"))\n            .position('top right')\n            .hideDelay(2000));\n\n      if (cards.length) {\n        if (mode == 'copy') {\n          promise = srcFolder.$copyCards(cards, dstId);\n          success = l('%{0} card(s) copied', cards.length);\n        }\n        else {\n          promise = srcFolder.$moveCards(cards, dstId);\n          success = l('%{0} card(s) moved', cards.length);\n          // Check if currently displayed card will be moved\n          ids = _.map(cards, 'id');\n          clearCardView = (srcFolder.selectedCard && ids.indexOf(srcFolder.selectedCard) >= 0);\n        }\n\n        // Show success toast when action succeeds\n        promise.then(function() {\n          if (clearCardView)\n            $state.go('app.addressbook');\n          $mdToast.show(\n            $mdToast.simple()\n              .content(success)\n              .position('top right')\n              .hideDelay(2000));\n        });\n      }\n    }\n\n  }\n\n  angular\n    .module('SOGo.ContactsUI')\n    .controller('AddressBooksController', AddressBooksController);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * Controller to view and edit a card\n   * @ngInject\n   */\n  CardController.$inject = ['$scope', '$timeout', '$window', '$mdDialog', 'AddressBook', 'Card', 'Dialog', 'sgHotkeys', 'sgFocus', '$state', '$stateParams', 'stateCard'];\n  function CardController($scope, $timeout, $window, $mdDialog, AddressBook, Card, Dialog, sgHotkeys, focus, $state, $stateParams, stateCard) {\n    var vm = this, hotkeys = [];\n\n    vm.card = stateCard;\n\n    vm.currentFolder = AddressBook.selectedFolder;\n    vm.allEmailTypes = Card.$EMAIL_TYPES;\n    vm.allTelTypes = Card.$TEL_TYPES;\n    vm.allUrlTypes = Card.$URL_TYPES;\n    vm.allAddressTypes = Card.$ADDRESS_TYPES;\n    vm.categories = {};\n    vm.userFilterResults = [];\n    vm.transformCategory = transformCategory;\n    vm.addOrgUnit = addOrgUnit;\n    vm.addBirthday = addBirthday;\n    vm.addScreenName = addScreenName;\n    vm.addEmail = addEmail;\n    vm.addPhone = addPhone;\n    vm.addUrl = addUrl;\n    vm.addAddress = addAddress;\n    vm.userFilter = userFilter;\n    vm.save = save;\n    vm.close = close;\n    vm.reset = reset;\n    vm.cancel = cancel;\n    vm.confirmDelete = confirmDelete;\n    vm.toggleRawSource = toggleRawSource;\n    vm.showRawSource = false;\n\n\n    _registerHotkeys(hotkeys);\n\n    $scope.$on('$destroy', function() {\n      // Deregister hotkeys\n      _.forEach(hotkeys, function(key) {\n        sgHotkeys.deregisterHotkey(key);\n      });\n    });\n\n\n    function _registerHotkeys(keys) {\n      keys.push(sgHotkeys.createHotkey({\n        key: 'backspace',\n        description: l('Delete'),\n        callback: function($event) {\n          if (vm.currentFolder.$selectedCount() === 0)\n            confirmDelete();\n          $event.preventDefault();\n        }\n      }));\n\n      // Register the hotkeys\n      _.forEach(keys, function(key) {\n        sgHotkeys.registerHotkey(key);\n      });\n    }\n\n    function transformCategory(input) {\n      if (angular.isString(input))\n        return { value: input };\n      else\n        return input;\n    }\n    function addOrgUnit() {\n      var i = vm.card.$addOrgUnit('');\n      focus('orgUnit_' + i);\n    }\n    function addBirthday() {\n      vm.card.birthday = new Date();\n    }\n    function addScreenName() {\n      vm.card.$addScreenName('');\n    }\n    function addEmail() {\n      var i = vm.card.$addEmail('');\n      focus('email_' + i);\n    }\n    function addPhone() {\n      var i = vm.card.$addPhone('');\n      focus('phone_' + i);\n    }\n    function addUrl() {\n      var i = vm.card.$addUrl('', '');\n      focus('url_' + i);\n    }\n    function addAddress() {\n      var i = vm.card.$addAddress('', '', '', '', '', '', '', '');\n      focus('address_' + i);\n    }\n    function userFilter($query, excludedCards) {\n      AddressBook.selectedFolder.$filter($query, {dry: true, excludeLists: true}, excludedCards);\n      return AddressBook.selectedFolder.$$cards;\n    }\n    function save(form) {\n      if (form.$valid) {\n        vm.card.$save()\n          .then(function(data) {\n            var i = _.indexOf(_.map(AddressBook.selectedFolder.$cards, 'id'), vm.card.id);\n            if (i < 0) {\n              // New card; reload contacts list and show addressbook in which the card has been created\n              AddressBook.selectedFolder.$reload();\n            }\n            else {\n              // Update contacts list with new version of the Card object\n              AddressBook.selectedFolder.$cards[i] = angular.copy(vm.card);\n            }\n            $state.go('app.addressbook.card.view', { cardId: vm.card.id });\n          });\n      }\n    }\n    function close() {\n      $state.go('app.addressbook').then(function() {\n        vm.card = null;\n        delete AddressBook.selectedFolder.selectedCard;\n      });\n    }\n    function reset() {\n      vm.card.$reset();\n    }\n    function cancel() {\n      vm.card.$reset();\n      if (vm.card.isNew) {\n        // Cancelling the creation of a card\n        vm.card = null;\n        delete AddressBook.selectedFolder.selectedCard;\n        $state.go('app.addressbook', { addressbookId: AddressBook.selectedFolder.id });\n      }\n      else {\n        // Cancelling the edition of an existing card\n        $state.go('app.addressbook.card.view', { cardId: vm.card.id });\n      }\n    }\n    function confirmDelete() {\n      var card = stateCard;\n\n      Dialog.confirm(l('Warning'),\n                     l('Are you sure you want to delete the card of %{0}?', '<b>' + card.$fullname() + '</b>'),\n                     { ok: l('Delete') })\n        .then(function() {\n          // User confirmed the deletion\n          AddressBook.selectedFolder.$deleteCards([card])\n            .then(function() {\n              close();\n            }, function(data, status) {\n              Dialog.alert(l('Warning'), l('An error occured while deleting the card \"%{0}\".',\n                                           card.$fullname()));\n            });\n        });\n    }\n\n    function toggleRawSource($event) {\n      if (!vm.showRawSource && !vm.rawSource) {\n        Card.$$resource.post(vm.currentFolder.id + '/' + vm.card.id, \"raw\").then(function(data) {\n          vm.rawSource = data;\n          vm.showRawSource = true;\n        });\n      }\n      else {\n        vm.showRawSource = !vm.showRawSource;\n      }\n    }\n  }\n\n  angular\n    .module('SOGo.ContactsUI')\n    .controller('CardController', CardController);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * @name sgAddress\n   * @memberof ContactsUI\n   * @desc Directive to format a postal address.\n   * @ngInject\n   */\n  function sgAddress() {\n    return {\n      restrict: 'A',\n      scope: { data: '=sgAddress' },\n      controller: ['$scope', function($scope) {\n        $scope.addressLines = function(data) {\n          var lines = [],\n              locality_region = [];\n          if (data.street) lines.push(data.street);\n          if (data.street2) lines.push(data.street2);\n          if (data.locality) locality_region.push(data.locality);\n          if (data.region) locality_region.push(data.region);\n          if (locality_region.length > 0) lines.push(locality_region.join(', '));\n          if (data.country) lines.push(data.country);\n          if (data.postalcode) lines.push(data.postalcode);\n          return lines.join('<br>');\n        };\n      }],\n      template: '<address ng-bind-html=\"addressLines(data)\"></address>'\n    };\n  }\n  \n  angular\n    .module('SOGo.Common')\n    .directive('sgAddress', sgAddress);\n})();\n"]}