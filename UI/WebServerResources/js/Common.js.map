{"version":3,"sources":["Common/utils.js","Common/Common.app.js","Common/mdColors.app.js","Common/decodeUri.filter.js","Common/encodeUri.filter.js","Common/ensureTarget.filter.js","Common/last.filter.js","Common/loc.filter.js","Common/range.filter.js","Common/stripTags.filter.js","Common/txt2html.filter.js","Common/url.filter.js","Common/AclController.js","Common/navController.js","Common/Acl.service.js","Common/Alarm.service.js","Common/Authentication.service.js","Common/Dialog.service.js","Common/Gravatar.service.js","Common/Resource.service.js","Common/sgFocus.service.js","Common/sgHotkeys.service.js","Common/User.service.js","Common/sgAvatarImage.directive.js","Common/sgBlockToggle.directive.js","Common/sgCheckmark.directive.js","Common/sgColorPicker.directive.js","Common/sgCompile.directive.js","Common/sgDatepickerReadonlyInput.directive.js","Common/sgDraggable.directive.js","Common/sgDroppable.directive.js","Common/sgEnter.directive.js","Common/sgEscape.directive.js","Common/sgFocus.directive.js","Common/sgFolderStylesheet.directive.js","Common/sgNoDirtyCheck.directive.js","Common/sgPlaceholder.directive.js","Common/sgResetOnDisabled.directive.js","Common/sgRippleClick.directive.js","Common/sgSearch.directive.js","Common/sgSelectOnly.directive.js","Common/sgSubscribe.directive.js","Common/sgTimepicker.directive.js","Common/sgToggleGrid.directive.js","Common/sgVariableScrollShrink.directive.js"],"names":["l","i","j","key","arguments","value","args","labels","clabels","length","replace","m","val","parseFloat","isNaN","hexToRgb","hex","result","exec","r","parseInt","g","b","contrast","color","c","Math","pow","guid","S4","random","toString","substring","substr","toLowerCase","configure","$logProvider","$compileProvider","$httpProvider","$mdThemingProvider","$mdAriaProvider","definePalette","50","100","200","300","400","500","600","700","800","900","A100","A200","A400","A700","contrastDefaultColor","contrastLightColors","contrastDarkColors","1000","greyMap","extendPalette","theme","primaryPalette","default","hue-1","hue-2","hue-3","accentPalette","backgroundPalette","DebugEnabled","debugEnabled","debugInfoEnabled","disableWarnings","generateThemesOnDemand","interceptors","push","AuthInterceptor","$window","$q","response","test","config","headers","Accept","data","location","reload","reject","ErrorInterceptor","$rootScope","$injector","responseError","rejection","deferred","iframe","usesCASAuthentication","status","defer","angular","element","UserFolderURL","on","$http","get","then","resolve","remove","document","body","appendChild","promise","$broadcast","module","isPopup","classList","contains","baseURL","ApplicationBaseURL","resourcesURL","ResourcesURL","activeUser","param","settings","login","UserLogin","identification","UserIdentification","email","UserEmail","language","UserLanguage","folderURL","isSuperUser","IsSuperUser","path","calendar","UserCalendarPath","contacts","UserContactsPath","mail","UserMailPath","preferences","UserPreferencesPath","administration","UserAdministrationPath","help","HelpURL","logoff","UserLogoffPath","minimumSearchLength","isNumber","constant","selection","xs","gt-xs","sm","gt-sm","md","gt-md","lg","gt-lg","xl","print","factory","$inject","_$mdThemingProvider","runBlock","$interpolate","$document","$log","buildCssSelectors","selectors","join","addRule","fgInterpolate","bgInterpolate","themeName","paletteName","colorArray","hueName","colorValue","colorContrast","context","palette","hue","customSheet","insertRule","index","addBorderRule","bdrInterpolate","getStyleSheet","style","head","querySelector","createElement","title","createTextNode","sheet","fgDefault","bgDefault","bdrDefault","fgDefaultHue","bgDefaultHue","fgColor","bgColor","bdrColor","fgHue","bgHue","cssRules","deleteRule","forEach","_THEMES","_PALETTES","colors","primary","name","hues","run","decodeUri","decodeURIComponent","filter","encodeUri","encodeURIComponent","ensureTarget","$sce","tree","find","attr","trustAs","html","last","a","_","loc","range","n","res","stripTags","text","String","txt2html","linkyFilter","undefined","url","indexOf","AclController","$timeout","$mdDialog","Dialog","usersWithACL","User","folder","folderClassName","isFunction","getClassName","templateName","user","isAnonymous","getElementById","$isAnonymous","userFilter","$query","$filter","$acl","users","closeModal","$resetUsersRights","hide","saveModal","$saveUsersRights","alert","confirmChange","confirmation","$confirmRights","vm","showing","message","removeUser","$removeUser","uid","addUser","$addUser","userToAdd","searchText","selectedUid","selectUser","selectAllRights","$selectAllRights","$event","target","parentNode","selectedUser","inactive","$rights","showRights","this","controller","navController","$scope","$interval","$mdSidenav","$mdToast","$mdMedia","sgConstant","sgSettings","Resource","Alarm","leftIsClose","isOpen","onHttpError","event","isString","statusText","show","template","hideDelay","position","debug","resource","$onInit","centerIsClose","currentDay","window","secondsBeforeTomorrow","$watch","newVal","isGtMedium","$on","getAlarms","toggleLeft","triggerHandler","toggle","toggleRight","toggleCenter","options","save","post","state","Acl","folderId","Settings","extend","$$resource","$User","prototype","$users","owner","_this","acls","isDefined","userResource","fetch","canSubscribeUser","isSubscribed","wasSubscribed","bind","map","userClass","isGroup","$shadowRights","splice","rights","right","$resetRights","deferredSave","deferredSubscribe","action","$rightsAreDirty","$omit","copy","uids","all","currentAlarm","AlarmService","$toast","now","Date","browserTime","floor","getTime","alarms","sort","x","y","next","pop","utc","alarmTime","delay","f","showAlarm","cancel","AlarmController","scope","summary","reminder","close","snooze","locals","Authentication","redirectUrl","username","domain","userName","address","baseAddress","parts","hostpart","protocol","newAddress","href","split","startsWith","endsWith","getService","$cookies","passwordPolicyConfig","readLoginCookie","loginValues","cookie","base64decode","service","d","password","rememberLogin","loginSuffix","method","loginCookie","expire","grace","cn","msg","perr","LDAPPasswordPolicyError","PolicyNoError","PolicyAccountLocked","error","changePassword","newPassword","xsrfCookie","X-XSRF-TOKEN","PolicyPasswordModNotAllowed","PolicyInsufficientPasswordQuality","PolicyPasswordTooShort","PolicyPasswordTooYoung","PolicyPasswordInHistory","formatted","PolicyPasswordUnknown","PolicyPasswordSystemUnknown","put","$get","PolicyPasswordChangeUnsupported","PolicyPasswordExpired","PolicyChangeAfterReset","PolicyMustSupplyOldPassword","provider","DialogService","$modal","content","htmlContent","ok","multiple","confirm","prompt","label","PromptDialogController","o","id","asCSSIdentifier","parent","clickOutsideToClose","escapeToClose","inputType","Gravatar","size","alternate_avatar","hash","s","md5","no_404","_http","_q","_path","_activeUser","$factory","compact","escape","Array","apply","slice","call","params","flatten","newguid","create","newValue","download","getFileNameFromHeader","header","trim","type","accept","responseType","cache","transformResponse","fileName","blob","Error","Blob","filename","saveAs","sgFocus","$sgHotkeys","wrapWithApply","fn","$apply","HotKey","description","callback","preventInClass","onKeyUp","lkey","clone","Hotkeys","_hotkeys","_hotkeysUp","_preventIn","_preventInClass","_onKeydown","_onKeyup","_onKeypress","initialize","registerHotkey","createHotkey","_toggleCheatSheet","addEventListener","_invokeHotkeyHandlers","keyString","hotkeys","hotkey","srcElement","nodeName","toUpperCase","includes","intersection","e","console","keyStringFromEvent","charCode","keyCode","which","CHAR_CODES","KEY_CODES","fromCharCode","ctrlKey","altKey","shiftKey","metaKey","uniq","_deregisterHotkey","ret","table","callbackArray","callbackData","deregisterHotkey","_validateHotkey","isArray","TypeError","_registerKey","_registerKeys","registerHotkeyUp","match","eventHotkey","Boolean","CheatSheetController","closeDialog","_cheatSheet","finally","8","9","13","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","45","46","96","97","98","99","101","102","103","104","105","106","107","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","42","63","sgHotkeys","userData","init","search","excludedUsers","dry","when","results","compareUids","isUndefined","$$shortFormat","$shortFormat","$$image","image","$avatarIcon","$isGroup","$isSpecial","empty","$fullname","fullname","c_info","c_email","no_email","$confirmation","some","values","constructor","isEqual","zero","keys","$folders","$$folders","folders","sgAvatarImage","link","attrs","deregisterWatcher","imgElement","mdIcons","mdIconElement","mdBadgeElement","css","ngDisabled","isDisabled","disabled","display","img","genericImg","restrict","bindToController","src","transclude","controllerAs","sgAvatarImageController","$element","Preferences","getGravatar","defaults","SOGoAlternateAvatar","urlEmail","hideGenericAvatar","showGenericAvatar","addClass","removeClass","configureZoomableAvatar","toggleZoomFcn","toggleClass","off","old","SOGoGravatarEnabled","attributes","directive","sgBlockToggle","$mdUtil","$animateCss","$$rAF","renderContent","block","setAttribute","visibility","icon","add","icon_rotate_class","targetHeight","scrollHeight","easing","to","height","duration","start","button","sgCheckmarkDirective","$parse","$mdAria","$mdTheming","compile","tElement","tAttrs","hasAttribute","stopImmediatePropagation","ngModelCtrl","parseConstantExpr","expression","fallback","parseFn","listener","ev","viewValue","$viewValue","trueValue","falseValue","$setViewValue","$render","render","CHECKED_CSS","sgTrueValue","sgFalseValue","fakeNgModel","expectWithText","require","sgColorPicker","sgColorPickerController","$mdPanel","sgColors","updateColor","newColor","$ctrl","buttonIcon","ngModelController","$postLink","showPicker","MenuController","mdPanelRef","$state","setColor","currentTarget","parentElement","children","tile","panelPosition","newPanelPosition","relativeTo","addPanelPosition","xPosition","ALIGN_START","yPosition","ALIGN_TOPS","panelAnimation","newPanelAnimation","openFrom","withAnimation","animation","FADE","columns","column","currentColor","currentContrastColor","selected","attachTo","targetEvent","trapFocus","focusOnOpen","open","panelRef","panelEl","one","sgCompile","$compile","sgCompileLink","ensureCompileRunsOnce","$eval","contents","sgDatepickerReadonlyInput","postLink","datepickerCtrl","getInput","eq","input","prop","sgDraggable","sgDraggableObject","dragStart","count","helper","bindedOnDragDetect","onDragDetect","bindedOnDrag","onDrag","sgDragStart","sgDragCount","$destroy","dragHasStarted","getDistanceFromStart","delta","startPosition","clientX","clientY","sqrt","stopPropagation","onDragEnd","counter","$emit","isRemote","top","pageY","left","pageX","sgDroppable","onEnter","overElement","onLeave","dropAction","droppable","deregisterFolderDragStart","deregisterFolderDragEnd","sgDrop","dragFolder","mode","dragMode","sgEnter","ENTER_KEY","preventDefault","sgEscape","ESCAPE_KEY","elem","sgFocusOn","focus","select","sgFolderStylesheet","sgFolderStylesheetController","transparent","ratio","ngModel","sgNoDirtyCheck","clean","$pristine","$dirty","sgPlaceholder","placeholder","sgResetOnDisabled","$invalid","date","sgRippleClick","coordinates","getBoundingClientRect","container","overflow","scrollTop","ripple","offsetTop","offsetLeft","width","containerId","sgSearchPreTransclude","tAttr","inputEl","selectEl","buttonEl","removeAttr","iElement","iAttr","compiledButtonEl","formName","inputName","allowDot","fields","doSearch","cancelSearch","priority","sgSearch","append","sgSearchController","searchTextOptions","updateOn","debounce","blur","waitforFieldsOnce","searchField","onChange","form","rawSearchText","$valid","$setValidity","sgSelectOnly","autoComplete","selectedItem","$applyAsync","sgSubscribe","folderType","onFolderSelect","sgSubscribeDialogController","showDialog","templateUrl","sgSubscribeController","$setTouched","selectFolder","folderData","timePaneDirective","TimePaneCtrl","controllers","sgTimePaneCtrl","mdInputContainer","configureNgModel","$$mdDateUtil","$mdConstant","$attrs","$mdDateLocale","dateUtil","KEY_CODE","timePaneElement","SELECTED_TIME_CLASS","FOCUSED_TIME_CLASS","nextUniqueId","displayTime","selectedTime","isInitialized","hours","displayName","min5","min1","ii","show5min","getToggleBtnLbl","is5min","toggleManual5min","manual5min","tabindex","self","hourClickHandler","displayVal","updated","setHours","Number","setNgModelValue","minuteClickHandler","setMinutes","boundKeyHandler","handleKeyEvent","nextTick","changeSelectedTime","previousSelectedTime","prevH","getHours","prevHCell","prevM","getMinutes","prevMCell","prevM5Cell","mCell","newH","hCell","newM","changed","ESCAPE","TAB","ENTER","opt_date","today","previousFocus","timePickerDirective","ariaLabelValue","ariaLabel","mdPlaceholder","TimePickerCtrl","mdTimePickerCtrl","parentForm","parseAttributeBoolean","mdNoAsterisk","parentSubmittedWatcher","$submitted","isSubmitted","updateErrorState","dateLocale","documentElement","inputElement","ngInputElement","inputContainer","timePane","timeButton","inputMask","isFocused","setDisabled","isTimeOpen","timePaneOpenedFrom","timePaneId","nextUid","bodyClickHandler","handleBodyClick","windowEventName","IS_MOBILE_REGEX","navigator","userAgent","vendor","opera","windowEventHandler","closeTimePane","windowBlurHandler","handleWindowBlur","leftMargin","topMargin","$set","installPropertyInterceptors","attachChangeListeners","attachInteractionListeners","detachTimePane","EXTRA_INPUT_SIZE","INVALID_CLASS","OPEN_CLASS","DEFAULT_DEBOUNCE_INTERVAL","TIME_PANE_HEIGHT","MIN5","GTXS","XS","MIN1","TIME_PANE_WIDTH","$formatters","time","formatTime","resizeInputElement","$viewChangeListeners","unshift","debounceInterval","handleInputEvent","keyCodes","DOWN_ARROW","openTimePane","$digest","$parent","Object","defineProperty","set","clearErrorState","isValidDate","field","inputString","parsedTime","parseTime","isValidInput","attachTimePane","transform","elementRect","bodyRect","paneTop","paneLeft","viewportTop","viewportLeft","scrollLeft","viewportBottom","innerHeight","viewportRight","innerWidth","paneWidth","scale","min","paneHeight","enableScrolling","removeChild","disableScrollAround","evalAttr","removeEventListener","getTimePaneCtrl","focusTime","ctrl","setFocused","isInTime","getClosest","inputFocusedOnWindowBlur","activeElement","sgToggleGrid","$mdColors","flattenedDays","modelDays","sgToggleGridAttr","modelAttr","tiles","$validate","setInvalid","invalid","tagName","getThemeColor","day","findIndex","$setDirty","$isEmpty","sgVariableScrollShrink","suffix","pattern","lastIndexOf","encodeEntities","SURROGATE_PAIR_REGEXP","NON_ALPHANUMERIC_REGEXP","hi","charCodeAt","low","_base64_keyStr","base64encode","chr1","chr2","chr3","enc1","enc2","enc3","enc4","output","utf8encode","charAt","L","k","K","G","I","F","H","q","p","u","aa","Z","D","t","B","J","P","h","E","v","Y","X","W","V","C","S","Q","N","M","A","z","w","U","T","R","O","capitalize","asDate","newDate","newString","isValidEmail","emailRE","characters","escapeds","re","RegExp","timeInterval","interval","parseDate","localeProvider","format","string","formattingTokens","tokens","token","regexes","parsedInput","matchesCount","year","getYear","month","getMonth","getDate","hour","minute","%d","%e","%m","%b","shortMonths","toLower","%B","months","%y","nearFuture","getFullYear","%Y","%H","%I","%M","%p","linput","am","pm","NaN","daysUpTo","otherDate","days","day1","day2","tmp","nbrDays","round","setTime","minutesTo","dstOffset","valueOf","getTimezoneOffset","stringWithSeparator","separator","str","addDays","initialDate","milliSeconds","addHours","nbrHours","addMinutes","nbrMinutes","beginOfDay","setSeconds","setMilliseconds","dayOfWeek","offset","baseDayOfWeek","firstDayOfWeek","getDay","firstWeekOfYearForDate","firstWeekRule","januaryFirst","firstWeek","firstWeekOfYear","setMonth","setDate","beginOfWeek","getWeek","previousWeek","weekNumber","endOfWeek","getDayString","getHourString","separators","max","validParts","%a","shortDays","%A","%U","shift"],"mappings":"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","file":"Common.js","sourcesContent":["/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\nString.prototype.endsWith = function(suffix) {\n  return this.indexOf(suffix, this.length - suffix.length) !== -1;\n};\n\nString.prototype.startsWith = function(pattern, position) {\n  position = angular.isNumber(position) ? position : 0;\n  return this.lastIndexOf(pattern, position) === position;\n};\n\n// See ngSanitize\nString.prototype.encodeEntities = function () {\n  // Regular Expressions for parsing tags and attributes\n  var SURROGATE_PAIR_REGEXP = /[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g,\n      // Match everything outside of normal chars and \" (quote character)\n      NON_ALPHANUMERIC_REGEXP = /([^#-~ |!])/g;\n\n  return this.\n    replace(/&/g, '&amp;').\n    replace(SURROGATE_PAIR_REGEXP, function(value) {\n      var hi = value.charCodeAt(0);\n      var low = value.charCodeAt(1);\n      return '&#' + (((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000) + ';';\n    }).\n    replace(NON_ALPHANUMERIC_REGEXP, function(value) {\n      return '&#' + value.charCodeAt(0) + ';';\n    }).\n    replace(/</g, '&lt;').\n    replace(/>/g, '&gt;');\n};\n\nString.prototype._base64_keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\nString.prototype.base64encode = function () {\n  var output = \"\";\n  var chr1, chr2, chr3, enc1, enc2, enc3, enc4;\n  var i = 0;\n  \n  var input = this.utf8encode();\n\n  while (i < input.length) {\n    chr1 = input.charCodeAt(i++);\n    chr2 = input.charCodeAt(i++);\n    chr3 = input.charCodeAt(i++);\n    \n    enc1 = chr1 >> 2;\n    enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\n    enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\n    enc4 = chr3 & 63;\n    \n    if (isNaN(chr2)) {\n      enc3 = enc4 = 64;\n    } else if (isNaN(chr3)) {\n      enc4 = 64;\n    }\n    \n    output = output +\n      this._base64_keyStr.charAt(enc1) + this._base64_keyStr.charAt(enc2) +\n      this._base64_keyStr.charAt(enc3) + this._base64_keyStr.charAt(enc4);\n  }\n  \n  return output;\n};\n\nString.prototype.base64decode = function() { \n  var output = \"\";\n  var chr1, chr2, chr3;\n  var enc1, enc2, enc3, enc4;\n  var i = 0;\n  \n  var input = \"\" + this; // .replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\")\n  while (i < input.length) {\n    enc1 = this._base64_keyStr.indexOf(input.charAt(i++));\n    enc2 = this._base64_keyStr.indexOf(input.charAt(i++));\n    enc3 = this._base64_keyStr.indexOf(input.charAt(i++));\n    enc4 = this._base64_keyStr.indexOf(input.charAt(i++));\n\n    chr1 = (enc1 << 2) | (enc2 >> 4);\n    chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n    chr3 = ((enc3 & 3) << 6) | enc4;\n    \n    output = output + String.fromCharCode(chr1);\n    \n    if (enc3 != 64) {\n      output = output + String.fromCharCode(chr2);\n    }\n    if (enc4 != 64) {\n      output = output + String.fromCharCode(chr3);\n    }\n  }\n\n  return output;\n};\n\nString.prototype.md5 = function() {\n  if (!this.length) { return; }\n  // MD5 (Message-Digest Algorithm) by WebToolkit\n  var md5 = function(s){function L(k,d){return(k<<d)|(k>>>(32-d));}function K(G,k){var I,d,F,H,x;F=(G&2147483648);H=(k&2147483648);I=(G&1073741824);d=(k&1073741824);x=(G&1073741823)+(k&1073741823);if(I&d){return(x^2147483648^F^H);}if(I|d){if(x&1073741824){return(x^3221225472^F^H);}else{return(x^1073741824^F^H);}}else{return(x^F^H);}}function r(d,F,k){return(d&F)|((~d)&k);}function q(d,F,k){return(d&k)|(F&(~k));}function p(d,F,k){return(d^F^k);}function n(d,F,k){return(F^(d|(~k)));}function u(G,F,aa,Z,k,H,I){G=K(G,K(K(r(F,aa,Z),k),I));return K(L(G,H),F);}function f(G,F,aa,Z,k,H,I){G=K(G,K(K(q(F,aa,Z),k),I));return K(L(G,H),F);}function D(G,F,aa,Z,k,H,I){G=K(G,K(K(p(F,aa,Z),k),I));return K(L(G,H),F);}function t(G,F,aa,Z,k,H,I){G=K(G,K(K(n(F,aa,Z),k),I));return K(L(G,H),F);}function e(G){var Z;var F=G.length;var x=F+8;var k=(x-(x%64))/64;var I=(k+1)*16;var aa=Array(I-1);var d=0;var H=0;while(H<F){Z=(H-(H%4))/4;d=(H%4)*8;aa[Z]=(aa[Z]|(G.charCodeAt(H)<<d));H++;}Z=(H-(H%4))/4;d=(H%4)*8;aa[Z]=aa[Z]|(128<<d);aa[I-2]=F<<3;aa[I-1]=F>>>29;return aa;}function B(x){var k=\"\",F=\"\",G,d;for(d=0;d<=3;d++){G=(x>>>(d*8))&255;F=\"0\"+G.toString(16);k=k+F.substr(F.length-2,2);}return k;}function J(k){k=k.replace(/rn/g,\"n\");var d=\"\";for(var F=0;F<k.length;F++){var x=k.charCodeAt(F);if(x<128){d+=String.fromCharCode(x);}else{if((x>127)&&(x<2048)){d+=String.fromCharCode((x>>6)|192);d+=String.fromCharCode((x&63)|128);}else{d+=String.fromCharCode((x>>12)|224);d+=String.fromCharCode(((x>>6)&63)|128);d+=String.fromCharCode((x&63)|128);}}}return d;}var C=Array();var P,h,E,v,g,Y,X,W,V;var S=7,Q=12,N=17,M=22;var A=5,z=9,y=14,w=20;var o=4,m=11,l=16,j=23;var U=6,T=10,R=15,O=21;s=J(s);C=e(s);Y=1732584193;X=4023233417;W=2562383102;V=271733878;for(P=0;P<C.length;P+=16){h=Y;E=X;v=W;g=V;Y=u(Y,X,W,V,C[P+0],S,3614090360);V=u(V,Y,X,W,C[P+1],Q,3905402710);W=u(W,V,Y,X,C[P+2],N,606105819);X=u(X,W,V,Y,C[P+3],M,3250441966);Y=u(Y,X,W,V,C[P+4],S,4118548399);V=u(V,Y,X,W,C[P+5],Q,1200080426);W=u(W,V,Y,X,C[P+6],N,2821735955);X=u(X,W,V,Y,C[P+7],M,4249261313);Y=u(Y,X,W,V,C[P+8],S,1770035416);V=u(V,Y,X,W,C[P+9],Q,2336552879);W=u(W,V,Y,X,C[P+10],N,4294925233);X=u(X,W,V,Y,C[P+11],M,2304563134);Y=u(Y,X,W,V,C[P+12],S,1804603682);V=u(V,Y,X,W,C[P+13],Q,4254626195);W=u(W,V,Y,X,C[P+14],N,2792965006);X=u(X,W,V,Y,C[P+15],M,1236535329);Y=f(Y,X,W,V,C[P+1],A,4129170786);V=f(V,Y,X,W,C[P+6],z,3225465664);W=f(W,V,Y,X,C[P+11],y,643717713);X=f(X,W,V,Y,C[P+0],w,3921069994);Y=f(Y,X,W,V,C[P+5],A,3593408605);V=f(V,Y,X,W,C[P+10],z,38016083);W=f(W,V,Y,X,C[P+15],y,3634488961);X=f(X,W,V,Y,C[P+4],w,3889429448);Y=f(Y,X,W,V,C[P+9],A,568446438);V=f(V,Y,X,W,C[P+14],z,3275163606);W=f(W,V,Y,X,C[P+3],y,4107603335);X=f(X,W,V,Y,C[P+8],w,1163531501);Y=f(Y,X,W,V,C[P+13],A,2850285829);V=f(V,Y,X,W,C[P+2],z,4243563512);W=f(W,V,Y,X,C[P+7],y,1735328473);X=f(X,W,V,Y,C[P+12],w,2368359562);Y=D(Y,X,W,V,C[P+5],o,4294588738);V=D(V,Y,X,W,C[P+8],m,2272392833);W=D(W,V,Y,X,C[P+11],l,1839030562);X=D(X,W,V,Y,C[P+14],j,4259657740);Y=D(Y,X,W,V,C[P+1],o,2763975236);V=D(V,Y,X,W,C[P+4],m,1272893353);W=D(W,V,Y,X,C[P+7],l,4139469664);X=D(X,W,V,Y,C[P+10],j,3200236656);Y=D(Y,X,W,V,C[P+13],o,681279174);V=D(V,Y,X,W,C[P+0],m,3936430074);W=D(W,V,Y,X,C[P+3],l,3572445317);X=D(X,W,V,Y,C[P+6],j,76029189);Y=D(Y,X,W,V,C[P+9],o,3654602809);V=D(V,Y,X,W,C[P+12],m,3873151461);W=D(W,V,Y,X,C[P+15],l,530742520);X=D(X,W,V,Y,C[P+2],j,3299628645);Y=t(Y,X,W,V,C[P+0],U,4096336452);V=t(V,Y,X,W,C[P+7],T,1126891415);W=t(W,V,Y,X,C[P+14],R,2878612391);X=t(X,W,V,Y,C[P+5],O,4237533241);Y=t(Y,X,W,V,C[P+12],U,1700485571);V=t(V,Y,X,W,C[P+3],T,2399980690);W=t(W,V,Y,X,C[P+10],R,4293915773);X=t(X,W,V,Y,C[P+1],O,2240044497);Y=t(Y,X,W,V,C[P+8],U,1873313359);V=t(V,Y,X,W,C[P+15],T,4264355552);W=t(W,V,Y,X,C[P+6],R,2734768916);X=t(X,W,V,Y,C[P+13],O,1309151649);Y=t(Y,X,W,V,C[P+4],U,4149444226);V=t(V,Y,X,W,C[P+11],T,3174756917);W=t(W,V,Y,X,C[P+2],R,718787259);X=t(X,W,V,Y,C[P+9],O,3951481745);Y=K(Y,h);X=K(X,E);W=K(W,v);V=K(V,g);}var i=B(Y)+B(X)+B(W)+B(V);return i.toLowerCase();};\n  return md5(this.toLowerCase());\n};\n\nString.prototype.capitalize = function() {\n  return this.charAt(0).toUpperCase() + this.slice(1);\n};\n\nString.prototype.asDate = function () {\n    var newDate;\n    var date = this.split(\"/\");\n    if (date.length == 3)\n        newDate = new Date(date[2], date[1] - 1, date[0]); // dd/mm/yyyy\n    else {\n        date = this.split(\"-\");\n        if (date.length == 3)\n            newDate = new Date(date[0], date[1] - 1, date[2]); // yyyy-mm-dd\n        else {\n            if (this.length == 8) {\n                newDate = new Date(this.substring(0, 4),\n                                   this.substring(4, 6) - 1,\n                                   this.substring(6, 8)); // yyyymmdd\n            }\n        }\n    }\n\n    return newDate;\n};\n\nString.prototype.formatted = function() {\n  var newString = this;\n\n  for (var i = 0; i < arguments.length; i++) {\n    newString = newString.replace(\"%{\" + i + \"}\", arguments[i], \"g\");\n  }\n\n  return newString;\n};\n\nString.prototype.isValidEmail = function() {\n  var emailRE = /^([\\w\\!\\#$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`{\\|\\}\\~]+\\.)*[\\w\\!\\#$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`{\\|\\}\\~]+@((((([a-z0-9]{1}[a-z0-9\\-]{0,62}[a-z0-9]{1})|[a-z])\\.)+[a-z]{2,})|(\\d{1,3}\\.){3}\\d{1,3}(\\:\\d{1,5})?)$/i;\n  return emailRE.test(this);\n};\n\nString.prototype.asCSSIdentifier = function() {\n  var characters = [ '_'  , '\\\\.', '#'  , '@'  , '\\\\*', ':'  , ','   , ' ',    \"'\",    '&',    '\\\\+' ];\n  var escapeds =   [ '_U_', '_D_', '_H_', '_A_', '_S_', '_C_', '_CO_', '_SP_', '_SQ_', '_AM_', '_P_' ];\n\n  var newString = this;\n  for (var i = 0; i < characters.length; i++) {\n    var re = new RegExp(characters[i], 'g');\n    newString = newString.replace(re, escapeds[i]);\n  }\n\n  newString = newString.replace(/[^\\x00-\\x7F]/g, '');\n\n  if (/^\\d+/.test(newString)) {\n    newString = '_' + newString;\n  }\n\n  return newString;\n};\n\nString.prototype.timeInterval = function () {\n  var interval;\n  if (this == \"once_per_hour\")\n    interval = 3600;\n  else if (this == \"every_minute\")\n    interval = 60;\n  else {\n    interval = parseInt(this.substr(6)) * 60;\n  }\n\n  return interval;\n};\n\nString.prototype.parseDate = function(localeProvider, format) {\n  var string, formattingTokens, tokens, token, now, date, regexes, i, parsedInput, matchesCount;\n\n  string = '' + this;\n  formattingTokens = /%[dembByYHIMp]/g;\n  now = new Date();\n  date = {\n    year: now.getYear() + 1900,\n    month: now.getMonth(),\n    day: now.getDate(),\n    hour: 0,\n    minute: 0\n  };\n  regexes = {\n    '%d': [/\\d\\d/, function(input) {\n      date.day = parseInt(input);\n      return (date.day < 32);\n    }],\n    '%e': [/ ?\\d?\\d/, function(input) {\n      date.day = parseInt(input);\n      return (date.day < 32);\n    }],\n    '%m': [/\\d\\d/, function(input) {\n      date.month = parseInt(input) - 1;\n      return (date.month < 12);\n    }],\n    '%b': [/[^\\d\\s\\.\\/\\-]{2,}/, function(input) {\n      var i = _.indexOf(_.map(localeProvider.shortMonths, _.toLower), _.toLower(input));\n      if (i >= 0)\n        date.month = i;\n      return (i >= 0);\n    }],\n    '%B': [/[^\\d\\s\\.\\/\\-]{2,}/, function(input) {\n      var i = _.indexOf(_.map(localeProvider.months, _.toLower), _.toLower(input));\n      if (i >= 0)\n        date.month = i;\n      return (i >= 0);\n    }],\n    '%y': [/\\d\\d/, function(input) {\n      var nearFuture = parseInt(now.getFullYear().toString().substring(2)) + 5;\n      date.year = parseInt(input);\n      if (date.year < nearFuture) date.year += 2000;\n      else date.year += 1900;\n      return true;\n    }],\n    '%Y': [/[12]\\d\\d\\d/, function(input) {\n      date.year = parseInt(input);\n      return true;\n    }],\n    '%H': [/\\d{1,2}/, function(input) {\n      date.hour = parseInt(input);\n      return (date.hour < 24);\n    }],\n    '%I': [/\\d{1,2}/, function(input) {\n      date.hour = parseInt(input);\n      return (date.hour <= 12);\n    }],\n    '%M': [/[0-5]\\d/, function(input) {\n      date.minute = parseInt(input);\n      return (date.minute < 60 );\n    }],\n    '%p': [/[^\\d\\s\\/\\-]+/, function(input) {\n      var linput = _.toLower(input), am = _.toLower(l('AM')), pm = _.toLower(l('PM'));\n      if (linput == pm)\n        date.hour += 12;\n      return (linput == am || linput == pm);\n    }],\n  };\n  tokens = format.match(formattingTokens) || [];\n  matchesCount = 0;\n\n  for (i = 0; i < tokens.length; i++) {\n    token = tokens[i];\n    parsedInput = (string.match(regexes[token][0]) || [])[0];\n    if (parsedInput) {\n      string = string.slice(string.indexOf(parsedInput) + parsedInput.length);\n      if (regexes[token][1](parsedInput))\n        matchesCount++;\n    }\n  }\n\n  if (tokens.length === matchesCount) {\n    // console.debug(this + ' + ' + format + ' = ' + JSON.stringify(date));\n    return new Date(date.year, date.month, date.day, date.hour, date.minute);\n  }\n  else\n    return new Date(NaN);\n};\n\nDate.prototype.daysUpTo = function(otherDate) {\n    var days = [];\n\n    var day1 = this.getTime();\n    var day2 = otherDate.getTime();\n    if (day1 > day2) {\n        var tmp = day1;\n        day1 = day2;\n        day2 = tmp;\n    }\n\n    var nbrDays = Math.round((day2 - day1) / 86400000) + 1;\n    for (var i = 0; i < nbrDays; i++) {\n        var newDate = new Date();\n        newDate.setTime(day1 + (i * 86400000));\n        days.push(newDate);\n    }\n\n    return days;\n};\n\nDate.prototype.minutesTo = function(otherDate) {\n  var delta, dstOffset;\n\n  delta = Math.floor(otherDate.valueOf() - this.valueOf())/1000/60;\n  dstOffset = otherDate.getTimezoneOffset() - this.getTimezoneOffset();\n\n  return delta - dstOffset;\n};\n\nDate.prototype.stringWithSeparator = function(separator) {\n    var month = '' + (this.getMonth() + 1);\n    var day = '' + this.getDate();\n    var year = this.getYear();\n    if (year < 1000)\n        year = '' + (year + 1900);\n    if (month.length == 1)\n        month = '0' + month;\n    if (day.length == 1)\n        day = '0' + day;\n\n    if (separator == '-')\n        str = year + '-' + month + '-' + day;\n    else\n        str = day + '/' + month + '/' + year;\n\n    return str;\n};\n\nDate.prototype.addDays = function(nbrDays) {\n  var initialDate, milliSeconds, dstOffset;\n\n  milliSeconds = this.getTime();\n  initialDate = new Date(milliSeconds);\n  milliSeconds += 86400000 * nbrDays;\n  this.setTime(milliSeconds);\n\n  dstOffset = this.getTimezoneOffset() - initialDate.getTimezoneOffset();\n  if (dstOffset !== 0) {\n    milliSeconds = this.getTime() + dstOffset*60*1000;\n    this.setTime(milliSeconds);\n  }\n\n  return this;\n};\n\nDate.prototype.addHours = function(nbrHours) {\n  var milliSeconds = this.getTime();\n  milliSeconds += 3600000 * nbrHours;\n  this.setTime(milliSeconds);\n};\n\nDate.prototype.addMinutes = function(nbrMinutes) {\n  var milliSeconds = this.getTime();\n  milliSeconds += 60000 * nbrMinutes;\n  this.setTime(milliSeconds);\n};\n\nDate.prototype.beginOfDay = function() {\n    var beginOfDay = new Date(this.getTime());\n    beginOfDay.setHours(0);\n    beginOfDay.setMinutes(0);\n    beginOfDay.setSeconds(0);\n    beginOfDay.setMilliseconds(0);\n\n    return beginOfDay;\n};\n\n/**\n * See [SOGoUser dayOfWeekForDate:]\n */\nDate.prototype.dayOfWeek = function(localeProvider) {\n  var offset, baseDayOfWeek, dayOfWeek;\n\n  offset = localeProvider.firstDayOfWeek;\n  baseDayOfWeek = this.getDay();\n  if (offset > baseDayOfWeek)\n    baseDayOfWeek += 7;\n\n  dayOfWeek = baseDayOfWeek - offset;\n\n  return dayOfWeek;\n};\n\n/**\n * See [SOGoUser firstWeekOfYearForDate:]\n */\nDate.prototype.firstWeekOfYearForDate = function(localeProvider) {\n  var firstWeekRule, dayOfWeek, januaryFirst, firstWeek;\n\n  firstWeekRule = localeProvider.firstWeekOfYear;\n\n  januaryFirst = new Date(this.getTime());\n  januaryFirst.setMonth(0);\n  januaryFirst.setDate(1);\n  dayOfWeek = januaryFirst.dayOfWeek(localeProvider);\n\n  if (firstWeekRule == 'First4DayWeek') {\n    if (dayOfWeek < 4)\n      firstWeek = januaryFirst.beginOfWeek(localeProvider.firstDayOfWeek);\n    else\n      firstWeek = januaryFirst.addDays(7).beginOfWeek(localeProvider.firstDayOfWeek);\n  }\n  else if (firstWeekRule == 'FirstFullWeek') {\n    if (dayOfWeek === 0)\n      firstWeek = januaryFirst.beginOfWeek(localeProvider.firstDayOfWeek);\n    else\n      firstWeek = januaryFirst.addDays(7).beginOfWeek(localeProvider.firstDayOfWeek);\n  }\n  else {\n    firstWeek = januaryFirst.beginOfWeek(localeProvider.firstDayOfWeek);\n  }\n\n  return firstWeek;\n};\n\n/**\n * See [SOGoUser weekNumberForDate:]\n */\nDate.prototype.getWeek = function(localeProvider) {\n  var firstWeek, previousWeek, weekNumber, clone;\n\n  clone = new Date(this.getTime());\n  clone.addDays(6);\n  firstWeek = clone.firstWeekOfYearForDate(localeProvider);\n  if (firstWeek.getTime() < clone.getTime()) {\n    weekNumber = 1 + Math.floor((clone.getTime() - firstWeek.getTime()) / (86400000 * 7));\n  }\n  else\n    {\n      // Date is within the last week of the previous year;\n      // Compute the previous week number to find the week number of the requested date.\n      // The number will either be 52 or 53.\n      previousWeek = new Date(clone.getTime());\n      previousWeek.addDays(-7);\n      firstWeek = previousWeek.firstWeekOfYearForDate(localeProvider);\n      weekNumber = 2 + Math.floor((previousWeek.getTime() - firstWeek.getTime()) / (86400000 * 7));\n    }\n\n  return weekNumber;\n};\n\nDate.prototype.beginOfWeek = function(firstDayOfWeek) {\n    var offset = firstDayOfWeek - this.getDay();\n    if (offset > 0)\n        offset -= 7;\n\n    var beginOfWeek = this.beginOfDay();\n    beginOfWeek.setHours(12);\n    beginOfWeek.addDays(offset);\n\n    return beginOfWeek;\n};\n\nDate.prototype.endOfWeek = function(firstDayOfWeek) {\n    var endOfWeek = this.beginOfWeek(firstDayOfWeek);\n    endOfWeek.addDays(6);\n\n    endOfWeek.setHours(23);\n    endOfWeek.setMinutes(59);\n    endOfWeek.setSeconds(59);\n    endOfWeek.setMilliseconds(999);\n\n    return endOfWeek;\n};\n\n// YYYYMMDD\nDate.prototype.getDayString = function() {\n    var newString = this.getYear();\n    if (newString < 1000) newString += 1900;\n    var month = '' + (this.getMonth() + 1);\n    if (month.length == 1)\n        month = '0' + month;\n    newString += month;\n    var day = '' + this.getDate();\n    if (day.length == 1)\n        day = '0' + day;\n    newString += day;\n\n    return newString;\n};\n\n// MMHH\nDate.prototype.getHourString = function() {\n    var newString = this.getHours() + '00';\n    if (newString.length == 3)\n        newString = '0' + newString;\n\n    return newString;\n};\n\nDate.prototype.format = function(localeProvider, format) {\n  var separators, parts, i, max,\n      date = [],\n      validParts = /%[deaAmbByYUHIMp]/g,\n      val = {\n        '%d': this.getDate(),                                  // day of month (e.g., 01)\n        '%e': this.getDate(),                                  // day of month, space padded\n        '%a': localeProvider.shortDays[this.getDay()],         // locale's abbreviated weekday name (e.g., Sun)\n        '%A': localeProvider.days[this.getDay()],              // locale's full weekday name (e.g., Sunday)\n        '%m': this.getMonth() + 1,                             // month (01..12)\n        '%b': localeProvider.shortMonths[this.getMonth()],     // locale's abbreviated month name (e.g., Jan)\n        '%B': localeProvider.months[this.getMonth()],          // locale's full month name (e.g., January)\n        '%y': this.getFullYear().toString().substring(2),      // last two digits of year (00..99)\n        '%Y': this.getFullYear(),                              // year\n        '%U': this.getWeek(localeProvider),                    // week of the year\n        '%H': this.getHours(),                                 // hour (00..23)\n        '%M': this.getMinutes() };                             // minute (00..59)\n  val['%I'] = val['%H'] > 12 ? val['%H'] % 12 : val['%H'];     // hour (01..12)\n  val['%p'] = val['%H'] < 12 ? l('AM') : l('PM');              // locale's equivalent of either AM or PM\n\n  val['%d'] = (val['%d'] < 10 ? '0' : '') + val['%d'];\n  val['%e'] = (val['%e'] < 10 ? ' ' : '') + val['%e'];\n  val['%m'] = (val['%m'] < 10 ? '0' : '') + val['%m'];\n  val['%H'] = (val['%H'] < 10 ? '0' : '') + val['%H'];\n  val['%I'] = (val['%I'] < 10 ? '0' : '') + val['%I'];\n  val['%M'] = (val['%M'] < 10 ? '0' : '') + val['%M'];\n\n  separators = format.replace(validParts, '\\0').split('\\0');\n  parts = format.match(validParts);\n  for (i = 0, max = parts.length; i <= max; i++){\n    if (separators.length)\n      date.push(separators.shift());\n    date.push(val[parts[i]]);\n  }\n\n  return date.join('');\n};\n\n/* Functions */\n\nfunction l() {\n  var key = arguments[0], value = key, args = arguments, i, j;\n\n  // Retrieve translation\n  if (labels[key]) {\n    value = labels[key];\n  }\n  else if (clabels[key]) {\n    value = clabels[key];\n  }\n\n  // Format placeholders %{0}, %{1], %{2}, ...\n  for (i = 1, j = 0; i < args.length; i++, j++) {\n    value = value.replace('%{' + j + '}', args[i]);\n  }\n\n  // Format placeholders %d and %s\n  i = 1;\n  if (args.length > 1) {\n    value = value.replace(/%((%)|s|d)/g, function(m) {\n      // m is the matched format, e.g. %s, %d\n      var val = null;\n      if (m[2]) {\n        val = m[2];\n      }\n      else {\n        val = args[i];\n        // A switch statement so that the formatter can be extended. Default is %s\n        switch (m) {\n        case '%d':\n          val = parseFloat(val);\n          if (isNaN(val))\n            val = 0;\n          break;\n        }\n        i++;\n      }\n      return val;\n    });\n  }\n\n  return value;\n}\n\nfunction hexToRgb(hex) {\n  var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n  return result ? {\n    r: parseInt(result[1], 16),\n    g: parseInt(result[2], 16),\n    b: parseInt(result[3], 16)\n  } : null;\n}\n\n// Respect contrast ratio recommendation from W3C:\n// http://www.w3.org/TR/WCAG20/#contrast-ratiodef\nfunction contrast(hex) {\n  var color, c, l = 1;\n\n  color = hexToRgb(hex);\n  if (color) {\n    c = [color.r / 255, color.g / 255, color.b / 255];\n\n    for (var i = 0; i < c.length; ++i) {\n      if (c[i] <= 0.03928) {\n\tc[i] = c[i] / 12.92;\n      }\n      else {\n\tc[i] = Math.pow((c[i] + 0.055) / 1.055, 2.4);\n      }\n    }\n\n    l = 0.2126 * c[0] + 0.7152 * c[1] + 0.0722 * c[2];\n  }\n\n  if (l > 0.179) {\n    return 'black';\n  }\n  else {\n    return 'white';\n  }\n}\n\nfunction guid() {\n  function S4() {\n    return (((1+Math.random())*0x10000)|0).toString(16).substring(1); \n  }\n  \n  return (S4() + S4() + \"-\" + S4() + \"-4\" + S4().substr(0,3) + \"-\" + S4() + \"-\" + S4() + S4() + S4()).toLowerCase();\n}\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  angular.module('SOGo.Common', ['ngAnimate', 'ngMessages', 'ngSanitize', 'ngMaterial', 'mdColors'])\n    .value('sgSettings', {\n      isPopup: document.body.classList.contains('popup'),\n      baseURL: function() {\n        return ApplicationBaseURL || null;\n      },\n      resourcesURL: function() {\n        return ResourcesURL || null;\n      },\n      activeUser: function(param) {\n        var settings = {\n          login: UserLogin || null,\n          identification: UserIdentification || null,\n          email: UserEmail || null,\n          language: UserLanguage || null,\n          folderURL: UserFolderURL || null,\n          isSuperUser: IsSuperUser || null,\n          path: {\n            calendar: UserCalendarPath || null,\n            contacts: UserContactsPath || null,\n            mail: UserMailPath || null,\n            preferences: UserPreferencesPath || null,\n            administration: (IsSuperUser ? UserAdministrationPath : null),\n            help: HelpURL || null,\n            logoff: UserLogoffPath || null\n          }\n        };\n        if (param)\n          return settings[param];\n        else\n          return settings;\n      },\n      minimumSearchLength: function() {\n        return angular.isNumber(minimumSearchLength)? minimumSearchLength : 2;\n      }\n    })\n\n    .constant('sgColors', {\n      selection: [\n        '#FFFFFF',\n        '#330033',\n        '#C0C0C0',\n        '#999999',\n        '#666666',\n        '#333333',\n        '#000000',\n        '#FFCCCC',\n        '#FF6666',\n        '#FF0000',\n        '#CC0000',\n        '#990000',\n        '#660000',\n        '#330000',\n        '#FFCC99',\n        '#FF9966',\n        '#FF9900',\n        '#FF6600',\n        '#CC6600',\n        '#993300',\n        '#663300',\n        '#FFFF99',\n        '#FFFF66',\n        '#FFCC66',\n        '#FFCC33',\n        '#CC9933',\n        '#996633',\n        '#663333',\n        '#FFFFCC',\n        '#FFFF33',\n        '#FFFF00',\n        '#FFCC00',\n        '#999900',\n        '#666600',\n        '#333300',\n        '#CCCCCC',\n        '#66FF99',\n        '#33FF33',\n        '#33CC00',\n        '#009900',\n        '#006600',\n        '#003300',\n        '#99FFFF',\n        '#33FFFF',\n        '#66CCCC',\n        '#00CCCC',\n        '#339999',\n        '#336666',\n        '#003333',\n        '#CCFFFF',\n        '#66FFFF',\n        '#33CCFF',\n        '#3366FF',\n        '#3333FF',\n        '#000099',\n        '#000066',\n        '#CCCCFF',\n        '#9999FF',\n        '#6666CC',\n        '#6633FF',\n        '#6600CC',\n        '#333399',\n        '#330099',\n        '#FFCCFF',\n        '#FF99FF',\n        '#CC66CC',\n        '#CC33CC',\n        '#993399',\n        '#663366',\n        '#99FF99'\n      ]\n    })\n\n  // md break-points values are hard-coded in angular-material/src/core/util/constant.js\n  // $mdMedia has a built-in support for those values but can also evaluate others.\n  // The following breakpoints match our CSS breakpoints in scss/core/variables.scss\n    .constant('sgConstant', {\n      'xs'    : '(max-width: 599px)'                         ,\n      'gt-xs' : '(min-width: 600px)'                         ,\n      'sm'    : '(min-width: 600px) and (max-width: 959px)'  ,\n      'gt-sm' : '(min-width: 960px)'                         ,\n      'md'    : '(min-width: 960px) and (max-width: 1023px)' ,\n      'gt-md' : '(min-width: 1024px)'                        ,\n      'lg'    : '(min-width: 1024px) and (max-width: 1279px)',\n      'gt-lg' : '(min-width: 1280px)'                        ,\n      'xl'    : '(min-width: 1920px)'                        ,\n      'print' : 'print'\n    })\n\n    .config(configure)\n\n    .factory('AuthInterceptor', AuthInterceptor)\n    .factory('ErrorInterceptor', ErrorInterceptor);\n\n  /**\n   * @ngInject\n   */\n  configure.$inject = ['$logProvider', '$compileProvider', '$httpProvider', '$mdThemingProvider', '$mdAriaProvider'];\n  function configure($logProvider, $compileProvider, $httpProvider, $mdThemingProvider, $mdAriaProvider) {\n    // Accent palette\n    $mdThemingProvider.definePalette('sogo-green', {\n      '50': 'eaf5e9',\n      '100': 'cbe5c8',\n      '200': 'aad6a5',\n      '300': '88c781',\n      '400': '66b86a',\n      '500': '56b04c',\n      '600': '4da143',\n      '700': '388e3c',\n      '800': '367d2e',\n      '900': '225e1b',\n      // 'A100': 'b9f6ca',\n      'A100': 'fafafa', // assigned to md-hue-1, equivalent to grey-50 (default background palette)\n      'A200': '69f0ae',\n      'A400': '00e676',\n      'A700': '00c853',\n      'contrastDefaultColor': 'dark',\n      // 'contrastDarkColors': ['50', '100', '200', 'A100'],\n      'contrastLightColors': ['300', '400', '500', '600', '700', '800', '900']\n    });\n    // Primary palette\n    $mdThemingProvider.definePalette('sogo-blue', {\n      '50': 'f0faf9',\n      '100': 'e1f5f3',\n      '200': 'ceebe8',\n      '300': 'bfe0dd',\n      '400': 'b2d6d3',\n      '500': 'a1ccc8',\n      '600': '8ebfbb',\n      '700': '7db3b0',\n      '800': '639997',\n      '900': '4d8080',\n      'A100': 'd4f7fa',\n      'A200': 'c3f5fa',\n      'A400': '53e3f0',\n      'A700': '00b0c0',\n      'contrastDefaultColor': 'light',\n      'contrastDarkColors': ['50', '100', '200'],\n      // 'contrastLightColors': ['300', '400', '500', '600', '700', '800', '900', 'A100', 'A200', 'A400', 'A700']\n    });\n    // Background palette\n    $mdThemingProvider.definePalette('sogo-paper', {\n      '50': 'fcf7f8',\n      '100': 'f7f1dc',\n      '200': 'ede5ca',\n      '300': 'e6d8ba',\n      '400': 'e2d2a3',\n      '500': 'd6c48d',\n      '600': 'baa870',\n      '700': '857545',\n      '800': '524517',\n      '900': '433809',\n      '1000': '000000',\n      'A100': 'ffffff',\n      'A200': 'eeeeee',\n      'A400': 'bdbdbd',\n      'A700': '616161',\n      'contrastDefaultColor': 'dark',\n      'contrastLightColors': ['800', '900']\n    });\n    var greyMap = $mdThemingProvider.extendPalette('grey', {\n      '600': '00B0C0' // used when highlighting text in md-autocomplete\n    });\n    $mdThemingProvider.definePalette('sogo-grey', greyMap);\n    // Default theme definition\n    $mdThemingProvider.theme('default')\n      .primaryPalette('sogo-blue', {\n        'default': '900',\n        'hue-1': '400',\n        'hue-2': '800',\n        'hue-3': 'A700'\n      })\n      .accentPalette('sogo-green', {\n        'default': '500',\n        // 'hue-1': '200',\n        'hue-1': 'A100', // grey-50\n        'hue-2': '300',\n        'hue-3': 'A700'\n      })\n      .backgroundPalette('sogo-grey');\n\n    if (!DebugEnabled) {\n      // Disable debugging information\n      $logProvider.debugEnabled(false);\n      $compileProvider.debugInfoEnabled(false);\n      // Disable warnings\n      $mdAriaProvider.disableWarnings();\n      // Disable theme generation but keep definition in config (required by mdColors)\n      $mdThemingProvider.generateThemesOnDemand(true);\n      // Disable theming completely\n      //$mdThemingProvider.disableTheming();\n    }\n\n    $httpProvider.interceptors.push('AuthInterceptor');\n    $httpProvider.interceptors.push('ErrorInterceptor');\n  }\n\n  /**\n   * @ngInject\n   */\n  AuthInterceptor.$inject = ['$window', '$q'];\n  function AuthInterceptor($window, $q) {\n    return {\n      response: function(response) {\n        // When expecting JSON but receiving HTML, assume session has expired and reload page\n        if (response && /^application\\/json/.test(response.config.headers.Accept) &&\n            /^[\\n\\r ]*<!DOCTYPE html>/.test(response.data)) {\n          $window.location.reload(true);\n          return $q.reject();\n        }\n        return response;\n      }\n    };\n  }\n\n  /**\n   * @ngInject\n   */\n  ErrorInterceptor.$inject = ['$rootScope', '$window', '$q', '$injector'];\n  function ErrorInterceptor($rootScope, $window, $q, $injector) {\n    return {\n      responseError: function(rejection) {\n        var deferred, iframe;\n        if (/^application\\/json/.test(rejection.config.headers.Accept)) {\n          // Handle CAS ticket renewal\n          if ($window.usesCASAuthentication && rejection.status == -1) {\n            deferred = $q.defer();\n            iframe = angular.element('<iframe class=\"ng-hide\" src=\"' + UserFolderURL + 'recover\"></iframe>');\n            iframe.on('load', function() {\n              // Once the browser has followed the redirection, send the initial request\n              var $http = $injector.get('$http');\n              $http(rejection.config).then(deferred.resolve, deferred.reject);\n              iframe.remove();\n            });\n            document.body.appendChild(iframe[0]);\n            return deferred.promise;\n          }\n          else {\n            // Broadcast the response error\n            $rootScope.$broadcast('http:Error', rejection);\n          }\n        }\n        return $q.reject(rejection);\n      }\n    };\n  }\n\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n/*\n * https://github.com/angular/material/issues/1269\n * https://gist.github.com/senthilprabhut/dd2147ebabc89bf223e7\n */\n\n(function() {\n  'use strict';\n\n  var _$mdThemingProvider;\n\n  angular\n    .module('mdColors', ['ngMaterial'])\n    .config(configure)\n    .run(runBlock);\n\n  /**\n   * @ngInject\n   */\n  configure.$inject = ['$mdThemingProvider'];\n  function configure($mdThemingProvider) {\n    _$mdThemingProvider = $mdThemingProvider;\n  }\n  \n  /**\n   * @ngInject\n   */\n  runBlock.$inject = ['$interpolate', '$document', '$log'];\n  function runBlock($interpolate, $document, $log) {\n\n    function buildCssSelectors(selectors) {\n      var result = selectors.join('');\n      return result;\n    }\n\n    var fgDefault    = $interpolate(buildCssSelectors(['.md-{{theme}}-theme','.md-fg'])                              + ' { color:{{value}};}'),\n        bgDefault    = $interpolate(buildCssSelectors(['.md-{{theme}}-theme','.md-bg'])                              + ' { background-color:{{value}};}'),\n        bdrDefault   = $interpolate(buildCssSelectors(['.md-{{theme}}-theme','.md-bdr'])                             + ' { border-color:{{value}};}'),\n        fgDefaultHue = $interpolate(buildCssSelectors(['.md-{{theme}}-theme','.md-{{hue}}','.md-fg'])                + ' { color:{{value}};}'),\n        bgDefaultHue = $interpolate(buildCssSelectors(['.md-{{theme}}-theme','.md-{{hue}}','.md-bg'])                + ' { background-color:{{value}};}'),\n        fgColor      = $interpolate(buildCssSelectors(['.md-{{theme}}-theme','.md-{{palette}}','.md-fg'])            + ' { color:{{value}};}'),\n        bgColor      = $interpolate(buildCssSelectors(['.md-{{theme}}-theme','.md-{{palette}}','.md-bg'])            + ' { background-color:{{value}}; color:{{contrast}} !important; }'),\n        bdrColor     = $interpolate(buildCssSelectors(['.md-{{theme}}-theme','.md-{{palette}}','.md-bdr'])           + ' { border-color:{{value}};}'),\n        fgHue        = $interpolate(buildCssSelectors(['.md-{{theme}}-theme','.md-{{palette}}.md-{{hue}}','.md-fg']) + ' { color:{{value}};}'),\n        bgHue        = $interpolate(buildCssSelectors(['.md-{{theme}}-theme','.md-{{palette}}.md-{{hue}}','.md-bg']) + ' { background-color:{{value}};}'),\n        customSheet  = getStyleSheet(),\n        index = 0;\n\n    // Clear out old rules from stylesheet\n    while (customSheet.cssRules.length > 0 ) {\n      customSheet.deleteRule(0);\n    }\n    angular.forEach(_$mdThemingProvider._THEMES, function(theme, themeName){\n      // Add default selectors - primary is the default palette\n      addRule(fgDefault, bgDefault, themeName, 'primary',\n              _$mdThemingProvider._PALETTES[theme.colors.primary.name][theme.colors.primary.hues.default]);\n      addRule(fgDefaultHue, bgDefaultHue, themeName, 'primary',\n              _$mdThemingProvider._PALETTES[theme.colors.primary.name][theme.colors.primary.hues['hue-2'] ], 'hue-2');\n      addRule(fgDefaultHue, bgDefaultHue, themeName, 'primary',\n              _$mdThemingProvider._PALETTES[theme.colors.primary.name][theme.colors.primary.hues['hue-3'] ], 'hue-3');\n      addRule(fgDefaultHue, bgDefaultHue, themeName, 'primary',\n              _$mdThemingProvider._PALETTES[theme.colors.primary.name][theme.colors.primary.hues['hue-1'] ], 'hue-1');\n      addBorderRule(bdrDefault, themeName, 'primary',\n                    _$mdThemingProvider._PALETTES[theme.colors.primary.name][theme.colors.primary.hues.default]);\n\n      // Add selectors for palettes - accent, background, primary and warn\n      angular.forEach(theme.colors, function(color, paletteName){\n        addRule(fgColor, bgColor, themeName, paletteName, _$mdThemingProvider._PALETTES[color.name][color.hues.default]);\n        addBorderRule(bdrColor, themeName, paletteName, _$mdThemingProvider._PALETTES[color.name][color.hues.default]);\n        addRule(fgHue, bgHue, themeName, paletteName, _$mdThemingProvider._PALETTES[color.name][color.hues['hue-2'] ], 'hue-2');\n        addRule(fgHue, bgHue, themeName, paletteName, _$mdThemingProvider._PALETTES[color.name][color.hues['hue-3'] ], 'hue-3');\n        addRule(fgHue, bgHue, themeName, paletteName, _$mdThemingProvider._PALETTES[color.name][color.hues['hue-1'] ], 'hue-1');\n      });\n\n      //$log.debug(_.map(customSheet.cssRules, 'cssText').join(\"\\n\"));\n    });\n\n    function addRule(fgInterpolate, bgInterpolate, themeName, paletteName, colorArray, hueName){\n      // Set up interpolation functions to build css rules.\n      if (!colorArray) return;\n      var colorValue = 'rgb(' + colorArray.value[0] + ',' + colorArray.value[1] + ',' + colorArray.value[2] + ')',\n          colorContrast = 'rgb(' + colorArray.contrast[0] + ',' + colorArray.contrast[1] + ',' + colorArray.contrast[2] + ')',\n          context = {\n            theme: themeName,\n            palette: paletteName,\n            value: colorValue,\n            contrast: colorContrast,\n            hue: hueName\n          };\n\n      // Insert foreground color rule\n      customSheet.insertRule(fgInterpolate(context), index);\n      index += 1;\n\n      // Insert background color rule\n      customSheet.insertRule(bgInterpolate(context), index);\n      index += 1;\n    }\n\n    function addBorderRule(bdrInterpolate, themeName, paletteName, colorArray, hueName){\n      // Set up interpolation functions to build css rule for border color.\n      if (!colorArray) return;\n      var colorValue = 'rgb(' + colorArray.value[0] + ',' + colorArray.value[1] + ',' + colorArray.value[2] + ')';\n\n      customSheet.insertRule(bdrInterpolate({\n        theme: themeName,\n        palette: paletteName,\n        value: colorValue,\n        hue: hueName\n      }), index);\n      index += 1;\n    }\n\n    function getStyleSheet() {\n      // function to add a dynamic style-sheet to the document\n      var style = $document[0].head.querySelector('style[title=\"Dynamic-Generated-by-mdColors\"]');\n      if (style === null) {\n        style = $document[0].createElement('style');\n        style.title = 'Dynamic-Generated-by-mdColors';\n        // WebKit hack... (not sure if still needed)\n        style.appendChild($document[0].createTextNode(''));\n        $document[0].head.appendChild(style);\n      }\n      return style.sheet;\n    }\n  }\n\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n/**\n * @type {angular.Module}\n */\n(function () {\n  'use strict';\n\n  /**\n   * @ngInject\n   */\n  decodeUri.$inject = ['$window'];\n  function decodeUri($window) {\n    return $window.decodeURIComponent;\n  }\n\n  angular.module('SOGo.Common')\n    .filter('decodeUri', decodeUri);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n/**\n * @type {angular.Module}\n */\n(function () {\n  'use strict';\n\n  /**\n   * @ngInject\n   */\n  encodeUri.$inject = ['$window'];\n  function encodeUri($window) {\n    return $window.encodeURIComponent;\n  }\n\n  angular.module('SOGo.Common')\n    .filter('encodeUri', encodeUri);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function () {\n  'use strict';\n\n  /**\n   * ensureTarget - A filter to set a blank target to all links.\n   * @memberof SOGo.Common\n   * @ngInject\n   * @example:\n\n   <div ng-bind-html=\"part.content | ensureTarget\"><!-- msg --></div>\n  */\n  ensureTarget.$inject = ['$sce'];\n  function ensureTarget($sce) {\n    return function(element) {\n      var tree = angular.element('<div>' + element + '</div>');\n      tree.find('a').attr('target', '_blank');\n      return $sce.trustAs('html', tree.html());\n    };\n  }\n\n  angular.module('SOGo.Common')\n    .filter('ensureTarget', ensureTarget);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n/**\n * range - A simple filter that will return an array of the size of its argument.\n * @memberof SOGo.Common\n */\n(function () {\n  'use strict';\n\n  function last() {\n    return function(a) {\n      return _.last(a);\n    };\n  }\n\n  angular.module('SOGo.Common')\n    .filter('last', last);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n/**\n * loc - A simple filter to return the localized version of a string.\n * @memberof SOGo.Common\n */\n(function () {\n  'use strict';\n\n  /**\n   * @ngInject\n   */\n  function loc() {\n    return l;\n  }\n\n  angular.module('SOGo.Common')\n    .filter('loc', loc);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n/**\n * range - A simple filter that will return an array of the size of its argument.\n * @memberof SOGo.Common\n */\n(function () {\n  'use strict';\n\n  function range() {\n    return function(n) {\n      var res = [];\n      for (var i = 0; i < parseInt(n); i++) {\n        res.push(i);\n      }\n      return res;\n    };\n  }\n\n  angular.module('SOGo.Common')\n    .filter('range', range);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n/**\n * stripTags - A dumb filter to remove HTML tags from a string.\n * @memberof SOGo.Common\n */\n(function () {\n  'use strict';\n\n  /**\n   * @ngInject\n   */\n  function stripTags() {\n    return function(text) {\n      return text ? String(text).replace(/<[^>]+>/gm, '') : '';\n    };\n  }\n\n  angular.module('SOGo.Common')\n    .filter('stripTags', stripTags);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n/**\n * txt2html - A filter to convert line feeds and carriage returns to html line breaks\n * @memberof SOGo.Common\n */\n(function () {\n  'use strict';\n\n  /**\n   * @ngInject\n   */\n  txt2html.$inject = ['linkyFilter'];\n  function txt2html(linkyFilter) {\n    return function(text) {\n      // Linky will first sanitize the text; linefeeds are therefore encoded.\n      return text ? String(linkyFilter(text, ' _blank')).replace(/&#10;/gm, '<br>') : undefined;\n    };\n  }\n\n  angular.module('SOGo.Common')\n    .filter('txt2html', txt2html);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n/**\n * url - A simple filter to ensure a string to be a URL.\n * @memberof SOGo.Common\n */\n(function () {\n  'use strict';\n\n  /**\n   * @ngInject\n   */\n  function url() {\n    return function(url) {\n      return url.indexOf('://') < 0 ? 'http://' + url : url;\n    };\n  }\n\n  angular.module('SOGo.Common')\n    .filter('url', url);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * @ngInject\n   */\n  AclController.$inject = ['$document', '$timeout', '$mdDialog', 'Dialog', 'usersWithACL', 'User', 'folder'];\n  function AclController($document, $timeout, $mdDialog, Dialog, usersWithACL, User, folder) {\n    var vm = this;\n\n    vm.users = usersWithACL; // ACL users\n    vm.folder = folder;\n    vm.selectedUser = null;\n    vm.selectedUid = null;\n    vm.userToAdd = '';\n    vm.searchText = '';\n    vm.folderClassName = folderClassName;\n    vm.templateName = templateName;\n    vm.userFilter = userFilter;\n    vm.closeModal = closeModal;\n    vm.saveModal = saveModal;\n    vm.confirmChange = confirmChange;\n    vm.removeUser = removeUser;\n    vm.addUser = addUser;\n    vm.selectAllRights = selectAllRights;\n    vm.selectUser = selectUser;\n    vm.showRights = showRights;\n    vm.confirmation = { showing: false,\n                        message: ''};\n\n    function folderClassName() {\n      if (angular.isFunction(folder.getClassName))\n        return folder.getClassName('bg');\n      else\n        return false;\n    }\n\n    function templateName(user) {\n      // Check if user is anonymous and if a specific template must be used\n      var isAnonymous = $document[0].getElementById('UIxAnonymousUserRightsEditor') && user.$isAnonymous();\n      return 'UIx' + (isAnonymous? 'Anonymous' : '') + 'UserRightsEditor';\n    }\n\n    function userFilter($query) {\n      return User.$filter($query, folder.$acl.users);\n    }\n\n    function closeModal() {\n      folder.$acl.$resetUsersRights(); // cancel changes\n      $mdDialog.hide();\n    }\n\n    function saveModal() {\n      folder.$acl.$saveUsersRights().then(function() {\n        $mdDialog.hide();\n      }, function(data, status) {\n        Dialog.alert(l('Warning'), l('An error occured please try again.'));\n      });\n    }\n\n    function confirmChange(user) {\n      var confirmation = user.$confirmRights(vm.folder);\n      if (confirmation) {\n        vm.confirmation.showing = true;\n        vm.confirmation.message = confirmation;\n      }\n    }\n\n    function removeUser(user) {\n      $timeout(function() {\n        folder.$acl.$removeUser(user.uid);\n      }, 500); // wait for CSS transition to complete (see card.scss)\n    }\n\n    function addUser(data) {\n      if (data) {\n        folder.$acl.$addUser(data).then(function(user) {\n          vm.userToAdd = '';\n          vm.searchText = '';\n          vm.selectedUid = null;\n          if (user)\n            selectUser(user);\n        });\n      }\n    }\n\n    function selectAllRights(user) {\n      folder.$acl.$selectAllRights(user);\n    }\n\n    function selectUser(user, $event) {\n      if ($event && $event.target.parentNode.classList.contains('md-secondary'))\n        return false;\n      if (vm.selectedUid == user.uid) {\n        vm.selectedUid = null;\n      }\n      else {\n        vm.selectedUid = user.uid;\n        vm.selectedUser = user;\n        if (!user.inactive)\n          vm.selectedUser.$rights();\n      }\n    }\n\n    function showRights(user) {\n      return vm.selectedUid == user.uid && !user.inactive;\n    }\n  }\n\n  angular\n    .module('SOGo.Common')\n    .controller('AclController', AclController);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  /* jshint validthis: true */\n  'use strict';\n\n  /**\n   * @ngInject\n   */\n  navController.$inject =  ['$rootScope', '$scope', '$timeout', '$interval', '$http', '$window', '$mdSidenav', '$mdToast', '$mdMedia', '$log', 'sgConstant', 'sgSettings', 'Resource', 'Alarm'];\n  function navController($rootScope, $scope, $timeout, $interval, $http, $window, $mdSidenav, $mdToast, $mdMedia, $log, sgConstant, sgSettings, Resource, Alarm) {\n    var resource = new Resource(sgSettings.baseURL(), sgSettings.activeUser());\n\n    this.$onInit = function() {\n      $scope.isPopup = sgSettings.isPopup;\n      $scope.activeUser = sgSettings.activeUser();\n      $scope.baseURL = sgSettings.baseURL();\n      $scope.leftIsClose = !$mdMedia(sgConstant['gt-md']);\n      // Don't hide the center list when on a small device\n      $scope.centerIsClose = !!$window.centerIsClose && !$scope.leftIsClose;\n\n      // Show current day in top bar\n      $scope.currentDay = window.currentDay;\n      $timeout(function() {\n        // Update date when day ends\n        $interval(function() {\n          $http.get('../date').then(function(data) {\n            $scope.currentDay = data;\n          });\n        }, 24 * 3600 * 1000);\n      }, window.currentDay.secondsBeforeTomorrow * 1000);\n\n      // Track the 1024px window width threashold\n      $scope.$watch(function() {\n        return $mdMedia(sgConstant['gt-md']);\n      }, function(newVal) {\n        $scope.isGtMedium = newVal;\n        if (newVal) {\n          $scope.leftIsClose = false;\n        }\n      });\n\n      // Listen to HTTP errors broadcasted from HTTP interceptor\n      $rootScope.$on('http:Error', onHttpError);\n\n      if (sgSettings.activeUser('path').calendar) {\n        // Fetch Calendar alarms\n        Alarm.getAlarms();\n      }\n    };\n\n    $scope.toggleLeft = function() {\n      if ($scope.isGtMedium) {\n        // Left sidenav is toggled while sidenav is locked open; bypass $mdSidenav\n        $scope.leftIsClose = !$scope.leftIsClose;\n      }\n      else {\n        $scope.leftIsClose = leftIsClose();\n        // Fire a window resize when opening the sidenav on a small device.\n        // This is a fix until the following issue is officially resolved:\n        // https://github.com/angular/material/issues/7309\n        if ($scope.leftIsClose)\n          angular.element($window).triggerHandler('resize');\n        $mdSidenav('left').toggle()\n          .then(function () {\n            $log.debug(\"toggle left is done\");\n          });\n      }\n    };\n    $scope.toggleRight = function() {\n      $mdSidenav('right').toggle()\n        .then(function () {\n          $log.debug(\"toggle right is done\");\n        });\n    };\n    $scope.toggleCenter = function(options) {\n      $scope.centerIsClose = !$scope.centerIsClose;\n      if (options && options.save)\n        resource.post(null, 'saveListState', { state: $scope.centerIsClose? 'collapse' : 'rise' });\n    };\n    // $scope.openBottomSheet = function() {\n    //   $mdBottomSheet.show({\n    //     parent: angular.element(document.getElementById('left-sidenav')),\n    //     templateUrl: 'bottomSheetTemplate.html'\n    //   });\n    // };\n    // $scope.toggleDetailView = function() {\n    //   var detail = angular.element(document.getElementById('detailView'));\n    //   detail.toggleClass('sg-close');\n    // };\n\n    function leftIsClose() {\n      return !$mdSidenav('left').isOpen();\n    }\n\n    function onHttpError(event, response) {\n      var message;\n      if (response.data && response.data.message && angular.isString(response.data.message))\n        message = response.data.message;\n      else if (response.status)\n        message = response.statusText;\n\n      if (message)\n        $mdToast.show({\n          template: [\n            '<md-toast>',\n            '  <div class=\"md-toast-content\">',\n            '    <md-icon class=\"md-warn md-hue-1\">error_outline</md-icon>',\n            '    <span flex>' + l(message) + '</span>',\n            '  </div>',\n            '</md-toast>'\n          ].join(''),\n          hideDelay: 5000,\n          position: 'top right'\n        });\n      else\n        $log.debug('untrap error');\n    }\n  }\n\n  angular.module('SOGo.Common')\n    .controller('navController', navController);\n})();\n","(function() {\n  'use strict';\n\n  /**\n   * @name Acl\n   * @constructor\n   * @param {String} folderId - the folder ID associated to the ACLs\n   */\n  function Acl(folderId) {\n    this.folderId = folderId;\n  }\n\n  /**\n   * @memberof Acl\n   * @desc The factory we'll use to register with Angular.\n   * @return the Acl constructor\n   */\n  Acl.factory = ['$q', '$timeout', 'sgSettings', 'Resource', 'User', function($q, $timeout, Settings, Resource, User) {\n    angular.extend(Acl, {\n      $q: $q,\n      $timeout: $timeout,\n      $$resource: new Resource(Settings.activeUser('folderURL'), Settings.activeUser()),\n      $User: User\n    });\n\n    return Acl;\n  }];\n\n  /**\n   * @module SOGo.Common\n   * @desc Factory registration of User in Angular module.\n   */\n  angular.module('SOGo.Common').factory('Acl', Acl.factory);\n\n  /**\n   * @function $users\n   * @memberof Acl.prototype\n   * @param {Object} owner - the owner to use when fetching the ACL as it might not be the Settings.activeUser\n   * @desc Fetch the list of users that have specific rights for the current folder.\n   * @return a promise of an array of User objects\n   */\n  Acl.prototype.$users = function(owner) {\n    var _this = this,\n        deferred = Acl.$q.defer(),\n        user;\n    if (this.users) {\n      deferred.resolve(this.users);\n    }\n    else {\n      var acls;\n      if (angular.isDefined(owner))\n        acls = Acl.$$resource.userResource(owner).fetch(this.folderId, 'acls');\n      else\n        acls = Acl.$$resource.fetch(this.folderId, 'acls');\n\n      return acls.then(function(response) {\n        _this.users = [];\n        //console.debug(JSON.stringify(users, undefined, 2));\n        angular.forEach(response.users, function(data) {\n          user = new Acl.$User(data);\n          user.canSubscribeUser = user.isSubscribed;\n          user.wasSubscribed = user.isSubscribed;\n          user.$rights = angular.bind(user, user.$acl, _this.folderId, owner);\n          _this.users.push(user);\n        });\n        deferred.resolve(_this.users);\n        return _this.users;\n      });\n    }\n    return deferred.promise;\n  };\n\n  /**\n   * @function $addUser\n   * @memberof Acl.prototype\n   * @param {Object} user - a User object with minimal set of attributes (uid, isGroup, cn, c_email)\n   * @param {Object} owner - the owner to use when fetching the ACL as it might not be the Settings.activeUser\n   * @see {@link User.$filter}\n   */\n  Acl.prototype.$addUser = function(user, owner) {\n    var _this = this,\n        deferred = Acl.$q.defer(),\n        param = {uid: user.uid};\n    if (!user.uid || _.indexOf(_.map(this.users, 'uid'), user.uid) > -1) {\n      // No UID specified or user already in ACLs\n      deferred.resolve();\n    }\n    else {\n      var acls;\n\n      if (angular.isDefined(owner))\n        acls = Acl.$$resource.userResource(owner).fetch(this.folderId, 'addUserInAcls', param);\n      else\n        acls = Acl.$$resource.fetch(this.folderId, 'addUserInAcls', param);\n\n      acls.then(function() {\n        user.wasSubscribed = false;\n        user.userClass = user.isGroup ? 'normal-group' : 'normal-user';\n        user.$rights = angular.bind(user, user.$acl, _this.folderId, owner);\n        _this.users.push(user);\n        deferred.resolve(user);\n      }, function(data, status) {\n        deferred.reject(l('An error occured please try again.'));\n      });\n    }\n    return deferred.promise;\n  };\n\n  /**\n   * @function $removeUser\n   * @memberof Acl.prototype\n   * @desc Remove a user from the folder's ACL\n   * @return a promise of the server call to remove the user from the folder's ACL\n   */\n  Acl.prototype.$removeUser = function(uid, owner) {\n    var _this = this,\n        param = {uid: uid},\n        acls;\n\n    if (angular.isDefined(owner))\n      acls = Acl.$$resource.userResource(owner).fetch(this.folderId, 'removeUserFromAcls', param);\n    else\n      acls = Acl.$$resource.fetch(this.folderId, 'removeUserFromAcls', param);\n\n    return acls.then(function() {\n      var i = _.indexOf(_.map(_this.users, 'uid'), uid);\n      if (i >= 0) {\n        _this.users[i].$shadowRights = null;\n        _this.users.splice(i, 1);\n      }\n    });\n  };\n\n  /**\n   * @function $selectAllRights\n   * @memberof Acl.prototype\n   * @desc Select all rights of an user\n   */\n  Acl.prototype.$selectAllRights = function(user) {\n      _.forEach(user.rights, function(value, right) {\n        if (angular.isNumber(user.rights[right]))\n          user.rights[right] = 1;\n        else\n          user.rights[right] = \"Modifier\";\n    });\n  };\n\n  /**\n   * @function $resetUsersRights\n   * @memberof Acl.prototype\n   * @desc Restore initial rights of all users.\n   */\n  Acl.prototype.$resetUsersRights = function() {\n    angular.forEach(this.users, function(user) {\n      user.$resetRights();\n    });\n  };\n\n  /**\n   * @function $saveUsersRights\n   * @memberof Acl.prototype\n   * @desc Save user rights that have changed and subscribe users that have been selected.\n   * @param {Object} owner - the owner to use when fetching the ACL as it might not be the Settings.activeUser\n   * @return a promise that resolved only if the modifications and subscriptions were successful\n   */\n  Acl.prototype.$saveUsersRights = function(owner) {\n    var _this = this,\n        deferredSave = Acl.$q.defer(),\n        deferredSubscribe = Acl.$q.defer(),\n        param = {action: 'saveUserRights'},\n        users = [];\n\n    // Save user rights\n    angular.forEach(this.users, function(user) {\n      if (user.$rightsAreDirty()) {\n        users.push(user.$omit());\n        // console.debug('save ' + JSON.stringify(user.$omit(), undefined, 2));\n      }\n    });\n    if (users.length) {\n      var acls;\n\n      if (angular.isDefined(owner))\n        acls = Acl.$$resource.userResource(owner).save(this.folderId, users, param);\n      else\n        acls = Acl.$$resource.save(this.folderId, users, param);\n\n      acls.then(function() {\n          // Save was successful; copy rights to shadow rights\n          angular.forEach(_this.users, function(user) {\n            if (user.$rightsAreDirty()) {\n              user.$shadowRights = angular.copy(user.rights);\n            }\n          });\n          deferredSave.resolve();\n        }, deferredSave.reject);\n    }\n    else {\n      deferredSave.resolve();\n    }\n\n    // Subscribe users\n    users = [];\n    angular.forEach(this.users, function(user) {\n      if (!user.wasSubscribed && user.isSubscribed) {\n        users.push(user.uid);\n        // console.debug('subscribe ' + user.uid);\n      }\n    });\n    if (users.length) {\n      param = {uids: users.join(',')};\n      Acl.$$resource.fetch(this.folderId, 'subscribeUsers', param)\n        .then(function() {\n          // Subscribe was successful; reset \"wasSubscribed\" attribute\n          angular.forEach(_this.users, function(user) {\n            user.wasSubscribed = user.isSubscribed;\n          });\n          deferredSubscribe.resolve();\n        }, deferredSubscribe.reject);\n    }\n    else {\n      deferredSubscribe.resolve();\n    }\n    return Acl.$q.all([deferredSave.promise, deferredSubscribe.promise]);\n  };\n\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * @name Alarm\n   * @constructor\n   */\n  function Alarm() {\n    this.currentAlarm = null;\n  }\n\n  /**\n   * @name getAlarms\n   * @desc Fetch the list of alarms from the server and use the last one\n   */\n  Alarm.getAlarms = function() {\n    var _this = this;\n    var now = new Date();\n    var browserTime = Math.floor(now.getTime()/1000);\n\n    this.$$resource.fetch('', 'alarmslist?browserTime=' + browserTime).then(function(data) {\n      \n      var alarms = data.alarms.sort(function reverseSortByAlarmTime(a, b) {\n        var x = parseInt(a[2]);\n        var y = parseInt(b[2]);\n        return (y - x);\n      });\n\n      if (alarms.length > 0) {\n        var next = alarms.pop();\n        var now = new Date();\n        var utc = Math.floor(now.getTime()/1000);\n        var url = next[0] + '/' + next[1];\n        var alarmTime = parseInt(next[2]);\n        var delay = alarmTime;\n        if (alarmTime > 0) delay -= utc;\n        var d = new Date(alarmTime*1000);\n        //console.log (\"now = \" + now.toUTCString());\n        //console.log (\"next event \" + url + \" in \" + delay + \" seconds (on \" + d.toUTCString() + \")\");\n\n        var f = angular.bind(_this, Alarm.showAlarm, url);\n\n        if (_this.currentAlarm)\n          _this.$timeout.cancel(_this.currentAlarm);\n\n        _this.currentAlarm = _this.$timeout(f, delay*1000);\n      }\n    });\n  };\n  \n  /**\n   * @name showAlarm\n   * @desc Show the latest alarm using a toast\n   * @param url The URL of the calendar component for snoozing\n   */\n  Alarm.showAlarm = function(url) {\n    var _this = this;\n\n    this.$$resource.fetch(url, '?resetAlarm=yes').then(function(data) {\n      _this.$toast.show({\n        position: 'top right',\n        hideDelay: 0,\n        template: [\n          '<md-toast>',\n          '  <div class=\"md-toast-content\">',\n          '    <div layout=\"column\" layout=\"start end\">',\n          '      <p class=\"sg-padded--top\">{{ summary }}</p>',\n          '      <div layout=\"row\" layout-align=\"start center\">',\n          '        <md-input-container>',\n          '          <label style=\"color: white\">{{ \"Snooze for \" | loc }}</label>',\n          '          <md-select ng-model=\"reminder\">',\n          '           <md-option value=\"5\">',\n                        l('5 minutes'),\n          '           </md-option>',\n          '           <md-option value=\"10\">',\n                        l('10 minutes'),\n          '           </md-option>',\n          '           <md-option value=\"15\">',\n                        l('15 minutes'),\n          '           </md-option>',\n          '           <md-option value=\"30\">',\n                        l('30 minutes'),\n          '           </md-option>',\n          '           <md-option value=\"45\">',\n                        l('45 minutes'),\n          '           </md-option>',\n          '           <md-option value=\"60\">',\n                        l('1 hour'),\n          '           </md-option>',\n          '           <md-option value=\"1440\">',\n                        l('1 day'),\n          '           </md-option>',\n          '         </md-select>',\n          '        </md-input-container>',\n          '        <md-button ng-click=\"snooze()\">',\n                     l('Snooze'),\n          '        </md-button>',\n          '        <md-button ng-click=\"close()\">',\n                     l('Close'),\n          '        </md-button>',\n          '      </div>',\n          '    </div>',\n          '  </div>',\n          '</md-toast>'\n        ].join(''),\n        locals: {\n          url: url\n        },\n        controller: AlarmController\n      });\n\n      /**\n       * @ngInject\n       */\n      AlarmController.$inject = ['scope', '$mdToast', 'url'];\n      function AlarmController(scope, $mdToast, url) {\n        scope.summary = data.summary;\n        scope.reminder = '10';\n        scope.close = function() {\n          $mdToast.hide();\n        };\n        scope.snooze = function() {\n          _this.$$resource.fetch(url, 'view?snoozeAlarm=' + scope.reminder);\n          $mdToast.hide();\n        };\n      }\n    });\n  };\n\n  /**\n   * @memberof Alarm\n   * @desc The factory we'll register as Alarm in the Angular module SOGo.Common\n   * @ngInject\n   */\n  AlarmService.$inject = ['$timeout', 'sgSettings', 'Resource', '$mdToast'];\n  function AlarmService($timeout, Settings, Resource, $mdToast) {\n    angular.extend(Alarm, {\n      $timeout: $timeout,\n      $$resource: new Resource(Settings.activeUser('folderURL') + 'Calendar', Settings.activeUser()),\n      $toast: $mdToast\n    });\n\n    return Alarm; // return constructor\n  }\n\n  /* Factory registration in Angular module */\n  angular\n    .module('SOGo.Common')\n    .factory('Alarm', AlarmService);\n\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n/* JavaScript for Authentication */\n\n(function() {\n  /* jshint validthis: true */\n  'use strict';\n\n  angular.module('SOGo.Authentication', ['ngCookies'])\n\n    .constant('passwordPolicyConfig', {\n      PolicyPasswordChangeUnsupported: -3,\n      PolicyPasswordSystemUnknown: -2,\n      PolicyPasswordUnknown: -1,\n      PolicyPasswordExpired: 0,\n      PolicyAccountLocked: 1,\n      PolicyChangeAfterReset: 2,\n      PolicyPasswordModNotAllowed: 3,\n      PolicyMustSupplyOldPassword: 4,\n      PolicyInsufficientPasswordQuality: 5,\n      PolicyPasswordTooShort: 6,\n      PolicyPasswordTooYoung: 7,\n      PolicyPasswordInHistory: 8,\n      PolicyNoError: 65535\n    })\n\n  .provider('Authentication', Authentication);\n\n  function Authentication() {\n    function redirectUrl(username, domain) {\n      var userName, address, baseAddress, parts, hostpart, protocol, newAddress;\n\n      userName = username;\n      if (domain)\n        userName += '@' + domain.value;\n      address = '' + window.location.href;\n      baseAddress = ApplicationBaseURL + encodeURIComponent(userName);\n      if (baseAddress[0] == '/') {\n        parts = address.split('/');\n        hostpart = parts[2];\n        protocol = parts[0];\n        baseAddress = protocol + '//' + hostpart + baseAddress;\n      }\n      if (address.startsWith(baseAddress) && !address.endsWith('/logoff'))\n        newAddress = address;\n      else\n        newAddress = baseAddress;\n\n      return newAddress;\n    }\n\n    this.$get = getService;\n\n    /**\n     * @ngInject\n     */\n    getService.$inject = ['$q', '$http', '$cookies', 'passwordPolicyConfig'];\n    function getService($q, $http, $cookies, passwordPolicyConfig) {\n      var service;\n\n      function readLoginCookie() {\n        var loginValues = null,\n            cookie = $cookies.get('0xHIGHFLYxSOGo'),\n            value;\n        if (cookie && cookie.length > 8) {\n          value = decodeURIComponent(cookie.substr(8));\n          loginValues = value.base64decode().split(':');\n        }\n\n        return loginValues;\n      }\n\n      service = {\n        login: function(data) {\n          var d = $q.defer(),\n              username = data.username,\n              password = data.password,\n              domain = data.domain,\n              language,\n              rememberLogin = data.rememberLogin ? 1 : 0;\n\n          if (data.loginSuffix && !username.endsWith(data.loginSuffix)) {\n            username += loginSuffix;\n            domain = false;\n          }\n          if (data.language && data.language != 'WONoSelectionString') {\n            language = data.language;\n          }\n\n          $http({\n            method: 'POST',\n            url: '/SOGo/connect',\n            data: {\n              userName: username,\n              password: password,\n              domain: domain,\n              language: language,\n              rememberLogin: rememberLogin\n            }\n          }).then(function(response) {\n            var data = response.data;\n            // Make sure browser's cookies are enabled\n            var loginCookie = readLoginCookie();\n            if (!loginCookie) {\n              d.reject(l('cookiesNotEnabled'));\n            }\n            else {\n              // Check password policy\n              if (typeof data.expire != 'undefined' && typeof data.grace != 'undefined') {\n                if (data.expire < 0 && data.grace > 0) {\n                  d.reject({grace: data.grace});\n                  //showPasswordDialog('grace', createPasswordGraceDialog, data['grace']);\n                } else if (data.expire > 0 && data.grace == -1) {\n                  d.reject({expire: data.expire});\n                  //showPasswordDialog('expiration', createPasswordExpirationDialog, data['expire']);\n                }\n                else {\n                  d.resolve({ cn: data.cn, url: redirectUrl(username, domain) });\n                }\n              }\n              else {\n                d.resolve({ url: redirectUrl(username, domain) });\n              }\n            }\n          }, function(response) {\n            var msg, perr, data = response.data;\n            if (data && data.LDAPPasswordPolicyError) {\n              perr = data.LDAPPasswordPolicyError;\n              if (perr == passwordPolicyConfig.PolicyNoError) {\n                msg = l('Wrong username or password.');\n              }\n              else if (perr == passwordPolicyConfig.PolicyAccountLocked) {\n                msg = l('Your account was locked due to too many failed attempts.');\n              }\n              else {\n                msg = l('Login failed due to unhandled error case: ') + perr;\n              }\n            }\n            else {\n              msg = l('Unhandled error response');\n            }\n            d.reject({error: msg});\n          });\n          return d.promise;\n        }, // login: function(data) { ...\n\n        changePassword: function(newPassword) {\n          var d = $q.defer(),\n              loginCookie = readLoginCookie(),\n              xsrfCookie = $cookies.get('XSRF-TOKEN');\n\n          $cookies.remove('XSRF-TOKEN', {path: '/SOGo/'});\n\n          $http({\n            method: 'POST',\n            url: '/SOGo/so/changePassword',\n            headers: {\n              'X-XSRF-TOKEN' : xsrfCookie\n            },\n            data: {\n              userName: loginCookie[0],\n              password: loginCookie[1],\n              newPassword: newPassword }\n          }).then(d.resolve, function(response) {\n            var error,\n                data = response.data,\n                perr = data.LDAPPasswordPolicyError;\n\n            if (!perr) {\n              perr = passwordPolicyConfig.PolicyPasswordSystemUnknown;\n              error = _(\"Unhandled error response\");\n            }\n            else if (perr == passwordPolicyConfig.PolicyNoError) {\n              error = l(\"Password change failed\");\n            } else if (perr == passwordPolicyConfig.PolicyPasswordModNotAllowed) {\n              error = l(\"Password change failed - Permission denied\");\n            } else if (perr == passwordPolicyConfig.PolicyInsufficientPasswordQuality) {\n              error = l(\"Password change failed - Insufficient password quality\");\n            } else if (perr == passwordPolicyConfig.PolicyPasswordTooShort) {\n              error = l(\"Password change failed - Password is too short\");\n            } else if (perr == passwordPolicyConfig.PolicyPasswordTooYoung) {\n              error = l(\"Password change failed - Password is too young\");\n            } else if (perr == passwordPolicyConfig.PolicyPasswordInHistory) {\n              error = l(\"Password change failed - Password is in history\");\n            } else {\n              error = l(\"Unhandled policy error: %{0}\").formatted(perr);\n              perr = passwordPolicyConfig.PolicyPasswordUnknown;\n            }\n\n            // Restore the cookie\n            $cookies.put('XSRF-TOKEN', xsrfCookie, {path: '/SOGo/'});\n            d.reject(error);\n          });\n          return d.promise;\n        }\n      };\n      return service;\n    }\n  }\n\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * @name Dialog\n   * @constructor\n   */\n  function Dialog() {\n  }\n\n  /**\n   * @name alert\n   * @desc Show an alert dialog box with a single \"OK\" button\n   * @param {string} title\n   * @param {string} content\n   */\n  Dialog.alert = function(title, content) {\n    var alert = this.$modal.alert()\n        .title(title)\n        .htmlContent(content)\n        .ok(l('OK'))\n        .multiple(true);\n    this.$modal.show(alert);\n  };\n\n  /**\n   * @name confirm\n   * @desc Show a confirmation dialog box with buttons 'Cancel' and 'OK'\n   * @param {string} title\n   * @param {string} content\n   * @returns a promise that resolves if the user has clicked on the 'OK' button\n   */\n  Dialog.confirm = function(title, content, options) {\n    var confirm = this.$modal.confirm()\n        .title(title)\n        .htmlContent(content)\n        .ok((options && options.ok)? options.ok : l('OK'))\n        .cancel((options && options.cancel)? options.cancel : l('Cancel'));\n    return this.$modal.show(confirm);\n  };\n\n  /**\n   * @name prompt\n   * @desc Show a primpt dialog box with a input text field and the 'Cancel' and 'OK' buttons\n   * @param {string} title\n   * @param {string} label\n   * @param {object} [options] - use a different input type by setting 'inputType'\n   * @returns a promise that resolves with the input field value\n   */\n  Dialog.prompt = function(title, label, options) {\n    var o = options || {},\n        id = title.asCSSIdentifier(),\n        d = this.$q.defer();\n\n    this.$modal.show({\n      parent: angular.element(document.body),\n      clickOutsideToClose: true,\n      escapeToClose: true,\n      template: [\n        '<md-dialog flex=\"50\" flex-xs=\"90\">',\n        '  <form name=\"' + id + 'Form\" ng-submit=\"ok()\">',\n        '    <md-dialog-content class=\"md-dialog-content\" layout=\"column\">',\n        '      <h2 class=\"md-title\" ng-bind=\"title\"></h2>',\n        '      <md-input-container>',\n        '        <label>' + label + '</label>',\n        '        <input type=\"' + (o.inputType || 'text') + '\"',\n        '               aria-label=\"' + title + '\"',\n        '               ng-model=\"name\" md-autofocus=\"true\" required />',\n        '      </md-input-container>',\n        '    </md-dialog-content>',\n        '    <md-dialog-actions>',\n        '      <md-button ng-click=\"cancel()\">',\n        '        ' + l('Cancel'),\n        '      </md-button>',\n        '      <md-button type=\"submit\" class=\"md-primary\" ng-disabled=\"' + id + 'Form.$invalid\">',\n        '        ' + l('OK'),\n        '      </md-button>',\n        '    </md-dialog-actions>',\n        '  </form>',\n        '</md-dialog>'\n      ].join(''),\n      controller: PromptDialogController\n    });\n\n    /**\n     * @ngInject\n     */\n    PromptDialogController.$inject = ['scope', '$mdDialog'];\n    function PromptDialogController(scope, $mdDialog) {\n      scope.title = title;\n      scope.name = \"\";\n      scope.cancel = function() {\n        d.reject();\n        $mdDialog.hide();\n      };\n      scope.ok = function() {\n        d.resolve(scope.name);\n        $mdDialog.hide();\n      };\n    }\n\n    return d.promise;\n  };\n\n  /**\n   * @memberof Dialog\n   * @desc The factory we'll register as Dialog in the Angular module SOGo.Common\n   * @ngInject\n   */\n  DialogService.$inject = ['$q', '$mdDialog'];\n  function DialogService($q, $mdDialog) {\n    angular.extend(Dialog, { $q: $q , $modal: $mdDialog });\n\n    return Dialog; // return constructor\n  }\n\n  /* Factory registration in Angular module */\n  angular\n    .module('SOGo.Common')\n    .factory('Dialog', DialogService);\n\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * Gravatar - A service to build the Gravatar URL for an email address\n   * @memberof SOGo.Common\n   * @param {string} email\n   * @param {number} [size] - the size of the image\n   * @param {string} alternate avatar to use (none, identicon, monsterid, wavatar, retro)\n   * @ngInject\n   */\n  function Gravatar() {\n    return function(email, size, alternate_avatar, options) {\n      var x, y, hash, s = size, a = alternate_avatar;\n      if (!email) {\n        return '';\n      }\n      x = email.indexOf('<');\n      if (x >= 0) {\n        y = email.indexOf('>', x);\n        if (y > x)\n          email = email.substring(x+1,y);\n      }\n      if (!size) {\n        s = 48; // default to 48 pixels\n      }\n      hash = email.md5();\n\n      if (!a || a == \"none\") {\n        if (options && options.no_404)\n          alternate_avatar = \"mm\"; // mystery man alternative\n        else\n          alternate_avatar = \"404\";\n      }\n\n      return 'https://www.gravatar.com/avatar/' + hash + '?s=' + s + '&d=' + alternate_avatar;\n    };\n  }\n\n  angular\n    .module('SOGo.Common')\n    .factory('Gravatar', Gravatar);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * @name Resource\n   * @constructor\n   * @param {Object} $http - the Angular HTTP service\n   * @param {Object} $q - the Angular promise/deferred service\n   * @param {String} path - the base path of the external resource\n   * @param {Object} options - extra attributes to be associated to the object\n   */\n  function Resource($http, $q, path, activeUser, options) {\n    angular.extend(this, {\n      _http: $http,\n      _q: $q,\n      _path: path,\n      _activeUser: activeUser\n    });\n    angular.extend(this, options);\n    // Trim trailing slash\n    this._path = this._path.replace(/\\/$/, '');\n  }\n\n  /**\n   * @memberof Resource\n   * @desc The factory we'll use to register with Angular.\n   * @return a new Resource object\n   */\n  Resource.$factory =  ['$http', '$q', function($http, $q) {\n    return function(path, activeUser, options) {\n      return new Resource($http, $q, path, activeUser, options);\n    };\n  }];\n\n  /**\n   * @module SOGo.Common\n   * @desc Factory registration of Resource in Angular module.\n   */\n  angular.module('SOGo.Common').factory('Resource', Resource.$factory);\n\n  /**\n   * @function userResource\n   * @memberof Resource.prototype\n   * @desc Create a new Resource object associated to a username different than the active user.\n   * @param {String} uid - the user UID\n   * @return a new Resource object\n   */\n  Resource.prototype.userResource = function(uid) {\n    var path = _.compact(this._activeUser.folderURL.split('/'));\n\n    if (uid)\n      path.splice(path.length - 1, 1, escape(uid));\n\n    return new Resource(this._http, this._q, '/' + path.join('/'), this._activeUser);\n  };\n\n  /**\n   * @function path\n   * @memberof Resource.prototype\n   * @desc Create a URL of the resource context with any number of additional segments\n   * @return an absolute URL\n   */\n  Resource.prototype.path = function() {\n    var path = [this._path];\n\n    if (arguments.length > 0)\n      Array.prototype.push.apply(path, Array.prototype.slice.call(arguments));\n\n    return path.join('/');\n  };\n\n  /**\n   * @function fetch\n   * @memberof Resource.prototype\n   * @desc Fetch resource using a specific folder, action and/or parameters.\n   * @param {string} folderId - the folder on which the action will be applied (ex: addressbook, calendar)\n   * @param {string} action - the action to be used in the URL\n   * @param {Object} params - Object parameters injected through the $http service\n   * @return a promise\n   */\n  Resource.prototype.fetch = function(folderId, action, params) {\n    var deferred = this._q.defer(),\n        path = [this._path];\n    if (folderId) path.push(folderId.split('/'));\n    if (action)   path.push(action);\n    path = _.compact(_.flatten(path)).join('/');\n\n    this._http({\n      method: 'GET',\n      url: path,\n      params: params\n    })\n      .then(function(response) {\n        return deferred.resolve(response.data);\n      }, deferred.reject);\n\n    return deferred.promise;\n  };\n\n  /**\n   * @function newguid\n   * @memberof Resource.prototype\n   * @desc Fetch a new GUID on the specified folder ID.\n   * @return a promise of the new data structure\n   */\n  Resource.prototype.newguid = function(folderId) {\n    var deferred = this._q.defer(),\n        path = this._path + '/' + folderId + '/newguid';\n\n    this._http\n      .get(path)\n      .then(function(response) {\n        return deferred.resolve(response.data);\n      }, deferred.reject);\n\n    return deferred.promise;\n  };\n\n  /**\n   * @function create\n   * @memberof Resource.prototype\n   * @desc Create a new resource using a specific action (post).\n   * @param {string} action - the action to be used in the URL\n   * @param {string} name - the new resource's name\n   * @return a promise\n   */\n  Resource.prototype.create = function(action, name) {\n    var deferred = this._q.defer(),\n        path = this._path + '/' + action;\n\n    this._http\n      .post(path, { name: name })\n      .then(function(response) {\n        return deferred.resolve(response.data);\n      }, deferred.reject);\n\n    return deferred.promise;\n  };\n\n  /**\n   * @function post\n   * @memberof Resource.prototype\n   * @desc Post a resource attributes on the server.\n   * @return a promise\n   */\n  Resource.prototype.post = function(id, action, data) {\n    var deferred = this._q.defer(),\n        path = [this._path];\n    if (id) path.push(id);\n    if (action) path.push(action);\n    path = _.compact(_.flatten(path)).join('/');\n\n    this._http\n      .post(path, data)\n      .then(function(response) {\n        return deferred.resolve(response.data);\n      }, deferred.reject);\n\n    return deferred.promise;\n  };\n\n  /**\n   * @function save\n   * @memberof Resource.prototype\n   * @desc Save a resource attributes on the server (post /save).\n   * @return a promise\n   */\n  Resource.prototype.save = function(id, newValue, options) {\n    var action = (options && options.action)? options.action : 'save';\n\n    return this.post(id, action, newValue);\n  };\n\n  /**\n   * @function download\n   * @memberof Resource.prototype\n   * @desc Download a file from the server. Requires FileSaver.js.\n   * @see {@link http://blog.davidjs.com/2015/07/download-files-via-post-request-in-angularjs/|Download files via POST request in AngularJs}\n   * @see {@link https://github.com/eligrey/FileSaver.js|FileSaver.js}\n   * @return a promise\n   */\n  Resource.prototype.download = function(id, action, data, options) {\n    var deferred = this._q.defer(),\n        type = (options && options.type)? options.type : 'application/zip',\n        path = [this._path];\n    if (id) path.push(id);\n    if (action) path.push(action);\n    path = _.compact(_.flatten(path)).join('/');\n\n    function getFileNameFromHeader(header) {\n      var result;\n\n      if (!header) return null;\n      result = header.split(\";\")[1].trim().split(\"=\")[1];\n\n      return result.replace(/\"/g, '');\n    }\n\n    return this._http({\n      method: 'POST',\n      url: path,\n      data: data,\n      headers: {\n        accept: type\n      },\n      responseType: 'arraybuffer',\n      cache: false,\n      transformResponse: function (data, headers, status) {\n        var fileName, result, blob = null;\n\n        if (status < 200 || status > 299) {\n          throw new Error('Bad gateway');\n        }\n        if (data) {\n          blob = new Blob([data], { type: type });\n        }\n        if (options && options.filename) {\n          fileName = options.filename;\n        }\n        else {\n          getFileNameFromHeader(headers('content-disposition'));\n        }\n        if (!saveAs) {\n          throw new Error('To use Resource.download, FileSaver.js must be loaded.');\n        }\n        else {\n          saveAs(blob, fileName);\n        }\n      }\n    });\n  };\n\n  /**\n   * @function remove\n   * @memberof Resource.prototype\n   * @desc Delete a resource (get /delete).\n   * @return a promise\n   */\n  Resource.prototype.remove = function(uid) {\n    var deferred = this._q.defer(),\n        path = this._path + '/' + uid + '/delete';\n\n    this._http\n      .get(path)\n      .then(function(response) {\n        return deferred.resolve(response.data);\n      }, deferred.reject);\n\n    return deferred.promise;\n  };\n\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n  \n  /**\n   * sgFocus - A service to set the focus on the element associated to a specific string\n   * @memberof SOGo.Common\n   * @param {string} name - the string identifier of the element\n   * @see {@link SOGo.Common.sgFocusOn}\n   * @ngInject\n  */\n  sgFocus.$inject = ['$rootScope', '$timeout'];\n  function sgFocus($rootScope, $timeout) {\n    return function(name) {\n      $timeout(function() {\n        $rootScope.$broadcast('sgFocusOn', name);\n      });\n    };\n  }\n\n  angular\n    .module('SOGo.Common')\n    .factory('sgFocus', sgFocus);\n})();\n","/* -*- Mode: js; indent-tabs-mode: nil; js-indent-level: 2 -*- */\n\n(function() {\n  /* jshint validthis: true */\n  'use strict';\n\n  /**\n   * $sgHotkeys - A service to associate keyboard shortcuts to actions.\n   * @memberof SOGo.Common\n   *\n   * @description\n   * This service is a modified version of angular-hotkeys-light by Eugene Brodsky:\n   * https://github.com/fupslot/angular-hotkeys-light\n   */\n  function $sgHotkeys() {\n\n    // Key-code values for various meta-keys.\n    // Source : http://www.cambiaresearch.com/articles/15/javascript-char-codes-key-codes\n    //          http://unixpapa.com/js/key.html\n    // Date: Oct 02, 2015.\n    var KEY_CODES = {\n      8: 'backspace',\n      9: 'tab',\n      13: 'enter',\n      16: 'shift',\n      17: 'ctrl',\n      18: 'alt',\n      19: 'pause',\n      20: 'caps',\n      27: 'escape',\n      32: 'space',\n      33: 'pageup',\n      34: 'pagedown',\n      35: 'end',\n      36: 'home',\n      37: 'left',\n      38: 'up',\n      39: 'right',\n      40: 'down',\n      45: 'insert',\n      46: 'delete',\n      // Numpad\n      96: '0',\n      97: '1',\n      98: '2',\n      99: '3',\n      100: '4',\n      101: '5',\n      102: '6',\n      103: '7',\n      104: '8',\n      105: '9',\n      106: '*',\n      107: '+',\n      109: '-',\n      110: '.',\n      111: '/',\n      // Function keys\n      112: 'f1',\n      113: 'f2',\n      114: 'f3',\n      115: 'f4',\n      116: 'f5',\n      117: 'f6',\n      118: 'f7',\n      119: 'f8',\n      120: 'f9',\n      121: 'f10',\n      122: 'f11',\n      123: 'f12'\n    };\n    // Char-code values for characters that require a key combinations\n    var CHAR_CODES = {\n      42: '*',\n      63: '?'\n    };\n\n    this.$get = getService;\n\n    getService.$inject = ['$rootScope', '$window'];\n    function getService($rootScope, $window) {\n\n      var wrapWithApply = function (fn) {\n        return function(event, args) {\n          $rootScope.$apply(function() {\n            fn.call(this, event, args);\n          }.bind(this));\n        };\n      };\n\n      var HotKey = function(params) {\n        this.id = params.id || guid();\n        this.key = params.key;\n        this.description = params.description || null;\n        this.context = params.context || null;\n        this.callback = params.callback;\n        this.preventInClass = params.preventInClass;\n        this.args = params.args;\n        this.onKeyUp = false;\n\n        if (this.key.length > 1)\n          // Automatically translate common hotkeys\n          this.lkey = l('key_' + this.key);\n      };\n\n      HotKey.prototype.clone = function() {\n        return new HotKey(this);\n      };\n\n      var Hotkeys = function() {\n        /**\n         * Sometimes a UI wants keybindings which are global, so called hotkeys.\n         * Keys are keystrings (identify key combinations) and values are objects\n         * with keys callback, context.\n         */\n        this._hotkeys = {};\n\n        /**\n         * Sometimes a UI wants keybindings for keyup behaviour.\n         */\n        this._hotkeysUp = {};\n\n        /**\n         * Keybindings are ignored by default when coming from a form input field.\n         */\n        this._preventIn = ['INPUT', 'SELECT', 'TEXTAREA', 'MD-OPTION'];\n\n        /**\n         * Keybindings are ignored by default when coming from special elements\n         */\n        this._preventInClass = ['md-chip-content'];\n\n        this._onKeydown = this._onKeydown.bind(this);\n        this._onKeyup = this._onKeyup.bind(this);\n        this._onKeypress = this._onKeypress.bind(this);\n\n        this.initialize();\n      };\n\n      /**\n       * Binds Keydown, Keyup with the window object\n       */\n      Hotkeys.prototype.initialize = function() {\n        this.registerHotkey(\n          this.createHotkey({\n            key: '?',\n            description: l('Show or hide this help'),\n            callback: this._toggleCheatSheet.bind(this)\n          })\n        );\n\n        $window.addEventListener('keydown', this._onKeydown, true);\n        $window.addEventListener('keyup', this._onKeyup, true);\n        $window.addEventListener('keypress', this._onKeypress, true);\n      };\n\n      /**\n       * Invokes callback functions assosiated with the given hotkey\n       * @param  {Event} event\n       * @param  {String} keyString hotkey\n       * @param  {Array.<HotKey>} hotkeys List of registered callbacks for\n       *                                  the given hotkey\n       * @private\n       */\n      Hotkeys.prototype._invokeHotkeyHandlers = function(event, keyString, hotkeys) {\n        for (var i = 0, l = hotkeys.length; i < l; i++) {\n          var hotkey = hotkeys[i],\n              target = event.target || event.srcElement,\n              nodeName = target.nodeName.toUpperCase();\n          if (!_.includes(this._preventIn, nodeName) &&\n              _.intersection(target.classList, this._preventInClass).length === 0 &&\n              _.intersection(target.classList, hotkey.preventInClass).length === 0) {\n            try {\n              hotkey.callback.call(hotkey.context, event, hotkey.args);\n            } catch(e) {\n              console.error('HotKeys: ', hotkey.key, e.message);\n            }\n          }\n        }\n      };\n\n      /**\n       * Keydown Event Handler\n       * @private\n       */\n      Hotkeys.prototype._onKeydown = function(event) {\n        var keyString = this.keyStringFromEvent(event);\n        if (this._hotkeys[keyString]) {\n          this._invokeHotkeyHandlers(event, keyString, this._hotkeys[keyString]);\n        }\n      };\n\n      /**\n       * Keyup Event Handler\n       * @private\n       */\n      Hotkeys.prototype._onKeyup = function(event) {\n        var keyString = this.keyStringFromEvent(event);\n        if (this._hotkeysUp[keyString]) {\n          this._invokeHotkeyHandlers(this._hotkeysUp[keyString], keyString);\n        }\n      };\n\n      /**\n       * Keypress Event Handler\n       * @private\n       */\n      Hotkeys.prototype._onKeypress = function(event) {\n        var charCode, keyString;\n\n        charCode = event.keyCode || event.which;\n        keyString = CHAR_CODES[charCode];\n        if (keyString && this._hotkeys[keyString]) {\n          this._invokeHotkeyHandlers(event, keyString, this._hotkeys[keyString]);\n        }\n      };\n\n      /**\n      * Cross-browser method which can extract a key string from an event.\n      * Key strings are of the form\n      *\n      *   ctrl+alt+shift+meta+character\n      *\n      * where each of the 4 modifiers may or may not appear, but always appear\n      * in that order if they do appear.\n      *\n      * TODO : this is not yet implemented fully. The trouble is, the keyCode,\n      * charCode, and which properties of the DOM standard KeyboardEvent are\n      * discouraged in favour of the use of key and char, but key and char are\n      * not yet implemented in Gecko nor in Blink/Webkit. We need to leverage\n      * keyCode/charCode so that current browser versions are supported, but also\n      * look to key and char because they're apparently more useful and are the\n      * future.\n      */\n      Hotkeys.prototype.keyStringFromEvent = function(event) {\n        var result = [];\n        var key = event.which;\n\n        if (KEY_CODES[key]) {\n          key = KEY_CODES[key];\n        } else {\n          key = String.fromCharCode(key).toLowerCase();\n        }\n\n        if (event.ctrlKey)  { result.push('ctrl');  }\n        if (event.altKey)   { result.push('alt');   }\n        if (event.shiftKey) { result.push('shift'); }\n        if (event.metaKey)  { result.push('meta');  }\n        result.push(key);\n        return _.uniq(result).join('+');\n      };\n\n      /**\n      * Unregister a hotkey (shortcut) helper for (keyUp/keyDown).\n      *\n      * @param {String}   params.key      - valid key string.\n      */\n      Hotkeys.prototype._deregisterHotkey = function(hotkey) {\n        var ret;\n        var table = this._hotkeys;\n\n        if (hotkey.onKeyUp) {\n          table = this._hotkeysUp;\n        }\n\n        if (table[hotkey.key]) {\n          var callbackArray = table[hotkey.key];\n          for (var i = 0; i < callbackArray.length; ++i) {\n            var callbackData = callbackArray[i];\n            if ((hotkey.callback === callbackData.callback &&\n                 callbackData.context === hotkey.context) ||\n                (hotkey.id === callbackData.id)) {\n              ret = callbackArray.splice(i, 1);\n            }\n          }\n          if (callbackArray.length === 0)\n            delete this._hotkeys[hotkey.key];\n        }\n        return ret;\n      };\n\n      /**\n       * Unregister hotkeys\n       * @param  {Hotkey}  hotkey A hotkey object\n       * @return {Array}\n       */\n      Hotkeys.prototype.deregisterHotkey = function(hotkey) {\n        var result = [];\n\n        this._validateHotkey(hotkey);\n\n        if (angular.isArray(hotkey.key)) {\n          for (var i = hotkey.key.length - 1; i >= 0; i--) {\n            var clone = hotkey.clone();\n            clone.key = hotkey.key[i];\n            var ret = this._deregisterHotkey(clone);\n            if (ret !== void 0) {\n              result.push(ret[0]);\n            }\n          }\n        } else {\n          result.push(this._deregisterHotkey(hotkey));\n        }\n        return result;\n      };\n\n      /**\n       * Validate HotKey type\n       */\n      Hotkeys.prototype._validateHotkey = function(hotkey) {\n        if (!(hotkey instanceof HotKey)) {\n          throw new TypeError('Hotkeys: Expected a hotkey object be instance of HotKey');\n        }\n      };\n\n      /**\n      * Register a hotkey (shortcut) helper for (keyUp/keyDown).\n      * @param {Object} params Parameters object\n      * @param {String}   params.key      - valid key string.\n      * @param {Function} params.callback - routine to run when key is pressed.\n      * @param {Object}   params.context  - @this value in the callback.\n      * @param [Boolean]  params.onKeyUp  - if this is intended for a keyup.\n      * @param [String]   params.id       - the identifier for this registration.\n      */\n      Hotkeys.prototype._registerKey = function(hotkey) {\n        var table = this._hotkeys;\n\n        if (hotkey.onKeyUp) {\n          table = this._hotkeysUp;\n        }\n\n        table[hotkey.key] = table[hotkey.key] || [];\n        table[hotkey.key].push(hotkey);\n        return hotkey;\n      };\n\n      Hotkeys.prototype._registerKeys = function(hotkey) {\n        var result = [];\n\n        if (angular.isArray(hotkey.key)) {\n          for (var i = hotkey.key.length - 1; i >= 0; i--) {\n            var clone = hotkey.clone();\n            clone.id = guid();\n            clone.key = hotkey.key[i];\n            result.push(this._registerKey(clone));\n          }\n        } else {\n          result.push(this._registerKey(hotkey));\n        }\n        return result;\n      };\n\n      /**\n      * Register a hotkey (shortcut). see _registerHotKey\n      */\n      Hotkeys.prototype.registerHotkey = function(hotkey) {\n        this._validateHotkey(hotkey);\n        return this._registerKeys(hotkey);\n      };\n\n      /**\n      * Register a hotkey (shortcut) keyup behavior.\n      * see _registerHotKey\n      */\n      Hotkeys.prototype.registerHotkeyUp = function(hotkey) {\n        this._validateHotkey(hotkey);\n        hotkey.onKeyUp = true;\n        this._registerKeys(hotkey);\n      };\n\n      /**\n       * Creates new hotkey object.\n       * @param  {Object} args\n       * @return {HotKey}\n       */\n      Hotkeys.prototype.createHotkey = function(args) {\n        if (args.key === null || args.key === void 0) {\n          throw new TypeError('HotKeys: Argument \"key\" is required');\n        }\n\n        if (args.callback === null || args.callback === void 0) {\n          throw new TypeError('HotKeys: Argument \"callback\" is required');\n        }\n\n        args.callback = wrapWithApply(args.callback);\n        return new HotKey(args);\n      };\n\n      /**\n       * Checks if given shortcut match the event\n       * @param  {Event} event An event\n       * @param  {String|Array} key A shortcut\n       * @return {Boolean}\n       */\n      Hotkeys.prototype.match = function(event, key) {\n        if (!angular.isArray(key)) {\n          key = [key];\n        }\n\n        var eventHotkey = this.keyStringFromEvent(event);\n        return Boolean(~key.indexOf(eventHotkey));\n      };\n\n      /**\n       *  Build and display (or hide) the hotkeys cheat sheet\n       *\n       * If a hotkey is registered multiple times, only the description of the first registered\n       * hotkey is displayed.\n       */\n      Hotkeys.prototype._toggleCheatSheet = function() {\n        var _this = this;\n\n        if (this._cheatSheet) {\n          Hotkeys.$modal.hide();\n          this._cheatSheet = null;\n        }\n        else {\n          this._cheatSheet = Hotkeys.$modal\n            .show({\n              clickOutsideToClose: true,\n              escapeToClose: true,\n              template: [\n                '<md-dialog>',\n                '  <md-dialog-content>',\n                '    <md-list>',\n                '      <md-list-item ng-repeat=\"(hotkey, keys) in hotkeys\">',\n                '        <div class=\"sg-hotkey-container\">',\n                '          <sg-hotkey>{{keys[0].lkey || hotkey}}</sg-hotkey>',\n                '        </div>',\n                '        {{keys[0].description}}',\n                '      </md-list-item>',\n                '    </md-list>',\n                '  </md-dialog-content>',\n                '</md-dialog>'\n              ].join(''),\n              controller: CheatSheetController,\n              locals: {\n                hotkeys: _this._hotkeys\n              }\n            })\n            .finally(function() {\n              _this._cheatSheet = null;\n            });\n        }\n\n        CheatSheetController.$inject = ['$scope', 'hotkeys'];\n        function CheatSheetController($scope, hotkeys) {\n          $scope.hotkeys = hotkeys;\n          $scope.closeDialog = function() {\n            Hotkeys.$modal.hide();\n          };\n        }\n      };\n\n      return Hotkeys;\n    }\n  }\n\n  sgHotkeys.$inject = ['$mdDialog', '$sgHotkeys'];\n  function sgHotkeys($mdDialog, $sgHotkeys) {\n    angular.extend($sgHotkeys, { $modal: $mdDialog });\n\n    return new $sgHotkeys();\n  }\n\n  angular\n    .module('SOGo.Common')\n    .service('sgHotkeys', sgHotkeys)\n    .provider('$sgHotkeys', $sgHotkeys);\n})();\n","(function() {\n  'use strict';\n\n  /**\n   * @name User\n   * @constructor\n   * @param {object} [userData] - some default values for the user\n   */\n  function User(userData) {\n    if (userData) {\n      this.init(userData);\n    }\n  }\n\n  /**\n   * @memberof User\n   * @desc The factory we'll use to register with Angular.\n   * @return the User constructor\n   */\n  User.factory = ['$q', '$log', 'sgSettings', 'Resource', function($q, $log, Settings, Resource) {\n    angular.extend(User, {\n      $q: $q,\n      $log: $log,\n      $$resource: new Resource(Settings.activeUser('folderURL'), Settings.activeUser()),\n      $query: '',\n      $users: []\n    });\n\n    return User;\n  }];\n\n  /**\n   * @module SOGo.Common\n   * @desc Factory registration of User in Angular module.\n   */\n  angular.module('SOGo.Common').factory('User', User.factory);\n\n  /**\n   * @memberof User\n   * @desc Search for users that match a string.\n   * @param {string} search - a string used to performed the search\n   * @param {object[]} excludedUsers - a list of User objects that must be excluded from the results\n   * @return a promise of an array of matching User objects\n   */\n  User.$filter = function(search, excludedUsers, options) {\n    var _this = this, resource = User.$$resource, param = {search: search};\n\n    if (!options || !options.dry) {\n      if (!search) {\n        // No query specified\n        User.$users.splice(0, User.$users.length);\n        return User.$q.when(User.$users);\n      }\n      if (User.$query == search) {\n        // Query hasn't changed\n        return User.$q.when(User.$users);\n      }\n      User.$query = search;\n    }\n    else if (options && options.uid) {\n      resource = User.$$resource.userResource(options.uid);\n    }\n\n    return resource.fetch(null, 'usersSearch', param).then(function(response) {\n      var results, index, user, users,\n          compareUids = function(data) {\n            return this.uid == data.uid;\n          };\n\n      if (options) {\n        if (options.dry)\n          users = [];\n        else if (options.results)\n          users = options.results;\n      }\n      else\n        users = User.$users;\n\n      if (excludedUsers) {\n        // Remove excluded users from response\n        results = _.filter(response.users, function(user) {\n          return !_.find(excludedUsers, _.bind(compareUids, user));\n        });\n      }\n      else {\n        results = response.users;\n      }\n\n      // Remove users that no longer match the search query\n      for (index = users.length - 1; index >= 0; index--) {\n        user = users[index];\n        if (!_.find(results, _.bind(compareUids, user))) {\n          users.splice(index, 1);\n        }\n      }\n      // Add new users matching the search query\n      _.forEach(results, function(data, index) {\n        if (_.isUndefined(_.find(users, _.bind(compareUids, data)))) {\n          var user = new User(data);\n          users.splice(index, 0, user);\n        }\n      });\n      User.$log.debug(users);\n      return users;\n    });\n  };\n\n  /**\n   * @function init\n   * @memberof User.prototype\n   * @desc Extend instance with required attributes and new data.\n   * @param {object} data - attributes of user\n   */\n  User.prototype.init = function(data) {\n    angular.extend(this, data);\n    if (!this.$$shortFormat)\n      this.$$shortFormat = this.$shortFormat();\n    if (!this.$$image)\n      this.$$image = this.image;\n    this.$avatarIcon = (this.$isGroup() || this.$isSpecial()) ? 'group' : 'person';\n    // NOTE: We can't assign a Gravatar at this stage since we would need the Preferences module\n    // which already depend on the User module.\n\n    // An empty attribute to trick md-autocomplete when adding users from the ACLs editor\n    this.empty = ' ';\n  };\n\n  /**\n   * @function $fullname\n   * @memberof User.prototype\n   * @return a string representing the fullname\n   */\n  User.prototype.$fullname = function() {\n    var fullname = this.cn || this.uid;\n\n    if (this.c_info)\n      fullname += ' (' + this.c_info.split(\"\\n\").join(\"; \") + ')';\n\n    return fullname;\n  };\n\n  /**\n   * @function $shortFormat\n   * @memberof User.prototype\n   * @return the fullname along with the email address\n   */\n  User.prototype.$shortFormat = function(options) {\n    var fullname = this.$fullname();\n    var email = this.c_email;\n    var no_email = options && options.email === false;\n    if (!no_email && email && fullname != email) {\n      fullname += ' <' + email + '>';\n    }\n    return fullname;\n  };\n\n  /**\n   * @function $acl\n   * @memberof User.prototype\n   * @desc Fetch the user rights associated to a specific folder and populate the 'rights' attribute.\n   * @param {string} the folder ID\n   * @param {Object} owner - the owner to use when fetching the ACL as it might not be the Settings.activeUser\n   * @return a promise\n   */\n  User.prototype.$acl = function(folderId, owner) {\n    var _this = this,\n        deferred = User.$q.defer(),\n        param = {uid: this.uid};\n    if (this.$shadowRights) {\n      deferred.resolve(this.rights);\n    }\n    else {\n      var rights;\n\n      if (angular.isDefined(owner))\n        rights = User.$$resource.userResource(owner).fetch(folderId, 'userRights', param);\n      else\n        rights = User.$$resource.fetch(folderId, 'userRights', param);\n\n      rights.then(function(data) {\n        _this.rights = data;\n        // Convert numbers (0|1) to boolean values\n        //angular.forEach(_.keys(_this.rights), function(key) {\n        //  _this.rights[key] = _this.rights[key] ? true : false;\n        //});\n        // console.debug('rights ' + _this.uid + ' => ' + JSON.stringify(data, undefined, 2));\n        // Keep a copy of the server's version\n        _this.$shadowRights = angular.copy(data);\n        deferred.resolve(data);\n        return data;\n      });\n    }\n    return deferred.promise;\n  };\n\n  /**\n   * @function $isGroup\n   * @memberof User.prototype\n   * @return true if the user actually represents a group of users\n   */\n  User.prototype.$isGroup = function() {\n    return this.isGroup || this.userClass && this.userClass == 'normal-group';\n  };\n\n  /**\n   * @function $isAnonymous\n   * @memberof User.prototype\n   * @return true if it's the special anonymous user\n   */\n  User.prototype.$isAnonymous = function() {\n    return this.uid == 'anonymous';\n  };\n\n  /**\n   * @function $isSpecial\n   * @memberof User.prototype\n   * @desc Only accurate from the ACL editor.\n   * @return true if the user is not a regular system user\n   */\n  User.prototype.$isSpecial = function() {\n    return this.userClass && this.userClass == 'public-user';\n  };\n\n  /**\n   * @function $confirmRights\n   * @memberof User.prototype\n   * @desc Check if a confirmation is required before giving some rights.\n   * @return the confirmation message or false if no confirmation is required\n   */\n  User.prototype.$confirmRights = function(folder) {\n    var confirmation = false;\n\n    if (this.$confirmation) {\n      // Don't bother the user more than once\n      return false;\n    }\n\n    if (_.some(_.values(this.rights))) {\n      if (this.uid == 'anonymous') {\n        if (folder.constructor.name == 'AddressBook')\n          confirmation = l('Potentially anyone on the Internet will be able to access your address book \"%{0}\", even if they do not have an account on this system. Is this information suitable for the public Internet?', folder.name);\n        else if (folder.constructor.name == 'Calendar')\n          confirmation = l('Potentially anyone on the Internet will be able to access your calendar \"%{0}\", even if they do not have an account on this system. Is this information suitable for the public Internet?', folder.name);\n      }\n      else if (this.uid == 'anyone' || this.uid == '<default>') {\n        if (folder.constructor.name == 'AddressBook')\n          confirmation = l('Any user with an account on this system will be able to access your address book \"%{0}\". Are you certain you trust them all?', folder.name);\n        else if (folder.constructor.name == 'Calendar')\n          confirmation = l('Any user with an account on this system will be able to access your calendar \"%{0}\". Are you certain you trust them all?', folder.name);\n        else if (folder.constructor.name == 'Mailbox')\n          confirmation = l('Any user with an account on this system will be able to access your mailbox \"%{0}\". Are you certain you trust them all?', folder.name);\n      }\n    }\n\n    this.$confirmation = confirmation;\n\n    return confirmation;\n  };\n\n  /**\n   * @function $rightsAreDirty\n   * @memberof User.prototype\n   * @return whether or not the rights have changed from their initial values\n   */\n  User.prototype.$rightsAreDirty = function() {\n    return this.rights && !_.isEqual(this.rights, this.$shadowRights);\n  };\n\n  /**\n   * @function $resetRights\n   * @memberof User.prototype\n   * @desc Restore initial rights or disable all rights\n   * @param {boolean} [zero] - reset all rights to zero when true\n   */\n  User.prototype.$resetRights = function(zero) {\n    var _this = this;\n    if (zero) {\n      // Disable all rights\n      _.map(_.keys(this.rights), function(key) {\n        if (angular.isString(_this.rights[key]))\n          _this.rights[key] = 'None';\n        else\n          _this.rights[key] = 0;\n      });\n    }\n    else if (this.$shadowRights) {\n      // Restore initial rights\n      this.rights = angular.copy(this.$shadowRights);\n    }\n  };\n\n  /**\n   * @function $folders\n   * @memberof User.prototype\n   * @desc Retrieve the list of folders of a specific type\n   * @param {string} type - either 'contact' or 'calendar'\n   * @return a promise of the HTTP query result or the cached result\n   */\n  User.prototype.$folders = function(type) {\n    var _this = this,\n        deferred = User.$q.defer(),\n        param = {type: type};\n    if (this.$$folders) {\n      deferred.resolve(this.$$folders);\n    }\n    else {\n      User.$$resource.userResource(this.uid).fetch(null, 'foldersSearch', param).then(function(response) {\n        _this.$$folders = response.folders;\n        deferred.resolve(response.folders);\n      });\n    }\n    return deferred.promise;\n  };\n\n  /**\n   * @function $omit\n   * @memberof User.prototype\n   * @desc Return a sanitized object used to send to the server.\n   * @return an object literal copy of the User instance\n   */\n  User.prototype.$omit = function() {\n    var user = {};\n    angular.forEach(this, function(value, key) {\n      if (key != 'constructor' && key[0] != '$') {\n        user[key] = value;\n      }\n    });\n    return user;\n  };\n\n  User.prototype.toString = function() {\n    return '[User ' + this.c_email + ']';\n  };\n\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  /* jshint validthis: true, newcap: false */\n  'use strict';\n\n  /**\n   * sgAvatarImage - An avatar directive that returns un img element with either a local URL (if sg-src is specified)\n   * or a Gravatar URL built from the Gravatar factory (using sg-email). The element's content must return the name of the generic icon to be used (usually 'person' or 'group').\n   * Based on http://blog.lingohub.com/2014/08/better-ux-with-angularjs-directives/.\n   * @memberof SOGo.Common\n   * @example:\n     <sg-avatar-image sg-email=\"test@email.com\" size=\"50\">person</sg-avatar-image>\n  */\n  function sgAvatarImage() {\n    return {\n      restrict: 'AE',\n      scope: {},\n      bindToController: {\n        size: '@',\n        email: '=sgEmail',\n        src: '=sgSrc'\n      },\n      transclude: true,\n      template: [\n        '<div class=\"sg-icon-badge-container\">',\n        '  <md-icon ng-transclude></md-icon>',                              // the generic icon\n        '  <md-icon class=\"md-warn sg-icon--badge sg-icon--badge-bottom\"',\n        '           style=\"display: none\">not_interested</md-icon>',        // the inactive badge (if disabled)\n        '  <img class=\"ng-hide\" ng-src=\"{{vm.url}}\">',                      // the gravatar or local image\n        '</div>'\n      ].join(''),\n      link: link,\n      controller: 'sgAvatarImageController',\n      controllerAs: 'vm'\n    };\n\n    function link(scope, element, attrs, controller) {\n      var imgElement = element.find('img'),\n          mdIcons = element.find('md-icon'),\n          mdIconElement = angular.element(mdIcons[0]),\n          mdBadgeElement = angular.element(mdIcons[1]),\n          deregisterWatcher;\n\n      if (attrs.size) {\n        imgElement.attr('width', attrs.size);\n        imgElement.attr('height', attrs.size);\n        mdIconElement.css('font-size', attrs.size + 'px');\n        mdBadgeElement.css('font-size', parseInt(attrs.size*0.4) + 'px');\n      }\n\n      if (angular.isDefined(attrs.ngDisabled)) {\n        deregisterWatcher = scope.$watch(attrs.ngDisabled, function(isDisabled) {\n          if (attrs.disabled) {\n            mdBadgeElement.css({ display: 'block' });\n          }\n          deregisterWatcher(); // watch once\n        });\n      }\n\n      controller.img = imgElement;\n      controller.genericImg = mdIconElement;\n    }\n  }\n\n  /**\n   * @ngInject\n   */\n  sgAvatarImageController.$inject = ['$scope', '$element', '$http', '$q', 'Preferences', 'Gravatar'];\n  function sgAvatarImageController($scope, $element, $http, $q, Preferences, Gravatar) {\n    var vm, toggleZoomFcn;\n\n    vm = this;\n\n    $scope.$on('$destroy', function() {\n      if (toggleZoomFcn)\n        $element.off('click', toggleZoomFcn);\n    });\n\n    $scope.$watch(function() { return vm.email; }, function(email, old) {\n      if (email && vm.urlEmail != email) {\n        // Email has changed or doesn't match the current URL (this happens when using md-virtual-repeat)\n        showGenericAvatar();\n        if (Preferences.defaults.SOGoGravatarEnabled)\n          getGravatar(email);\n      }\n      else if (!email)\n        showGenericAvatar();\n    });\n\n    // If sg-src is defined, watch the expression for the URL of a local image\n    if ('sg-src' in $element[0].attributes) {\n      $scope.$watch(function() { return vm.src; }, function(src) {\n        if (src) {\n          // Set image URL and save the associated email address\n          vm.url = src;\n          vm.urlEmail = '' + vm.email;\n          configureZoomableAvatar();\n          hideGenericAvatar();\n        }\n      });\n    }\n\n    function getGravatar(email) {\n      var url = Gravatar(email, vm.size, Preferences.defaults.SOGoAlternateAvatar);\n      $http({\n        method: 'GET',\n        url: url,\n        cache: true,\n        headers: { Accept: 'image/*' }\n      }).then(function successCallback() {\n        if (!vm.url) {\n          // Set image URL and save the associated email address\n          vm.url = url;\n          vm.urlEmail = email;\n          hideGenericAvatar();\n        }\n      }, function errorCallback() {\n        showGenericAvatar();\n      });\n    }\n\n    function showGenericAvatar() {\n      vm.url = null;\n      vm.urlEmail = null;\n      vm.img.addClass('ng-hide');\n      vm.genericImg.removeClass('ng-hide');\n    }\n\n    function hideGenericAvatar() {\n      vm.genericImg.addClass('ng-hide');\n      vm.img.removeClass('ng-hide');\n    }\n\n    function configureZoomableAvatar() {\n      $element.addClass('sg-avatar-image--zoomable');\n      toggleZoomFcn = function() {\n        $element.toggleClass('sg-avatar-image--zoom');\n      };\n      $element.on('click', toggleZoomFcn);\n    }\n\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgAvatarImage', sgAvatarImage)\n    .controller('sgAvatarImageController', sgAvatarImageController);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /*\n   * sgBlockToggle - expandable block, collapsed by default\n   * @memberof SOGo.Common\n   * @ngInject\n   * @example:\n\n   <sg-block-toggle>\n     <md-list-item class=\"sg-button-toggle\">\n       <md-icon>warning</md-icon>\n       <p flex>{{ message }}</p>\n       <md-icon class=\"sg-icon-toggle\">expand_more</md-icon>\n     </md-list-item>\n     <div class=\"sg-block-toggle\">\n       <!-- block's content -->\n     </div>\n  */\n  sgBlockToggle.$inject = ['$mdUtil', '$animateCss', '$$rAF'];\n  function sgBlockToggle($mdUtil, $animateCss, $$rAF) {\n    return {\n      link: link\n    };\n\n    function link($scope, $element) {\n      var button = $element[0].querySelector('.sg-button-toggle'),\n          icon = button.querySelector('.sg-icon-toggle'),\n          icon_rotate_class = 'md-rotate-180-ccw',\n          block = $element[0].querySelector('.sg-block-toggle'),\n          isOpen = false;\n\n      button.classList.add('md-clickable');\n      angular.element(button).on('click', toggle);\n\n      renderContent();\n\n      function renderContent() {\n        block.setAttribute('aria-hidden', !isOpen);\n        block.setAttribute('aria-expanded', isOpen);\n        if (!isOpen)\n          block.style.visibility = 'hidden';\n      }\n\n      function toggle() {\n        isOpen = !isOpen;\n        if (isOpen)\n          icon.classList.add(icon_rotate_class);\n        else\n          icon.classList.remove(icon_rotate_class);\n\n        if (isOpen)\n          block.style.visibility = 'visible';\n\n        $$rAF(function() {\n          var targetHeight = isOpen ? block.scrollHeight : 0;\n\n          $animateCss(angular.element(block), {\n            easing: 'cubic-bezier(0.35, 0, 0.25, 1)',\n            to: { height: targetHeight + 'px' },\n            duration: 0.75 // seconds\n          }).start().then(function() {\n            renderContent();\n          });\n        });\n      }\n    }\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgBlockToggle', sgBlockToggle);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgCheckmark', sgCheckmarkDirective);\n\n  /*\n   * sgCheckmark - A checkmark to be used in a mdMenuItem\n   * @memberof SOGo.Common\n   * @restrict element\n   *\n   * @example:\n\n     <md-menu>\n       <md-button class=\"md-icon-button\" aria-label=\"Sort\"\n                  ng-click=\"$mdOpenMenu()\">\n         <md-icon>sort</md-icon>\n       </md-button>\n       <md-menu-content>\n         <md-menu-item>\n           <sg-checkmark\n               aria-label=\"Descending Order\"\n               ng-model=\"ctrl.asc\"\n               ng-click=\"ctrl.filter()\"\n               sg-true-value=\"0\"\n               sg-false-value=\"1\">Descending Order</sg-checkmark>\n         </md-menu-item>            \n       </md-menu-content>\n     </md-menu>\n  */\n  sgCheckmarkDirective.$inject = ['$parse', '$mdAria', '$mdTheming', '$mdUtil'];\n  function sgCheckmarkDirective($parse, $mdAria, $mdTheming, $mdUtil) {\n    var CHECKED_CSS = 'sg-checked';\n\n    return {\n      restrict: 'E',\n      replace: true,\n      transclude: true,\n      require: '?ngModel',\n      //priority: 210, // Run before ngAria\n      template: [\n        '<button class=\"md-button sg-checkmark\" type=\"button\">',\n        '  <md-icon>check</md-icon>',\n        '  <span ng-transclude></span',\n        '</button>'\n      ].join(''),\n      compile: compile\n    };\n\n    function compile(tElement, tAttrs) {\n\n      // Attach a click handler in compile in order to immediately stop propagation\n      // (especially for ng-click) when the checkmark is disabled.\n      tElement.on('click', function(event) {\n        if (this.hasAttribute('disabled')) {\n          event.stopImmediatePropagation();\n        }\n      });\n\n      return function postLink(scope, element, attr, ngModelCtrl) {\n        // See https://github.com/angular/angular.js/commit/c90cefe16142d973a123e945fc9058e8a874c357\n        var trueValue = parseConstantExpr($parse, scope, 'sgTrueValue', attr.sgTrueValue, true),\n            falseValue = parseConstantExpr($parse, scope, 'sgFalseValue', attr.sgFalseValue, false);\n        \n        ngModelCtrl = ngModelCtrl || $mdUtil.fakeNgModel();\n        $mdTheming(element);\n\n        $mdAria.expectWithText(element, 'aria-label');\n\n        element.on('click', listener);\n\n        ngModelCtrl.$render = render;\n\n        function parseConstantExpr($parse, context, name, expression, fallback) {\n          var parseFn;\n          if (angular.isDefined(expression)) {\n            parseFn = $parse(expression);\n            if (!parseFn.constant) {\n              throw Error('Expected constant expression for `' + name + '`, but saw `' + expression + '`.');\n            }\n            return parseFn(context);\n          }\n          return fallback;\n        }\n\n        function listener(ev) {\n          if (element[0].hasAttribute('disabled')) {\n            return;\n          }\n\n          scope.$apply(function() {\n            // Toggle the checkmark value\n            var viewValue = ngModelCtrl.$viewValue == trueValue? falseValue : trueValue;\n\n            ngModelCtrl.$setViewValue( viewValue, ev && ev.type);\n            ngModelCtrl.$render();\n          });\n        }\n\n        function render() {\n          if (ngModelCtrl.$viewValue == trueValue)\n            element.addClass(CHECKED_CSS);\n          else\n            element.removeClass(CHECKED_CSS);\n        }\n      };\n    }\n  }\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  /* jshint validthis: true */\n  'use strict';\n\n  /*\n   * sgColorPicker - Color picker widget\n   * @restrict element\n   * @ngInject\n   * @example:\n\n     <sg-color-picker ng-model=\"properties.calendar.color\"></sg-color-picker>\n  */\n  function sgColorPicker() {\n    return {\n      restrict: 'E',\n      require: 'ngModel',\n      template: [\n        '  <md-button class=\"md-icon-button\"',\n        '             label:aria-label=\"Options\"',\n        '             ng-click=\"$ctrl.showPicker($event)\">',\n        '    <md-icon>format_color_fill</md-icon>',\n        '  </md-button>'\n      ].join(''),\n      controller: sgColorPickerController,\n      controllerAs: '$ctrl'\n    };\n  }\n\n  /**\n   * @ngInject\n   */\n  sgColorPickerController.$inject = ['$scope', '$element', '$mdPanel', 'sgColors'];\n  function sgColorPickerController($scope, $element, $mdPanel, sgColors) {\n    var $ctrl, ngModelController, color;\n\n    this.$onInit = function() {\n      $ctrl = this;\n      ngModelController = $element.controller('ngModel');\n    };\n\n    this.$postLink = function() {\n      this.buttonIcon = $element.find('md-icon');\n      ngModelController.$render = function() {\n        updateColor(ngModelController.$viewValue);\n      };\n    };\n\n    function updateColor(newColor) {\n      color = newColor;\n      $ctrl.buttonIcon.css('color', color);\n    }\n\n    this.showPicker = function($event) {\n      var panelPosition = $mdPanel.newPanelPosition()\n          .relativeTo($ctrl.buttonIcon)\n          .addPanelPosition(\n            $mdPanel.xPosition.ALIGN_START,\n            $mdPanel.yPosition.ALIGN_TOPS\n          );\n\n      var panelAnimation = $mdPanel.newPanelAnimation()\n          .openFrom($ctrl.buttonIcon)\n          .duration(100)\n          .withAnimation($mdPanel.animation.FADE);\n\n      // Build grid with 7 colors per row\n      var columns = [];\n      var column = '';\n      for (var i = 0; i < sgColors.selection.length; i++) {\n        var currentColor = sgColors.selection[i];\n        var currentContrastColor = contrast(currentColor);\n        var selected = (currentColor == color);\n        if (i % 7 === 0) {\n          if (column.length) columns.push(column);\n          column = '';\n        }\n        column += '<span ';\n        if (selected)\n          column += 'class=\"selected\" ';\n        column += 'style=\"background-color: ' + currentColor + '\" ng-click=\"$menuCtrl.setColor($event, \\'' + currentColor + '\\')\">';\n        if (selected)\n          column += '<md-icon class=\"icon-check\" style=\"color: ' + currentContrastColor + '\"></md-icon>';\n        column += '</span>';\n      }\n\n      var config = {\n        attachTo: angular.element(document.body),\n        bindToController: true,\n        controller: MenuController,\n        controllerAs: '$menuCtrl',\n        position: panelPosition,\n        animation: panelAnimation,\n        targetEvent: $event,\n        template: [\n          '<div class=\"sg-color-picker-panel\" md-whiteframe=\"3\">',\n          '  <div>' + columns.join('</div><div>') + '</div>',\n          '</div>'\n        ].join(''),\n        trapFocus: true,\n        clickOutsideToClose: true,\n        escapeToClose: true,\n        focusOnOpen: true\n      };\n\n      $mdPanel.open(config)\n        .then(function(panelRef) {\n          // Automatically close panel when clicking inside of it\n          panelRef.panelEl.one('click', function() {\n            panelRef.close();\n          });\n        });\n\n      MenuController.$inject = ['mdPanelRef', '$state', '$mdDialog', 'User'];\n      function MenuController(mdPanelRef, $state, $mdDialog, User) {\n        var $menuCtrl = this;\n\n        this.setColor = function(event, color) {\n          if (event) {\n            _.forEach(event.currentTarget.parentElement.children, function(tile) {\n              tile.classList.remove('selected');\n            });\n            event.currentTarget.classList.add('selected');\n          }\n          // Update scope value and ng-model\n          updateColor(color);\n          ngModelController.$setViewValue(color);\n        };\n      }\n    };\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgColorPicker', sgColorPicker);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /*\n   * sgCompile - Assign an expression to a DOM element and compile it.\n   * @memberof SOGo.Common\n   * @restrict attribute\n   * @param {object} sgCompile - the expression to compile\n   * @ngInject\n   * @example:\n\n   <div sg-compile=\"part.content\"><!-- msg --></div>\n  */\n  sgCompile.$inject = ['$compile'];\n  function sgCompile($compile) {\n    return {\n      restrict: 'A',\n      link: sgCompileLink\n    };\n\n    function sgCompileLink(scope, element, attrs) {\n      var ensureCompileRunsOnce = scope.$watch(\n        function(scope) {\n          // Watch the sg-compile expression for changes\n          return scope.$eval(attrs.sgCompile);\n        },\n        function(value) {\n          // When the sg-compile expression changes, assign it into the current DOM\n          element.html(value);\n          \n          // Compile the new DOM and link it to the current scope.\n          // NOTE: we only compile .childNodes so that we don't get into infinite loop compiling ourselves\n          $compile(element.contents())(scope);\n          \n          // Use un-watch feature to ensure compilation happens only once.\n          ensureCompileRunsOnce();\n        }\n      );\n    }\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgCompile', sgCompile);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * sgDatepickerReadonlyInput - A directive that disabled the input field of a datepicker.\n   * @memberof SOGo.Common\n   *\n   * @example:\n\n   <md-datepicker md-hide-icons=\"triangle\"\n                  md-open-on-focus=\"md-open-on-focus\"\n                  ng-model=\"selectedDate\"\n                  sg-datepicker-readonly-input>\n  */\n  function sgDatepickerReadonlyInput() {\n    return {\n      link: postLink,\n      require: 'mdDatepicker',\n      restrict: 'A'\n    };\n\n    function postLink(scope, element, attrs, datepickerCtrl) {\n      function getInput() {\n        return element.find('input').eq(0);\n      }\n\n      // We need to wait for the autocomplete directive to be compiled\n      var listener = scope.$watch(getInput, function (input) {\n        if (input.length) {\n          listener(); // self release\n          input.prop('disabled', true);\n          input.parent().addClass('sg-datepicker-readonly-input-container');\n        }\n      });\n    }\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgDatepickerReadonlyInput', sgDatepickerReadonlyInput);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  /* jshint validthis: true */\n  'use strict';\n\n  /*\n   * sgDraggable - Make an element (usually a folder of elements) draggable.\n   * @memberof SOGo.Common\n   * @restrict attribute\n   * @param {Object=} sgDraggable - the object to be exposed to the droppable target.\n   * @param {expression} sgDragStart - dragging will only start if this expression returns true.\n   * @param {expression} sgDragCount - the number of items being dragged; this number appears inside\n   *        the sg-draggable-helper element that follows the mouse cursor.\n   *\n   * @example:\n\n   <sg-draggable-helper>\n     <md-icon>email</md-icon>\n     <sg-draggable-helper-counter></sg-draggable-helper-counter>\n   </sg-draggable-helper>\n\n   <md-list sg-draggable=\"mailbox.service.selectedFolder\"\n            sg-drag-start=\"mailbox.selectedFolder.$selectedCount()\"\n            sg-drag-count=\"mailbox.selectedFolder.$selectedCount()\">\n  */\n  sgDraggable.$inject = ['$parse', '$rootScope', '$document', '$timeout', '$log'];\n  function sgDraggable($parse, $rootScope, $document, $timeout, $log) {\n    return {\n      restrict: 'A',\n      link: link\n    };\n\n    function link(scope, element, attrs) {\n      var o;\n      \n      $timeout(function() {\n        var folder, dragStart, count;\n\n        folder = $parse(attrs.sgDraggable)(scope);\n        dragStart = attrs.sgDragStart? $parse(attrs.sgDragStart) : null;\n        count = attrs.sgDragCount? $parse(attrs.sgDragCount) : null;\n        o = new sgDraggableObject(element, folder, dragStart, count);\n      });\n\n      scope.$on('$destroy', function() {\n        o.$destroy();\n      });\n      \n      function sgDraggableObject($element, folder, dragStart, count) {\n        this.$element = $element;\n        this.folder = folder;\n        this.dragStart = dragStart;\n        this.count = count;\n        this.helper = $document.find('sg-draggable-helper');\n\n        if (!this.helper) {\n          throw Error('sg-draggable requires a sg-draggable-helper element.');\n        }\n\n        this.bindedOnDragDetect = angular.bind(this, this.onDragDetect);\n        this.bindedOnDrag = angular.bind(this, this.onDrag);\n\n        // Register the mousedown event that can trigger the dragging action\n        this.$element.on('mousedown', this.bindedOnDragDetect);\n      }\n\n      /**\n       * sgDraggableObject is an object that wraps the logic to emit the folder:dragstart and\n       * folder:dragend custom events.\n       */\n      sgDraggableObject.prototype = {\n\n        dragHasStarted: false,\n\n        $destroy: function() {\n          this.$element.off('mousedown', this.bindedOnDragDetect);\n        },\n\n        getDistanceFromStart: function(event) {\n          var delta = {\n            x: this.startPosition.clientX - event.clientX,\n            y: this.startPosition.clientY - event.clientY\n          };\n\n          return Math.sqrt(delta.x * delta.x + delta.y * delta.y);\n        },\n\n\n        // Start dragging on mousedown\n        onDragDetect: function(ev) {\n          ev.stopPropagation();\n\n          if (!this.dragStart || this.dragStart(scope)) {\n            // Listen to mousemove and start dragging when mouse has moved from at least 3 pixels\n            $document.on('mousemove', this.bindedOnDrag);\n            // Stop dragging on the next \"mouseup\"\n            $document.one('mouseup', angular.bind(this, this.onDragEnd));\n          }\n        },\n\n        // \n        onDrag: function(ev) {\n          var counter;\n\n          if (!this.startPosition) {\n            this.startPosition = { clientX: ev.clientX, clientY: ev.clientY };\n          }\n          else if (!this.dragHasStarted && this.getDistanceFromStart(ev) > 10) {\n            counter = this.helper.find('sg-draggable-helper-counter');\n            this.dragHasStarted = true;\n\n            this.helper.removeClass('ng-hide');\n            if (this.count && this.count(scope) > 1)\n              counter.text(this.count(scope)).removeClass('ng-hide');\n            else\n              counter.addClass('ng-hide');\n            \n            $log.debug('emit folder:dragstart');\n            $rootScope.$emit('folder:dragstart', this.folder);\n          }\n          if (this.dragHasStarted) {\n            if (ev.shiftKey || this.folder.isRemote)\n              this.helper.addClass('sg-draggable-helper--copy');\n            else\n              this.helper.removeClass('sg-draggable-helper--copy');\n            this.helper.css({ top: (ev.pageY + 5) + 'px', left: (ev.pageX + 5) + 'px' });\n          }\n        },\n\n\n        onDragEnd: function(ev) {\n          var action = 'move';\n\n          this.startPosition = null;\n          $document.off('mousemove', this.bindedOnDrag);\n\n          if (this.dragHasStarted) {\n            if (ev.shiftKey || this.folder.isRemote)\n              action = 'copy';\n            $log.debug('emit folder:dragend');\n            $rootScope.$emit('folder:dragend', this.folder, action);\n            this.dragHasStarted = false;\n            this.helper.addClass('ng-hide');\n          }\n        }\n\n      };\n\n    }\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgDraggable', sgDraggable);\n})();\n\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  /* jshint validthis: true */\n  'use strict';\n\n  /*\n   * sgDroppable - Make an element a possible destination while dragging\n   * @memberof SOGo.Common\n   * @restrict attribute\n   * @param {expression} sgDroppable - dropping is accepted only if this expression returs true.\n   *        One variables is exposed: dragFolder.\n   * @param {expression} sgDrop - called when dropping ends on the element.\n   *        Two variables are exposed: dragFolder and dragMode.\n   *\n   * @example:\n\n   <md-list-item sg-droppable=\"folder.id != dragFolder.id\"\n                 sg-drop=\"app.dragSelectedMessages(dragFolder, folder, dragMode)\">\n  */\n  sgDroppable.$inject = ['$parse', '$rootScope', '$document', '$timeout', '$log'];\n  function sgDroppable($parse, $rootScope, $document, $timeout, $log) {\n    return {\n      restrict: 'A',\n      link: link\n    };\n\n    function link(scope, element, attrs) {\n      var overElement = false, dropAction, droppable,\n          deregisterFolderDragStart, deregisterFolderDragEnd;\n\n      if (!attrs.sgDrop) {\n        throw Error('sg-droppable requires a sg-drop action.');\n      }\n\n      overElement = false;\n      droppable = $parse(attrs.sgDroppable);\n      dropAction = $parse(attrs.sgDrop);\n\n      // Register listeners of custom events on root scope\n      deregisterFolderDragStart = $rootScope.$on('folder:dragstart', function(event, folder) {\n        if (droppable(scope, { dragFolder: folder })) {\n          element.on('mouseenter', onEnter);\n          element.on('mouseleave', onLeave);\n        }\n      });\n      deregisterFolderDragEnd = $rootScope.$on('folder:dragend', function(event, folder, mode) {\n        element.off('mouseenter');\n        element.off('mouseleave');\n        if (overElement) {\n          angular.bind(element[0], onLeave)(event);\n          dropAction(scope, { dragFolder: folder, dragMode: mode });\n        }\n      });\n\n      scope.$on('destroy', function() {\n        deregisterFolderDragStart();\n        deregisterFolderDragEnd();\n      });\n\n      function onEnter(event) {\n        overElement = true;\n        element.addClass('sg-droppable-over');\n      }\n\n      function onLeave(event) {\n        overElement = false;\n        this.classList.remove('sg-droppable-over');\n        element.off('mousemove');\n      }\n    }\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgDroppable', sgDroppable);\n})();\n\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * sgEnter - A directive evaluated when the enter key is pressed\n   * @memberof SOGo.Common\n   * @ngInject\n   * @example:\n\n     <input type=\"text\"\n            sg-enter=\"save($index)\" />\n  */\n  function sgEnter() {\n    var ENTER_KEY = 13;\n    return function(scope, element, attrs) {\n      element.bind(\"keydown keypress\", function(event) {\n        if (event.which === ENTER_KEY) {\n          scope.$apply(attrs.sgEnter);\n          event.preventDefault();\n        }\n      });\n    };\n  }\n  \n  angular\n    .module('SOGo.Common')\n    .directive('sgEnter', sgEnter);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * sgEscape - A directive evaluated when the escape key is pressed\n   * @memberof SOGo.Common\n   * @ngInject\n   * @example:\n\n     <input type=\"text\"\n            sg-escape=\"revertEditing($index)\" />\n   */\n  function sgEscape() {\n    var ESCAPE_KEY = 27;\n    return function(scope, elem, attrs) {\n      elem.bind('keydown', function(event) {\n        if (event.keyCode === ESCAPE_KEY) {\n          scope.$apply(attrs.sgEscape);\n        }\n      });\n    };\n  }\n    \n  angular\n    .module('SOGo.Common')\n    .directive('sgEscape', sgEscape);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * sgFocusOn - A directive that sets the focus on its element when the specified string is broadcasted\n   * @memberof SOGo.Common\n   * @see {@link SOGo.Common.sgFocus}\n   * @ngInject\n   * @example:\n\n     <input type=\"text\"\n            sg-focus-on=\"username\" />\n   */\n  function sgFocusOn() {\n    return function(scope, elem, attr) {\n      scope.$on('sgFocusOn', function(e, name) {\n        if (name === attr.sgFocusOn) {\n          elem[0].focus();\n          if (typeof elem[0].select == 'function')\n            elem[0].select();\n        }\n      });\n    };\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgFocusOn', sgFocusOn);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  /* jshint validthis: true */\n  'use strict';\n\n  /*\n   * sgFolderStylesheet - Add CSS stylesheet for a folder's color (addressbook or calendar)\n   * @memberof SOGo.Common\n   * @restrict attribute\n   * @param {object} ngModel - the object literal describing the folder (an Addressbook or Calendar instance)\n   * @example:\n\n    <sg-folder-stylesheet\n         ng-repeat=\"calendar in calendars.list\"\n         ng-model=\"calendar\" />\n  */\n  function sgFolderStylesheet() {\n    return {\n      restrict: 'E',\n      require: 'ngModel',\n      scope: {\n        ngModel: '='\n      },\n      replace: true,\n      bindToController: true,\n      controller: sgFolderStylesheetController,\n      controllerAs: 'cssCtrl',\n      template: [\n        '<style type=\"text/css\">',\n        /* Background color */\n        '  .bg-folder{{ cssCtrl.ngModel.id }} {',\n        '    background-color: {{ cssCtrl.ngModel.color }} !important;',\n        '    color: {{ cssCtrl.contrast(cssCtrl.ngModel.color) }} !important;',\n        '  }',\n        '  .sg-event.bg-folder{{ cssCtrl.ngModel.id }} md-icon {',\n        '    color: {{ cssCtrl.contrast(cssCtrl.ngModel.color) }} !important;',\n        '  }',\n        // Set the contrast color of toolbar icons except the one of the background\n        '  md-toolbar.bg-folder{{ cssCtrl.ngModel.id }} md-icon:not(.sg-icon-toolbar-bg) {',\n        '    color: {{ cssCtrl.contrast(cssCtrl.ngModel.color) }} !important;',\n        '  }',\n        // Set the contrast color of input labels\n        '  .bg-folder{{ cssCtrl.ngModel.id }} label,',\n        '  .bg-folder{{ cssCtrl.ngModel.id }} .md-input {',\n        '    color: {{ cssCtrl.contrast(cssCtrl.ngModel.color) }} !important;',\n        '    opacity: 0.8;',\n        '  }',\n        /* Foreground color */\n        '  .fg-folder{{ cssCtrl.ngModel.id }},',\n        '  .sg-event.fg-folder{{ cssCtrl.ngModel.id }} md-icon {',\n        '    color: {{ cssCtrl.ngModel.color }} !important;',\n        '  }',\n        /* Border color */\n        '  .bdr-folder{{ cssCtrl.ngModel.id }} {',\n        '    border-color: {{ cssCtrl.ngModel.color }} !important;',\n        '  }',\n        '  .contrast-bdr-folder{{ cssCtrl.ngModel.id }} {',\n        '    border-color: {{ cssCtrl.contrast(cssCtrl.ngModel.color) }} !important;',\n        '  }',\n        /* Checkbox color */\n        '  .checkbox-folder{{ cssCtrl.ngModel.id }} .md-icon {',\n        '    background-color: {{ cssCtrl.ngModel.color }} !important;',\n        '  }',\n        '  .checkbox-folder{{ cssCtrl.ngModel.id }}.md-checked .md-icon:after {',\n        '    border-color: {{ cssCtrl.contrast(cssCtrl.ngModel.color) }} !important;',\n        '  }',\n        /* Switch color */\n        '  .md-switch-folder{{ cssCtrl.ngModel.id }}.md-checked .md-thumb {',\n        '    background-color: {{ cssCtrl.ngModel.color }} !important;',\n        '  }',\n        '  .md-switch-folder{{ cssCtrl.ngModel.id }}.md-checked .md-bar {',\n        '    background-color: {{ cssCtrl.transparent(cssCtrl.ngModel.color, \"0.5\") }} !important;',\n        '  }',\n        '  .md-switch-folder{{ cssCtrl.ngModel.id }} .md-bar {',\n        '    background-color: {{ cssCtrl.transparent(cssCtrl.ngModel.color, \"0.3\") }} !important;',\n        '  }',\n        '</style>'\n      ].join('')\n    };\n\n    function sgFolderStylesheetController() {\n      var vm = this;\n\n      vm.contrast = contrast; // defined in Common/utils.js\n      vm.transparent = function(hex, ratio) {\n        var color = hexToRgb(hex);\n\n        return ['rgba(' + color.r, color.g, color.b, ratio + ')'].join(',');\n      };\n    }\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgFolderStylesheet', sgFolderStylesheet);\n})();\n","/* -*- Mode: js; indent-tabs-mode: nil; js-indent-level: 2 -*- */\n\n(function() {\n  'use strict';\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgNoDirtyCheck', sgNoDirtyCheck);\n\n  /*\n   * sgNoDirtyCheck - prevent input from affecting the form's pristine state.\n   * @restrict attribute\n  */\n  function sgNoDirtyCheck() {\n    return {\n      restrict: 'A',\n      require: 'ngModel',\n      link: function (scope, elem, attrs, ngModelCtrl) {\n        if (!ngModelCtrl) {\n          return;\n        }\n\n        var clean = (ngModelCtrl.$pristine && !ngModelCtrl.$dirty);\n\n        if (clean) {\n          ngModelCtrl.$pristine = false;\n          ngModelCtrl.$dirty = true;\n        }\n      }\n    };\n  }\n\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * sgPlaceholder - A directive for dynamic placeholder\n   * @memberof SOGo.Common\n   * @ngInject\n   * @example:\n\n     <input type=\"text\"\n            sg-placeholder=\"this_is_a_variable\" />\n  */\n  function sgPlaceholder() {\n    return {\n      restrict: 'A',\n      scope: {\n        placeholder: '=sgPlaceholder'\n      },\n      link: function(scope, elem, attr) {\n        scope.$watch('placeholder',function() {\n          elem[0].placeholder = scope.placeholder;\n        });\n      }\n    };\n  }\n  \n  angular\n    .module('SOGo.Common')\n    .directive('sgPlaceholder', sgPlaceholder);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * sgResetOnDisabled - A directive to reset any error of a datepicker when marked\n   *                     as disabled.\n   * @memberof SOGo.Common\n   * @ngInject\n   * @example:\n\n   <md-datepicker\n     ng-model=\"myDate\"\n     ng-disabled=\"!myDateEnabled\"\n     sg-reset-on-disabled>\n  */\n  function sgResetOnDisabled() {\n    return {\n      link: postLink,\n      require: 'mdDatepicker',\n      restrict: 'A'\n    };\n\n    function postLink(scope, element, attrs, datepickerCtrl) {\n      function getInput() {\n        return element.find('input').eq(0);\n      }\n\n      // We need to wait for the datepicker directive to be compiled\n      var listener = scope.$watch(getInput, function (input) {\n        var ngModel;\n\n        if (input.length) {\n          listener(); // self release\n          datepickerCtrl.$scope.$watch('ctrl.isDisabled', function(isDisabled) {\n            if (isDisabled)\n              if (datepickerCtrl.ngModelCtrl.$invalid)\n                // Trigger the event that will reset the errors and the model value\n                datepickerCtrl.$scope.$emit('md-calendar-change', datepickerCtrl.date);\n          });\n        }\n      });\n    }\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgResetOnDisabled', sgResetOnDisabled);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgRippleClick', sgRippleClick);\n\n  /*\n   * sgRippleClick - A ripple effect to cover the parent element.\n   * @memberof SOGo.Common\n   * @restrict attribute\n   *\n   * @example:\n\n     <md-dialog id=\"mailEditor\">\n       <md-button ng-click=\"editor.send()\"\n                sg-ripple-click=\"mailEditor\">Send</md-button>\n     </md-dialog>\n\n  */\n  sgRippleClick.$inject = ['$log', '$timeout'];\n  function sgRippleClick($log, $timeout) {\n\n    return {\n      restrict: 'A',\n      compile: compile\n    };\n\n    function compile(tElement, tAttrs) {\n\n      return function postLink(scope, element, attr) {\n        var ripple, content, container, containerId;\n\n        // Lookup container element\n        containerId = element.attr('sg-ripple-click');\n        container = element[0].parentNode;\n        while (container && container.id != containerId) {\n          container = container.parentNode;\n        }\n        if (!container) {\n          $log.error('No parent element found with id ' + containerId);\n          return undefined;\n        }\n\n        // Lookup sg-ripple-content element\n        content = container.querySelector('sg-ripple-content');\n        if (!content) {\n          $log.error('sg-ripple-content not found inside #' + containerId);\n          return undefined;\n        }\n\n        // Lookup sg-ripple element\n        ripple = container.querySelector('sg-ripple');\n        if (ripple) {\n          ripple = angular.element(ripple);\n        }\n        else {\n          // If ripple layer doesn't exit, create it with the primary background color\n          ripple = angular.element('<sg-ripple class=\"md-default-theme md-bg\"></sg-ripple>');\n          container.appendChild(ripple[0]);\n\n          // Hide ripple content on initialization\n          if (!content.classList.contains('ng-hide'))\n            content.classList.add('ng-hide');\n        }\n\n        // Register listener\n        element.on('click', listener);\n\n        scope.$on('$destroy', function() {\n          element.off('click', listener);\n        });\n\n        function listener(event) {\n          var coordinates;\n\n          if (element[0].hasAttribute('disabled')) {\n            return;\n          }\n\n          if (event.pageX && event.pageY) {\n            // Event is a mouse click\n            coordinates = { left: event.pageX, top: event.pageY };\n          }\n          else {\n            // Event is a form submit; target is the submit button\n            coordinates = event.target.getBoundingClientRect();\n          }\n\n          if (content.classList.contains('ng-hide')) {\n            // Show ripple\n            angular.element(container).css({ 'overflow': 'hidden', 'position': 'relative' });\n            angular.element(content).css({ top: container.scrollTop + 'px' });\n            $timeout(function() {\n              // Wait until next digest for CSS animation to work\n              ripple.css({\n\t        'top': (coordinates.top - container.offsetTop + container.scrollTop) + 'px',\n\t        'left': (coordinates.left - container.offsetLeft) + 'px',\n\t        'height': '400vmin',\n\t        'width': '400vmin'\n\t      });\n              // Show ripple content\n              content.classList.remove('ng-hide');\n            });\n          }\n          else {\n            // Hide ripple layer\n            ripple.css({\n              'top': (coordinates.top - container.offsetTop + container.scrollTop) + 'px',\n\t      'left': (coordinates.left - container.offsetLeft) + 'px',\n              'height': '0px',\n              'width': '0px'\n            });\n            // Hide ripple content\n            content.classList.add('ng-hide');\n            // Restore overflow of container once the animation is completed\n            $timeout(function() {\n              angular.element(container).css({ 'overflow': '', 'position': '' });\n            }, 800);\n          }\n        }\n      };\n    }\n  }\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  /* jshint validthis: true */\n  'use strict';\n\n  /*\n   * sgSearch - Search within a list of items\n   * @memberof SOGo.Common\n   * @restrict attribute\n   * @param {function} sgSearch - the function to call when performing a search.\n   *        Two variables are available: searchField and searchText.\n   * @example:\n\n   <div sg-search=\"mailbox.$filter({ sort: 'date', asc: false }, [{ searchBy: searchField, searchInput: searchText }])\">\n     <md-button class=\"sg-icon-button\"\n                sg-search-cancel=\"ctrl.cancelSearch()\">\n       <md-icon>arrow_back</md-icon>\n     </md-button>\n     <md-input-container>\n       <input name=\"search\" type=\"search\"/>\n     </md-input-container>\n     <md-select multiple>\n       <md-option value=\"subject\">Subject</md-option>\n       <md-option value=\"sender\">sender</md-option>\n     </md-select>\n   </div>\n  */\n  sgSearchPreTransclude.$inject = ['$parse'];\n  function sgSearchPreTransclude($parse) {\n    return {\n      restrict: 'A',\n      controller: 'sgSearchController',\n      controllerAs: '$sgSearchController',\n      priority: 1001,\n      compile: compile\n    };\n\n    function compile(tElement, tAttr) {\n      var mdInputEl = tElement.find('md-input-container'),\n          inputEl = tElement.find('input'),\n          selectEl = tElement.find('md-select'),\n          buttonEl = tElement.find('md-button');\n\n      inputEl.attr('ng-model', '$sgSearchController.searchText');\n      inputEl.attr('ng-model-options', '$sgSearchController.searchTextOptions');\n      inputEl.attr('ng-change', '$sgSearchController.onChange()');\n      if (selectEl) {\n        selectEl.attr('ng-model', '$sgSearchController.searchField');\n        selectEl.attr('ng-change', '$sgSearchController.onChange()');\n      }\n      if (buttonEl && buttonEl.attr('sg-search-cancel')) {\n        buttonEl.attr('ng-click', buttonEl.attr('sg-search-cancel'));\n        buttonEl.removeAttr('sg-search-cancel');\n      }\n      else {\n        buttonEl = null;\n      }\n\n      return function postLink(scope, iElement, iAttr, controller) {\n        var compiledButtonEl = iElement.find('button');\n\n        // Retrive the form and input names to check the form's validity in the controller\n        controller.formName = iElement.attr('name');\n        controller.inputName = inputEl.attr('name');\n\n        // Associate the sg-allow-dot parameter (boolean) to the controller\n        controller.allowDot = $parse(iElement.attr('sg-allow-dot'))(scope);\n\n        // Associate the sg-search-fields parameter (array) to the controller\n        controller.fields = $parse(iElement.attr('sg-search-fields'))(scope);\n\n        // Associate callback to controller\n        controller.doSearch = $parse(iElement.attr('sg-search'));\n\n        // Reset the input field when cancelling the search\n        if (buttonEl && compiledButtonEl) {\n          compiledButtonEl.on('click', controller.cancelSearch);\n        }\n      };\n    }\n  }\n\n  function sgSearch() {\n    return {\n      restrict: 'A',\n      priority: 1000,\n      transclude: true,\n      compile: compile\n    };\n\n    function compile(tElement, tAttr) {\n      return function postLink(scope, iElement, iAttr, controller, transclude) {\n        transclude(function(clone) {\n          iElement.append(clone);\n        });\n      };\n    }\n  }\n\n  /**\n   * @ngInject\n   */\n  sgSearchController.$inject = ['$window', '$scope', '$element'];\n  function sgSearchController($window, $scope, $element) {\n    var vm = this;\n\n    // Controller variables\n    vm.searchText = null;\n\n    // Model options\n    vm.searchTextOptions = {\n      updateOn: 'default blur',\n      debounce: {\n        default: 300,\n        blur: 0\n      }\n    };\n\n    if ($element.attr('sg-search-fields')) {\n      var waitforFieldsOnce = $scope.$watch(vm.fields, function(value) {\n        // Select all fields by default\n        vm.searchField = _.clone(vm.fields);\n        waitforFieldsOnce();\n      });\n    }\n\n    // Method to call on data changes\n    vm.onChange = function() {\n      var form = $scope[vm.formName],\n          input = form[vm.inputName],\n          rawSearchText = input.$viewValue;\n\n      if (vm.allowDot && rawSearchText == '.' || form.$valid && rawSearchText) {\n        if (rawSearchText == '.')\n          // Ignore the minlength constraint when using the dot operator\n          input.$setValidity('minlength', true);\n\n        // doSearch is the compiled expression of the sg-search attribute\n        vm.doSearch($scope, { searchText: rawSearchText, searchField: vm.searchField });\n      }\n    };\n\n    // Reset input field when cancelling the search\n    vm.cancelSearch = function() {\n      vm.searchText = null;\n    };\n  }\n\n  angular\n    .module('SOGo.Common')\n    .controller('sgSearchController', sgSearchController)\n    .directive('sgSearch', sgSearchPreTransclude)\n    .directive('sgSearch', sgSearch);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * sgSelectOnly - A directive that restricts an autocomplete field to its selectable values.\n   * @memberof SOGo.Common\n   * @ngInject\n   * @example:\n\n   <md-autocomplete\n     md-items=\"timezone in timeZones\"\n     ng-required=\"true\"\n     sg-select-only>\n  */\n  function sgSelectOnly() {\n    return {\n      link: postLink,\n      require: 'mdAutocomplete',\n      restrict: 'A'\n    };\n\n    function postLink(scope, element, attrs, autoComplete) {\n      function getInput() {\n        return element.find('input').eq(0);\n      }\n\n      // We need to wait for the autocomplete directive to be compiled\n      var listener = scope.$watch(getInput, function (input) {\n        var ngModel;\n\n        if (input.length) {\n          listener(); // self release\n          ngModel = input.controller('ngModel');\n          input.on('blur', function () {\n            if (!autoComplete.scope.selectedItem) {\n              scope.$applyAsync(ngModel.$setValidity('required', false));\n            }\n          });\n        }\n      });\n    }\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgSelectOnly', sgSelectOnly);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  /* jshint validthis: true */\n  'use strict';\n\n  /*\n   * sgSubscribe - Common subscription widget\n   * @restrict attribute\n   * @param {string} sgSubscribe - the folder type\n   * @param {function} sgSubscribeOnSelect - the function to call when subscribing to a folder.\n   *        One variable is available: folderData.\n   * @ngInject\n   * @example:\n\n     <md-button sg-subscribe=\"contact\" sg-subscribe-on-select=\"subscribeToFolder\">Subscribe ..</md-button>\n  */\n  sgSubscribe.$inject = ['User'];\n  function sgSubscribe(User) {\n    return {\n      restrict: 'A',\n      scope: {\n        folderType: '@sgSubscribe',\n        onFolderSelect: '&sgSubscribeOnSelect'\n      },\n      replace: false,\n      bindToController: true,\n      controller: sgSubscribeDialogController,\n      controllerAs: '$sgSubscribeDialogController',\n      link: link\n    };\n  }\n\n  function link(scope, element, attrs, controller) {\n    var inputEl = element.find('input');\n    element.on('click', controller.showDialog);\n  }\n\n  /**\n   * @ngInject\n   */\n  sgSubscribeDialogController.$inject = ['$mdDialog'];\n  function sgSubscribeDialogController($mdDialog) {\n    var vm = this;\n    vm.showDialog = function() {\n      $mdDialog.show({\n        templateUrl: '../Contacts/UIxContactsUserFolders',\n        clickOutsideToClose: true,\n        locals: {\n          folderType: vm.folderType,\n          onFolderSelect: vm.onFolderSelect\n        },\n        controller: sgSubscribeController,\n        controllerAs: 'subscribe'\n      });\n    };\n  }\n\n  /**\n   * @ngInject\n   */\n  sgSubscribeController.$inject = ['$mdDialog', 'folderType', 'onFolderSelect', 'User'];\n  function sgSubscribeController($mdDialog, folderType, onFolderSelect, User) {\n    var vm = this;\n\n    vm.selectedUser = null;\n    vm.users = [];\n\n    vm.searchTextOptions = {\n      updateOn: 'default blur',\n      debounce: {\n        default: 300,\n        blur: 0\n      }\n    };\n\n    vm.onChange = function(input) {\n      User.$filter(vm.searchText, null, { results: vm.users }).then(function(users) {\n        input.$setValidity('matches', users.length > 0);\n        input.$setTouched();\n        if (vm.selectedUser) {\n          // If selected user is no longer part of the matching users, unselect it\n          if (_.isUndefined(_.find(users, function(user) {\n            return user.uid == vm.selectedUser.uid;\n          }))) {\n            vm.selectedUser = null;\n          }\n        }\n      });\n    };\n\n    vm.selectUser = function(i) {\n      if (vm.selectedUser == vm.users[i]) {\n        vm.selectedUser = null;\n      }\n      else {\n        // Fetch folders of specific type for selected user\n        vm.users[i].$folders(folderType).then(function() {\n          vm.selectedUser = vm.users[i];\n        });\n      }\n    };\n\n    // Callback upon subscription to a folder\n    vm.selectFolder = function(folder) {\n      onFolderSelect({folderData: folder});\n    };\n\n    vm.close = function() {\n      $mdDialog.hide();\n    };\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgSubscribe', sgSubscribe);\n})();\n","(function() {\n  'use strict';\n\n  /**\n   * This section is inspired from angular-material/src/components/datepicker/js/calendar.js\n   */\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgTimePane', timePaneDirective);\n\n  function timePaneDirective() {\n    return {\n      template: [\n        '<div class=\"sg-time-pane\">',\n        '  <div class=\"hours-pane\">',\n        '    <div ng-repeat=\"hoursBigLine in hours\" layout=\"row\" layout-xs=\"column\">',\n        '      <div ng-repeat=\"hoursLine in hoursBigLine\" layout=\"row\" class=\"hours\">',\n        '          <md-button class=\"hourBtn sg-time-selection-indicator\" id=\"{{hour.id}}\"',\n        '                     md-no-ink',\n        '                     ng-repeat=\"hour in hoursLine\"',\n        '                     ng-click=\"hourClickHandler(hour.displayName)\">{{hour.displayName}}</md-button>',\n        '      </div>',\n        '    </div>',\n        '  </div>',\n        '  <div class=\"min5\" ng-show=\"is5min()\">',\n        '    <div layout=\"row\" layout-xs=\"column\">',\n        '      <div ng-repeat=\"minutesLine in min5\" layout=\"row\">',\n        '        <md-button class=\"minuteBtn sg-time-selection-indicator\" id=\"{{minute.id}}\"',\n        '                   md-no-ink',\n        '                   ng-repeat=\"minute in minutesLine\"',\n        '                   ng-click=\"minuteClickHandler(minute.displayName)\">{{minute.displayName}}</md-button>',\n        '      </div>',\n        '    </div>',\n        '  </div>',\n        '  <div class=\"sg-time-scroll-mask\" ng-hide=\"is5min()\">',\n        '    <div class=\"min1\" layout=\"row\" layout-xs=\"column\" layout-wrap>',\n        '      <div ng-repeat=\"minutesLine in min1\" layout=\"row\" layout-align=\"space-around center\">',\n        '        <md-button class=\"minuteBtn sg-time-selection-indicator\" id=\"{{minute.id}}\"',\n        '                   md-no-ink',\n        '                   ng-repeat=\"minute in minutesLine\"',\n        '                   ng-click=\"minuteClickHandler(minute.displayName)\">{{minute.displayName}}</md-button>',\n        '      </div>',\n        '    </div>',\n        '  </div>',\n        '  <div flex layout=\"row\" layout-align=\"center center\" md-colors=\"::{background: \\'default-background-200\\'}\">',\n        '    <md-button class=\"toggleBtn md-fab md-mini\" ng-bind=\"getToggleBtnLbl()\" ng-click=\"toggleManual5min()\"></md-button>',\n        '  </div>',\n        '</div>'\n      ].join(''),\n      scope: {},\n      require: ['ngModel', 'sgTimePane', '?^mdInputContainer'],\n      controller: TimePaneCtrl,\n      controllerAs: 'ctrl',\n      bindToController: true,\n      link: function(scope, element, attrs, controllers) {\n        var ngModelCtrl = controllers[0];\n        var sgTimePaneCtrl = controllers[1];\n\n        var mdInputContainer = controllers[2];\n        if (mdInputContainer) {\n          throw Error('sg-timepicker should not be placed inside md-input-container.');\n        }\n\n        sgTimePaneCtrl.configureNgModel(ngModelCtrl, sgTimePaneCtrl);\n      }\n    };\n  }\n\n  /** Next identifier for calendar instance. */\n  var nextUniqueId = 0;\n\n  /**\n   * Controller for the sgTimePane component.\n   * @ngInject @constructor\n   */\n  TimePaneCtrl.$inject = ['$element', '$scope', '$$mdDateUtil', '$mdUtil',\n                          '$mdConstant', '$mdTheming', '$$rAF', '$attrs', '$mdDateLocale'];\n  function TimePaneCtrl($element, $scope, $$mdDateUtil, $mdUtil,\n                        $mdConstant, $mdTheming, $$rAF, $attrs, $mdDateLocale) {\n\n    var m;\n\n    $mdTheming($element);\n\n    /** @final {!angular.JQLite} */\n    this.$element = $element;\n\n    /** @final {!angular.Scope} */\n    this.$scope = $scope;\n\n    /** @final */\n    this.dateUtil = $$mdDateUtil;\n\n    /** @final */\n    this.$mdUtil = $mdUtil;\n\n    /** @final */\n    this.keyCode = $mdConstant.KEY_CODE;\n\n    /** @final */\n    this.$$rAF = $$rAF;\n\n    this.timePaneElement = $element[0].querySelector('.sg-time-pane');\n\n    // this.$q = $q;\n\n    /** @type {!angular.NgModelController} */\n    this.ngModelCtrl = null;\n\n    /** @type {String} Class applied to the selected hour or minute cell. */\n    this.SELECTED_TIME_CLASS = 'sg-time-selected';\n\n    /** @type {String} Class applied to the focused hour or minute cell. */\n    this.FOCUSED_TIME_CLASS = 'md-focus';\n\n    /** @final {number} Unique ID for this time pane instance. */\n    this.id = nextUniqueId++;\n\n    /**\n     * The date that is currently focused or showing in the calendar. This will initially be set\n     * to the ng-model value if set, otherwise to today. It will be updated as the user navigates\n     * to other months. The cell corresponding to the displayDate does not necesarily always have\n     * focus in the document (such as for cases when the user is scrolling the calendar).\n     * @type {Date}\n     */\n    this.displayTime = null;\n\n    /**\n     * The selected date. Keep track of this separately from the ng-model value so that we\n     * can know, when the ng-model value changes, what the previous value was before it's updated\n     * in the component's UI.\n     *\n     * @type {Date}\n     */\n    this.selectedTime = null;\n\n    /**\n     * Used to toggle initialize the root element in the next digest.\n     * @type {Boolean}\n     */\n    this.isInitialized = false;\n\n    $scope.hours=[];\n    $scope.hours[0]=[];\n    $scope.hours[0][0]=[];\n    $scope.hours[0][1]=[];\n    $scope.hours[1]=[];\n    $scope.hours[1][0]=[];\n    $scope.hours[1][1]=[];\n    for(var i=0; i<6; i++){\n      $scope.hours[0][0][i] = {id:'tp-'+this.id+'-hour-'+i, displayName:i<10?\"0\"+i:\"\"+i, selected:false};\n      $scope.hours[0][1][i] = {id:'tp-'+this.id+'-hour-'+(i+6),displayName:(i+6)<10?\"0\"+(i+6):\"\"+(i+6), selected:false};\n      $scope.hours[1][0][i] = {id:'tp-'+this.id+'-hour-'+(i+12), displayName:\"\"+(i+12), selected:false};\n      $scope.hours[1][1][i] = {id:'tp-'+this.id+'-hour-'+(i+18), displayName:\"\"+(i+18), selected:false};\n    }\n\n    $scope.min5=[];\n    $scope.min5[0]=[];\n    $scope.min5[1]=[];\n    for(i=0; i<6; i++){\n      m=i*5;\n      $scope.min5[0][i] = {id:'tp-'+this.id+'-minute5-'+m, displayName:m<10?\":0\"+m:\":\"+m, selected:true};\n      $scope.min5[1][i] = {id:'tp-'+this.id+'-minute5-'+(m+30), displayName:\":\"+(m+30), selected:false};\n    }\n\n    $scope.min1=[];\n    for(i=0; i<12; i++){\n      $scope.min1[i]=[];\n      for(var ii=0; ii<5; ii++){\n        m=i*5 + ii;\n        $scope.min1[i][ii] = {id:'tp-'+this.id+'-minute-'+m, displayName:m<10?\":0\"+m:\":\"+m, selected:true};\n      }\n    }\n\n    $scope.show5min = true;\n    $scope.getToggleBtnLbl = function() {\n      return ($scope.is5min()) ? '>>' : '<<';\n    };\n    $scope.toggleManual5min = function() {\n      $scope.manual5min = !$scope.is5min();\n    };\n    $scope.is5min = function() {\n      if ($scope.manual5min === true || $scope.manual5min === false) {\n        return $scope.manual5min;\n      }\n      else {\n        return $scope.show5min;\n      }\n    };\n\n    // Unless the user specifies so, the calendar should not be a tab stop.\n    // This is necessary because ngAria might add a tabindex to anything with an ng-model\n    // (based on whether or not the user has turned that particular feature on/off).\n    if (!$attrs.tabindex) {\n      $element.attr('tabindex', '-1');\n    }\n\n    var self = this;\n\n    this.hourClickHandler = function(displayVal) {\n      var updated = new Date(self.displayTime);\n      updated.setHours(Number(displayVal));\n      self.setNgModelValue(updated, 'hours');\n    };\n    $scope.hourClickHandler = this.hourClickHandler;\n\n    this.minuteClickHandler = function(displayVal) {\n      // Remove leading ':'\n      var val = displayVal.substr(1);\n      var updated = new Date(self.displayTime);\n      updated.setMinutes(Number(val));\n      self.setNgModelValue(updated, 'minutes');\n    };\n    $scope.minuteClickHandler = this.minuteClickHandler;\n\n    var boundKeyHandler = angular.bind(this, this.handleKeyEvent);\n\n    // Bind the keydown handler to the body, in order to handle cases where the focused\n    // element gets removed from the DOM and stops propagating click events.\n    angular.element(document.body).on('keydown', boundKeyHandler);\n\n    $scope.$on('$destroy', function() {\n      angular.element(document.body).off('keydown', boundKeyHandler);\n    });\n  }\n\n  /**\n   * Sets up the controller's reference to ngModelController.\n   * @param {!angular.NgModelController} ngModelCtrl\n   */\n  TimePaneCtrl.prototype.configureNgModel = function(ngModelCtrl, sgTimePaneCtrl) {\n    var self = this;\n\n    // self.displayTime = new Date(self.$viewValue);\n\n    self.ngModelCtrl = ngModelCtrl;\n\n    self.$mdUtil.nextTick(function() {\n      self.isInitialized = true;\n    });\n\n    ngModelCtrl.$render = function() {\n      var date = this.$viewValue;\n      self.$mdUtil.nextTick(function() {\n        self.changeSelectedTime(date, sgTimePaneCtrl);\n      });\n    };\n  };\n\n  /**\n   * Change the selected date in the time (ngModel value has already been changed).\n   */\n  TimePaneCtrl.prototype.changeSelectedTime = function(date, sgTimePaneCtrl) {\n    var self = this;\n    var previousSelectedTime = this.selectedTime;\n\n    this.selectedTime = date;\n    this.displayTime = new Date(date);\n\n    // Remove the selected class from the previously selected date, if any.\n    if (previousSelectedTime) {\n      var prevH = previousSelectedTime.getHours();\n      var prevHCell = document.getElementById('tp-'+sgTimePaneCtrl.id+'-hour-'+prevH);\n      if (prevHCell) {\n        prevHCell.classList.remove(this.SELECTED_TIME_CLASS);\n        prevHCell.setAttribute('aria-selected', 'false');\n      }\n      var prevM = previousSelectedTime.getMinutes();\n      var prevMCell = document.getElementById('tp-'+sgTimePaneCtrl.id+'-minute-'+prevM);\n      if (prevMCell) {\n        prevMCell.classList.remove(this.SELECTED_TIME_CLASS);\n        prevMCell.setAttribute('aria-selected', 'false');\n      }\n      var prevM5Cell = document.getElementById('tp-'+sgTimePaneCtrl.id+'-minute5-'+prevM);\n      if (prevM5Cell) {\n        prevM5Cell.classList.remove(this.SELECTED_TIME_CLASS);\n        prevM5Cell.setAttribute('aria-selected', 'false');\n      }\n    }\n\n    // Apply the select class to the new selected date if it is set.\n    if (date) {\n      var newH = date.getHours();\n      var mCell, hCell = document.getElementById('tp-'+sgTimePaneCtrl.id+'-hour-'+newH);\n      if (hCell) {\n        hCell.classList.add(this.SELECTED_TIME_CLASS);\n        hCell.setAttribute('aria-selected', 'true');\n      }\n      var newM = date.getMinutes();\n      if (newM % 5 === 0) {\n        sgTimePaneCtrl.$scope.show5min = true;\n        mCell = document.getElementById('tp-'+sgTimePaneCtrl.id+'-minute5-'+newM);\n        if (mCell) {\n          mCell.classList.add(this.SELECTED_TIME_CLASS);\n          mCell.setAttribute('aria-selected', 'true');\n        }\n      }\n      else {\n        sgTimePaneCtrl.$scope.show5min = false;\n      }\n      mCell = document.getElementById('tp-'+sgTimePaneCtrl.id+'-minute-'+newM);\n      if (mCell) {\n        mCell.classList.add(this.SELECTED_TIME_CLASS);\n        mCell.setAttribute('aria-selected', 'true');\n      }\n    }\n  };\n\n  /**\n   * Sets the ng-model value for the time pane and emits a change event.\n   * @param {Date} date\n   */\n  TimePaneCtrl.prototype.setNgModelValue = function(date, mode) {\n    this.$scope.$emit('sg-time-pane-change', { date: date, changed: mode });\n    this.ngModelCtrl.$setViewValue(date);\n    this.ngModelCtrl.$render();\n    return date;\n  };\n\n\n  /*** User input handling ***/\n\n  /**\n   * Handles a key event in the calendar with the appropriate action. The action will either\n   * be to select the focused date or to navigate to focus a new date.\n   * @param {KeyboardEvent} event\n   */\n  TimePaneCtrl.prototype.handleKeyEvent = function(event) {\n    var self = this;\n    this.$scope.$apply(function() {\n      // Capture escape and emit back up so that a wrapping component\n      // (such as a time-picker) can decide to close.\n      if (event.which == self.keyCode.ESCAPE || event.which == self.keyCode.TAB) {\n        self.$scope.$emit('md-time-pane-close');\n\n        if (event.which == self.keyCode.TAB) {\n          event.preventDefault();\n        }\n\n        return;\n      }\n\n      // Remaining key events fall into two categories: selection and navigation.\n      // Start by checking if this is a selection event.\n      if (event.which === self.keyCode.ENTER) {\n        self.setNgModelValue(self.displayTime, 'enter');\n        event.preventDefault();\n        return;\n      }\n\n      // Selection isn't occuring, so the key event is either navigation or nothing.\n      /*var date = self.getFocusDateFromKeyEvent(event);\n        if (date) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        // Since this is a keyboard interaction, actually give the newly focused date keyboard\n        // focus after the been brought into view.\n        self.changeDisplayTime(date).then(function () {\n        self.focus(date);\n        });\n        }*/\n    });\n  };\n\n  /**\n   * Focus the cell corresponding to the given date.\n   * @param {Date=} opt_date The date to be focused.\n   */\n  TimePaneCtrl.prototype.focus = function(opt_date, sgTimePaneCtrl) {\n    var date = opt_date || this.selectedTime || this.today;\n\n    var previousFocus = this.timePaneElement.querySelector('.md-focus');\n    if (previousFocus) {\n      previousFocus.classList.remove(this.FOCUSED_TIME_CLASS);\n    }\n\n    if (date) {\n      var newH = date.getHours();\n      var hCell = document.getElementById('tp-'+sgTimePaneCtrl.id+'-hour-'+newH);\n      if (hCell) {\n        hCell.classList.add(this.FOCUSED_TIME_CLASS);\n        hCell.focus();\n      }\n    }\n  };\n})();\n\n(function() {\n  'use strict';\n\n  /**\n   * This section is inspired from angular-material/src/components/datepicker/js/datepickerDirective.js\n   */\n\n  angular.module('SOGo.Common')\n    .directive('sgTimepicker', timePickerDirective);\n\n  /**\n   * @ngdoc directive\n   * @name mdTimepicker\n   * @module material.components.timepicker\n   *\n   * @param {Date} ng-model The component's model. Expects a JavaScript Date object.\n   * @param {expression=} ng-change Expression evaluated when the model value changes.\n   * @param {String=} md-placeholder The time input placeholder value.\n   * @param {boolean=} ng-disabled Whether the timepicker is disabled.\n   * @param {boolean=} ng-required Whether a value is required for the timepicker.\n   *\n   * @description\n   * `<sg-timepicker>` is a component used to select a single time.\n   * For information on how to configure internationalization for the time picker,\n   * see `$mdTimeLocaleProvider`.\n   *\n   * @usage\n   * <hljs lang=\"html\">\n   *   <sg-timepicker ng-model=\"birthday\"></sg-timepicker>\n   * </hljs>\n   *\n   */\n\n  timePickerDirective.$inject = ['$mdUtil', '$mdAria'];\n  function timePickerDirective($mdUtil, $mdAria) {\n    return {\n      template: function(tElement, tAttrs) {\n        // Buttons are not in the tab order because users can open the hours pane via keyboard\n        // interaction on the text input, and multiple tab stops for one component (picker)\n        // may be confusing.\n        var ariaLabelValue = tAttrs.ariaLabel || tAttrs.mdPlaceholder;\n\n        return [\n          '<md-button class=\"sg-timepicker-button md-icon-button\" type=\"button\" ',\n          '           tabindex=\"-1\" aria-hidden=\"true\" ',\n          '           ng-click=\"ctrl.openTimePane($event)\">',\n          '  <md-icon class=\"sg-timepicker-icon\">access_time</md-icon>',\n          '</md-button>',\n          '<div class=\"md-default-theme sg-timepicker-input-container\" ',\n          '     ng-class=\"{\\'sg-timepicker-focused\\': ctrl.isFocused}\">',\n          '  <input class=\"sg-timepicker-input\" ',\n          (ariaLabelValue ? 'aria-label=\"' + ariaLabelValue + '\" ' : ''),\n          '         aria-haspopup=\"true\"',\n          '         aria-expanded=\"{{ctrl.isTimeOpen}}\" ',\n          '         aria-owns=\"{{::ctrl.timePaneId}}\"',\n          '         ng-focus=\"ctrl.setFocused(true)\" ng-blur=\"ctrl.setFocused(false)\">',\n          '  <md-button type=\"button\" md-no-ink ',\n          '             class=\"sg-timepicker-triangle-button md-icon-button\" ',\n          '             ng-click=\"ctrl.openTimePane($event)\" ',\n          '             aria-label=\"{{::ctrl.dateLocale.msgOpenCalendar}}\">',\n          '    <div class=\"sg-timepicker-expand-triangle\"></div>',\n          '  </md-button>',\n          '</div>',\n          // This pane will be detached from here and re-attached to the document body.\n          '<div class=\"sg-timepicker-time-pane md-whiteframe-z1\" id=\"{{::ctrl.timePaneId}}\">',\n          '  <div class=\"sg-timepicker-input-mask\">',\n          '    <div class=\"sg-timepicker-input-mask-opaque\"></div>',\n          // '                md-colors=\"::{\\'box-shadow\\': \\'default-background-hue-1\\'}\"></div>', // using mdColors\n          '  </div>',\n          '  <div class=\"sg-timepicker-time\" md-colors=\"::{background: \\'default-background-A100\\'}\">',\n          '    <sg-time-pane role=\"dialog\" aria-label=\"{{::ctrl.dateLocale.msgCalendar}}\" ',\n          '                  ng-model=\"ctrl.time\" ng-if=\"ctrl.isTimeOpen\"></sg-time-pane>',\n          '  </div>',\n          '</div>'\n        ].join('');\n      },\n      require: ['ngModel', 'sgTimepicker', '?^form'],\n      scope: {\n        placeholder: '@mdPlaceholder'\n      },\n      controller: TimePickerCtrl,\n      controllerAs: 'ctrl',\n      bindToController: true,\n      link: function(scope, element, attr, controllers) {\n        var ngModelCtrl = controllers[0];\n        var mdTimePickerCtrl = controllers[1];\n        var parentForm = controllers[2];\n        var mdNoAsterisk = $mdUtil.parseAttributeBoolean(attr.mdNoAsterisk);\n\n        mdTimePickerCtrl.configureNgModel(ngModelCtrl);\n\n        // TODO: shall we check ^mdInputContainer?\n        if (parentForm) {\n          // If invalid, highlights the input when the parent form is submitted.\n          var parentSubmittedWatcher = scope.$watch(function() {\n            return parentForm.$submitted;\n          }, function(isSubmitted) {\n            if (isSubmitted) {\n              mdTimePickerCtrl.updateErrorState();\n              parentSubmittedWatcher();\n            }\n          });\n        }\n      }\n    };\n  }\n\n  /** Additional offset for the input's `size` attribute, which is updated based on its content. */\n  var EXTRA_INPUT_SIZE = 3;\n\n  /** Class applied to the container if the date is invalid. */\n  var INVALID_CLASS = 'sg-timepicker-invalid';\n\n  /** Class applied to the timepicker when it's open. */\n  var OPEN_CLASS = 'sg-timepicker-open';\n\n  /** Default time in ms to debounce input event by. */\n  var DEFAULT_DEBOUNCE_INTERVAL = 500;\n\n  /**\n   * Height of the calendar pane used to check if the pane is going outside the boundary of\n   * the viewport. See calendar.scss for how $md-calendar-height is computed; an extra 20px is\n   * also added to space the pane away from the exact edge of the screen.\n   *\n   *  This is computed statically now, but can be changed to be measured if the circumstances\n   *  of calendar sizing are changed.\n   */\n  var TIME_PANE_HEIGHT = { MIN5: { GTXS: 172 + 20, XS: 291 + 20 },\n                           MIN1: { GTXS: 364 + 20, XS: 454 + 20 } };\n\n  /**\n   * Width of the calendar pane used to check if the pane is going outside the boundary of\n   * the viewport. See calendar.scss for how $md-calendar-width is computed; an extra 20px is\n   * also added to space the pane away from the exact edge of the screen.\n   *\n   *  This is computed statically now, but can be changed to be measured if the circumstances\n   *  of calendar sizing are changed.\n   */\n  var TIME_PANE_WIDTH = { GTXS: 510 + 20, XS: 274 + 20 };\n\n  /** Used for checking whether the current user agent is on iOS or Android. */\n  var IS_MOBILE_REGEX = /ipad|iphone|ipod|android/i;\n\n  /**\n   * Controller for sg-timepicker.\n   *\n   * ngInject @constructor\n   */\n  TimePickerCtrl.$inject = ['$scope', '$element', '$attrs', '$window', '$mdConstant',\n                            '$mdTheming', '$mdUtil', '$mdDateLocale', '$$mdDateUtil', '$$rAF',\n                            '$mdMedia'];\n  function TimePickerCtrl($scope, $element, $attrs, $window, $mdConstant,\n                          $mdTheming, $mdUtil, $mdDateLocale, $$mdDateUtil, $$rAF,\n                          $mdMedia) {\n    /** @final */\n    this.$window = $window;\n\n    /** @final */\n    this.dateLocale = $mdDateLocale;\n\n    /** @final */\n    this.dateUtil = $$mdDateUtil;\n\n    /** @final */\n    this.$mdConstant = $mdConstant;\n\n    /* @final */\n    this.$mdUtil = $mdUtil;\n\n    /** @final */\n    this.$$rAF = $$rAF;\n\n    /** @final */\n    this.$mdMedia = $mdMedia;\n\n    /**\n     * The root document element. This is used for attaching a top-level click handler to\n     * close the calendar panel when a click outside said panel occurs. We use `documentElement`\n     * instead of body because, when scrolling is disabled, some browsers consider the body element\n     * to be completely off the screen and propagate events directly to the html element.\n     * @type {!angular.JQLite}\n     */\n    this.documentElement = angular.element(document.documentElement);\n\n    /** @type {!angular.NgModelController} */\n    this.ngModelCtrl = null;\n\n    /** @type {HTMLInputElement} */\n    this.inputElement = $element[0].querySelector('input');\n\n    /** @final {!angular.JQLite} */\n    this.ngInputElement = angular.element(this.inputElement);\n\n    /** @type {HTMLElement} */\n    this.inputContainer = $element[0].querySelector('.sg-timepicker-input-container');\n\n    /** @type {HTMLElement} Floating time pane. */\n    this.timePane = $element[0].querySelector('.sg-timepicker-time-pane');\n\n    /** @type {HTMLElement} Time icon button. */\n    this.timeButton = $element[0].querySelector('.sg-timepicker-button');\n\n    /**\n     * Element covering everything but the input in the top of the floating calendar pane.\n     * @type {HTMLElement}\n     */\n    this.inputMask = angular.element($element[0].querySelector('.sg-timepicker-input-mask-opaque'));\n\n    /** @final {!angular.JQLite} */\n    this.$element = $element;\n\n    /** @final {!angular.Attributes} */\n    this.$attrs = $attrs;\n\n    /** @final {!angular.Scope} */\n    this.$scope = $scope;\n\n    /** @type {Date} */\n    this.date = null;\n\n    /** @type {boolean} */\n    this.isFocused = false;\n\n    /** @type {boolean} */\n    this.isDisabled = false;\n    this.setDisabled($element[0].disabled || angular.isString($attrs.disabled));\n\n    /** @type {boolean} Whether the date-picker's calendar pane is open. */\n    this.isTimeOpen = false;\n\n    /** @type {boolean} Whether the calendar should open when the input is focused. */\n    // this.openOnFocus = $attrs.hasOwnProperty('mdOpenOnFocus');\n\n    /** @final */\n    // this.mdInputContainer = null;\n\n    /**\n     * Element from which the calendar pane was opened. Keep track of this so that we can return\n     * focus to it when the pane is closed.\n     * @type {HTMLElement}\n     */\n    this.timePaneOpenedFrom = null;\n\n    /** @type {String} Unique id for the time pane. */\n    this.timePaneId = 'sg-time-pane' + $mdUtil.nextUid();\n\n    /** Pre-bound click handler is saved so that the event listener can be removed. */\n    this.bodyClickHandler = angular.bind(this, this.handleBodyClick);\n\n    /**\n     * Name of the event that will trigger a close. Necessary to sniff the browser, because\n     * the resize event doesn't make sense on mobile and can have a negative impact since it\n     * triggers whenever the browser zooms in on a focused input.\n     */\n    this.windowEventName = IS_MOBILE_REGEX.test(\n      navigator.userAgent || navigator.vendor || window.opera\n    ) ? 'orientationchange' : 'resize';\n\n    /** Pre-bound close handler so that the event listener can be removed. */\n    this.windowEventHandler = $mdUtil.debounce(angular.bind(this, this.closeTimePane), 100);\n\n    /** Pre-bound handler for the window blur event. Allows for it to be removed later. */\n    this.windowBlurHandler = angular.bind(this, this.handleWindowBlur);\n\n    /** @type {Number} Extra margin for the left side of the floating calendar pane. */\n    this.leftMargin = 20;\n\n    /** @type {Number} Extra margin for the top of the floating calendar. Gets determined on the first open. */\n    this.topMargin = null;\n\n    // Unless the user specifies so, the timepicker should not be a tab stop.\n    // This is necessary because ngAria might add a tabindex to anything with an ng-model\n    // (based on whether or not the user has turned that particular feature on/off).\n    if ($attrs.tabindex) {\n      this.ngInputElement.attr('tabindex', $attrs.tabindex);\n      $attrs.$set('tabindex', null);\n    } else {\n      $attrs.$set('tabindex', '-1');\n    }\n\n    $mdTheming($element);\n    $mdTheming(angular.element(this.timePane));\n\n    this.installPropertyInterceptors();\n    this.attachChangeListeners();\n    this.attachInteractionListeners();\n\n    var self = this;\n\n    $scope.$on('$destroy', function() {\n      self.detachTimePane();\n    });\n  }\n\n  /**\n   * Sets up the controller's reference to ngModelController.\n   * @param {!angular.NgModelController} ngModelCtrl Instance of the ngModel controller.\n   */\n  TimePickerCtrl.prototype.configureNgModel = function(ngModelCtrl) {\n    this.ngModelCtrl = ngModelCtrl;\n\n    var self = this;\n\n    // Responds to external changes to the model value.\n    self.ngModelCtrl.$formatters.push(function(value) {\n      if (value && !(value instanceof Date)) {\n        throw Error('The ng-model for sg-timepicker must be a Date instance. ' +\n                    'Currently the model is a: ' + (typeof value));\n      }\n\n      self.time = value;\n      self.inputElement.value = self.dateLocale.formatTime(value);\n      self.resizeInputElement();\n      self.updateErrorState();\n\n      return value;\n    });\n\n    // Responds to external error state changes (e.g. ng-required based on another input).\n    ngModelCtrl.$viewChangeListeners.unshift(angular.bind(this, this.updateErrorState));\n  };\n\n  /**\n   * Attach event listeners for both the text input and the md-time.\n   * Events are used instead of ng-model so that updates don't infinitely update the other\n   * on a change. This should also be more performant than using a $watch.\n   */\n  TimePickerCtrl.prototype.attachChangeListeners = function() {\n    var self = this;\n\n    self.$scope.$on('sg-time-pane-change', function(event, data) {\n      var time = new Date(data.date);\n      self.ngModelCtrl.$setViewValue(time);\n      self.time = time;\n      self.inputElement.value = self.dateLocale.formatTime(time);\n      if (data.changed == 'minutes') {\n        self.closeTimePane();\n      }\n      self.resizeInputElement();\n      self.inputContainer.classList.remove(INVALID_CLASS);\n    });\n\n    self.ngInputElement.on('input', angular.bind(self, self.resizeInputElement));\n\n    var debounceInterval = angular.isDefined(this.debounceInterval) ?\n        this.debounceInterval : DEFAULT_DEBOUNCE_INTERVAL;\n    self.ngInputElement.on('input', self.$mdUtil.debounce(self.handleInputEvent,\n                                                          debounceInterval, self));\n  };\n\n  /** Attach event listeners for user interaction. */\n  TimePickerCtrl.prototype.attachInteractionListeners = function() {\n    var self = this;\n    var $scope = this.$scope;\n    var keyCodes = this.$mdConstant.KEY_CODE;\n\n    // Add event listener through angular so that we can triggerHandler in unit tests.\n    self.ngInputElement.on('keydown', function(event) {\n      if (event.altKey && event.keyCode == keyCodes.DOWN_ARROW) {\n        self.openTimePane(event);\n        $scope.$digest();\n      }\n    });\n\n    $scope.$on('md-time-close', function() {\n      self.closeTimePane();\n    });\n  };\n\n  /**\n   * Capture properties set to the time-picker and imperitively handle internal changes.\n   * This is done to avoid setting up additional $watches.\n   */\n  TimePickerCtrl.prototype.installPropertyInterceptors = function() {\n    var self = this;\n\n    if (this.$attrs.ngDisabled) {\n      // The expression is to be evaluated against the directive element's scope and not\n      // the directive's isolate scope.\n      var scope = this.$scope.$parent;\n\n      if (scope) {\n        scope.$watch(this.$attrs.ngDisabled, function(isDisabled) {\n          self.setDisabled(isDisabled);\n        });\n      }\n    }\n\n    Object.defineProperty(this, 'placeholder', {\n      get: function() { return self.inputElement.placeholder; },\n      set: function(value) { self.inputElement.placeholder = value || ''; }\n    });\n  };\n\n  /**\n   * Sets whether the date-picker is disabled.\n   * @param {boolean} isDisabled\n   */\n  TimePickerCtrl.prototype.setDisabled = function(isDisabled) {\n    this.isDisabled = isDisabled;\n    this.inputElement.disabled = isDisabled;\n\n    if (this.timeButton) {\n      this.timeButton.disabled = isDisabled;\n    }\n  };\n\n  /**\n   * Sets the custom ngModel.$error flags to be consumed by ngMessages. Flags are:\n   *   - mindate: whether the selected date is before the minimum date.\n   *   - maxdate: whether the selected flag is after the maximum date.\n   *   - filtered: whether the selected date is allowed by the custom filtering function.\n   *   - valid: whether the entered text input is a valid date\n   *\n   * The 'required' flag is handled automatically by ngModel.\n   *\n   * @param {Date=} opt_date Date to check. If not given, defaults to the datepicker's model value.\n   */\n  TimePickerCtrl.prototype.updateErrorState = function(opt_date) {\n    var date = opt_date || this.date;\n\n    // Clear any existing errors to get rid of anything that's no longer relevant.\n    this.clearErrorState();\n\n    if (!this.dateUtil.isValidDate(date)) {\n      // The date is seen as \"not a valid date\" if there is *something* set\n      // (i.e.., not null or undefined), but that something isn't a valid date.\n      this.ngModelCtrl.$setValidity('valid', date === null);\n    }\n\n    // TODO(jelbourn): Change this to classList.toggle when we stop using PhantomJS in unit tests\n    // because it doesn't conform to the DOMTokenList spec.\n    // See https://github.com/ariya/phantomjs/issues/12782.\n    if (!this.ngModelCtrl.$valid) {\n      this.inputContainer.classList.add(INVALID_CLASS);\n    }\n  };\n\n  /** Clears any error flags set by `updateErrorState`. */\n  TimePickerCtrl.prototype.clearErrorState = function() {\n    this.inputContainer.classList.remove(INVALID_CLASS);\n    ['valid'].forEach(function(field) {\n      this.ngModelCtrl.$setValidity(field, true);\n    }, this);\n  };\n\n  /**\n   * Resizes the input element based on the size of its content.\n   */\n  TimePickerCtrl.prototype.resizeInputElement = function() {\n    this.inputElement.size = this.inputElement.value.length + EXTRA_INPUT_SIZE;\n  };\n\n  /**\n   * Sets the model value if the user input is a valid time.\n   * Adds an invalid class to the input element if not.\n   */\n  TimePickerCtrl.prototype.handleInputEvent = function(self) {\n    var inputString = this.inputElement.value;\n    var parsedTime = inputString ? this.dateLocale.parseTime(inputString) : null;\n\n    // An input string is valid if it is either empty (representing no date)\n    // or if it parses to a valid time that the user is allowed to select.\n    var isValidInput = inputString === '' || this.dateUtil.isValidDate(parsedTime);\n\n    // The datepicker's model is only updated when there is a valid input.\n    if (isValidInput) {\n      var updated = new Date(this.time);\n      updated.setHours(parsedTime.getHours());\n      updated.setMinutes(parsedTime.getMinutes());\n      this.ngModelCtrl.$setViewValue(updated);\n      this.time = updated;\n    }\n\n    this.updateErrorState(parsedTime);\n  };\n\n  /** Position and attach the floating calendar to the document. */\n  TimePickerCtrl.prototype.attachTimePane = function() {\n    var timePane = this.timePane;\n    var body = document.body;\n\n    timePane.style.transform = '';\n    this.$element.addClass(OPEN_CLASS);\n    // this.mdInputContainer && this.mdInputContainer.element.addClass(OPEN_CLASS);\n    angular.element(body).addClass('md-datepicker-is-showing');\n\n    var elementRect = this.inputContainer.getBoundingClientRect();\n    var bodyRect = body.getBoundingClientRect();\n\n    if (!this.topMargin || this.topMargin < 0) {\n      this.topMargin = (this.inputMask.parent().prop('clientHeight') - this.ngInputElement.prop('clientHeight')) / 2;\n    }\n\n    // Check to see if the calendar pane would go off the screen. If so, adjust position\n    // accordingly to keep it within the viewport.\n    var paneTop = elementRect.top - bodyRect.top - this.topMargin;\n    var paneLeft = elementRect.left - bodyRect.left - this.leftMargin;\n\n    // If ng-material has disabled body scrolling (for example, if a dialog is open),\n    // then it's possible that the already-scrolled body has a negative top/left. In this case,\n    // we want to treat the \"real\" top as (0 - bodyRect.top). In a normal scrolling situation,\n    // though, the top of the viewport should just be the body's scroll position.\n    var viewportTop = (bodyRect.top < 0 && body.scrollTop === 0) ?\n        -bodyRect.top :\n        document.body.scrollTop;\n\n    var viewportLeft = (bodyRect.left < 0 && body.scrollLeft === 0) ?\n        -bodyRect.left :\n        document.body.scrollLeft;\n\n    var viewportBottom = viewportTop + this.$window.innerHeight;\n    var viewportRight = viewportLeft + this.$window.innerWidth;\n\n    // Creates an overlay with a hole the same size as element. We remove a pixel or two\n    // on each end to make it overlap slightly. The overlay's background is added in\n    // the theme in the form of a box-shadow with a huge spread.\n    this.inputMask.css({\n      position: 'absolute',\n      left: this.leftMargin + 'px',\n      top: this.topMargin + 'px',\n      width: (elementRect.width - 1) + 'px',\n      height: (elementRect.height - 2) + 'px'\n    });\n\n    // If the right edge of the pane would be off the screen and shifting it left by the\n    // difference would not go past the left edge of the screen. If the time pane is too\n    // big to fit on the screen at all, move it to the left of the screen and scale the entire\n    // element down to fit.\n    var paneWidth = this.$mdMedia('xs')? TIME_PANE_WIDTH.XS : TIME_PANE_WIDTH.GTXS;\n    if (paneLeft + paneWidth > viewportRight) {\n      if (viewportRight - paneWidth > 0) {\n        paneLeft = viewportRight - paneWidth;\n      } else {\n        paneLeft = viewportLeft;\n        var scale = this.$window.innerWidth / paneWidth;\n        timePane.style.transform = 'scale(' + scale + ')';\n      }\n\n      timePane.classList.add('sg-timepicker-pos-adjusted');\n    }\n\n    // If the bottom edge of the pane would be off the screen and shifting it up by the\n    // difference would not go past the top edge of the screen.\n    var min = (typeof this.time == 'object' && this.time.getMinutes() % 5 === 0)? 'MIN5' : 'MIN1';\n    var paneHeight = this.$mdMedia('xs')? TIME_PANE_HEIGHT[min].XS : TIME_PANE_HEIGHT[min].GTXS;\n    if (paneTop + paneHeight > viewportBottom &&\n        viewportBottom - paneHeight > viewportTop) {\n      paneTop = viewportBottom - paneHeight;\n      timePane.classList.add('sg-timepicker-pos-adjusted');\n    }\n\n    timePane.style.left = paneLeft + 'px';\n    timePane.style.top = paneTop + 'px';\n    document.body.appendChild(timePane);\n\n    // Add CSS class after one frame to trigger open animation.\n    this.$$rAF(function() {\n      timePane.classList.add('md-pane-open');\n    });\n  };\n\n  /** Detach the floating time pane from the document. */\n  TimePickerCtrl.prototype.detachTimePane = function() {\n    this.$element.removeClass(OPEN_CLASS);\n    //this.mdInputContainer && this.mdInputContainer.element.removeClass(OPEN_CLASS);\n    angular.element(document.body).removeClass('md-datepicker-is-showing');\n    this.timePane.classList.remove('md-pane-open');\n    this.timePane.classList.remove('md-timepicker-pos-adjusted');\n\n    if (this.isTimeOpen) {\n      this.$mdUtil.enableScrolling();\n    }\n\n    if (this.timePane.parentNode) {\n      // Use native DOM removal because we do not want any of the angular state of this element\n      // to be disposed.\n      this.timePane.parentNode.removeChild(this.timePane);\n    }\n  };\n\n  /**\n   * Open the floating time pane.\n   * @param {Event} event\n   */\n  TimePickerCtrl.prototype.openTimePane = function(event) {\n    if (!this.isTimeOpen && !this.isDisabled) {\n      this.isTimeOpen = true;\n      this.timePaneOpenedFrom = event.target;\n\n      // Because the time pane is attached directly to the body, it is possible that the\n      // rest of the component (input, etc) is in a different scrolling container, such as\n      // an md-content. This means that, if the container is scrolled, the pane would remain\n      // stationary. To remedy this, we disable scrolling while the time pane is open, which\n      // also matches the native behavior for things like `<select>` on Mac and Windows.\n      this.$mdUtil.disableScrollAround(this.timePane);\n\n      this.attachTimePane();\n      //this.focusTime();\n      this.evalAttr('ngFocus');\n\n      // Attach click listener inside of a timeout because, if this open call was triggered by a\n      // click, we don't want it to be immediately propogated up to the body and handled.\n      var self = this;\n      this.$mdUtil.nextTick(function() {\n        // Use 'touchstart` in addition to click in order to work on iOS Safari, where click\n        // events aren't propogated under most circumstances.\n        // See http://www.quirksmode.org/blog/archives/2014/02/mouse_event_bub.html\n        self.documentElement.on('click touchstart', self.bodyClickHandler);\n      }, false);\n\n      window.addEventListener(this.windowEventName, this.windowEventHandler);\n    }\n  };\n\n  /** Close the floating time pane. */\n  TimePickerCtrl.prototype.closeTimePane = function() {\n    if (this.isTimeOpen) {\n      var self = this;\n\n      self.detachTimePane();\n      self.ngModelCtrl.$setTouched();\n      self.evalAttr('ngBlur');\n\n      self.documentElement.off('click touchstart', self.bodyClickHandler);\n      window.removeEventListener(self.windowEventName, self.windowEventHandler);\n\n      self.timePaneOpenedFrom.focus();\n      self.timePaneOpenedFrom = null;\n\n      self.isTimeOpen = false;\n    }\n  };\n\n  /** Gets the controller instance for the time in the floating pane. */\n  TimePickerCtrl.prototype.getTimePaneCtrl = function() {\n    return angular.element(this.timePane.querySelector('sg-time-pane')).controller('sgTimePane');\n  };\n\n  /** Focus the time in the floating pane. */\n  TimePickerCtrl.prototype.focusTime = function() {\n    // Use a timeout in order to allow the time to be rendered, as it is gated behind an ng-if.\n    var self = this;\n    this.$mdUtil.nextTick(function() {\n      var ctrl = self.getTimePaneCtrl();\n      self.getTimePaneCtrl().focus(null, ctrl);\n    }, false);\n  };\n\n  /**\n   * Sets whether the input is currently focused.\n   * @param {boolean} isFocused\n   */\n  TimePickerCtrl.prototype.setFocused = function(isFocused) {\n    if (!isFocused) {\n      this.ngModelCtrl.$setTouched();\n    }\n\n    this.evalAttr(isFocused ? 'ngFocus' : 'ngBlur');\n\n    this.isFocused = isFocused;\n  };\n\n  /**\n   * Handles a click on the document body when the floating time pane is open.\n   * Closes the floating time pane if the click is not inside of it.\n   * @param {MouseEvent} event\n   */\n  TimePickerCtrl.prototype.handleBodyClick = function(event) {\n    if (this.isTimeOpen) {\n      var isInTime = this.$mdUtil.getClosest(event.target, 'sg-time-pane');\n\n      if (!isInTime) {\n        this.closeTimePane();\n      }\n\n      this.$scope.$digest();\n    }\n  };\n\n  /**\n   * Handles the event when the user navigates away from the current tab. Keeps track of\n   * whether the input was focused when the event happened, in order to prevent the time pane\n   * from re-opening.\n   */\n  TimePickerCtrl.prototype.handleWindowBlur = function() {\n    this.inputFocusedOnWindowBlur = document.activeElement === this.inputElement;\n  };\n\n  /**\n   * Evaluates an attribute expression against the parent scope.\n   * @param {String} attr Name of the attribute to be evaluated.\n   */\n  TimePickerCtrl.prototype.evalAttr = function(attr) {\n    if (this.$attrs[attr]) {\n      this.$scope.$parent.$eval(this.$attrs[attr]);\n    }\n  };\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /*\n   * sgToggleGrid - Convert the tiles of a grid to toggle buttons\n   * @memberof SOGo.Common\n   * @restrict attribute\n   * @param {string} [sgToggleGridAttr] - the attribute that specifies if an object is enabled (toggled)\n   * @ngInject\n   * @example:\n\n    <md-grid-list md-cols=\"7\" md-row-height=\"1:1\"\n                  ng-model=\"editor.event.repeat.days\"\n                  sg-toggle-grid sg-toggle-grid-attr=\"day\">..</md-grid-list>\n  */\n  sgToggleGrid.$inject = ['$parse', '$mdUtil', '$mdColors'];\n  function sgToggleGrid($parse, $mdUtil, $mdColors) {\n    return {\n      restrict: 'A',\n      require: ['mdGridList', '?ngModel'],\n      compile: compile\n    };\n\n    function compile(tElement, tAttrs) {\n      return function postLink(scope, element, attr, controllers) {\n        var tiles = tElement.find('md-grid-tile'),\n            tile,\n            ngModelCtrl,\n            i,\n            modelDays = [],\n            modelAttr,\n            toggleClass;\n\n        ngModelCtrl = controllers[1] || $mdUtil.fakeNgModel();\n        ngModelCtrl.$render = render;\n        ngModelCtrl.$isEmpty = function(value) {\n          return !value || value.length === 0;\n        };\n\n        toggleClass = function() {\n          // Toggle class on click event and call toggle function\n          var tile = angular.element(this),\n              day = tile.attr('value');\n          tile.toggleClass('sg-active');\n          toggle(day);\n        };\n\n        for (i = 0; i < tiles.length; i++) {\n          tile = angular.element(tiles[i]);\n          tile.addClass('sg-icon-button');\n          tile.find('figure').addClass('md-icon');\n          tile.on('click', toggleClass);\n        }\n\n        function render() {\n          var flattenedDays = ngModelCtrl.$viewValue;\n          modelDays = ngModelCtrl.$viewValue;\n          if (tAttrs.sgToggleGridAttr) {\n            modelAttr = tAttrs.sgToggleGridAttr;\n            flattenedDays = _.map(ngModelCtrl.$viewValue, tAttrs.sgToggleGridAttr);\n          }\n          _.forEach(tiles, function(o) {\n            var tile = angular.element(o);\n            if (_.includes(flattenedDays, tile.attr('value'))) {\n              tile.addClass('sg-active');\n            }\n          });\n          ngModelCtrl.$validate();\n          setInvalid(ngModelCtrl.$invalid);\n        }\n\n        function setInvalid(invalid) {\n          var label = element.parent().children()[0];\n          if (invalid) {\n            element.addClass('sg-toggle-grid-invalid');\n            if (label.tagName == 'LABEL') {\n              label.style.color = $mdColors.getThemeColor('warn');\n            }\n          }\n          else {\n            element.removeClass('sg-toggle-grid-invalid');\n            if (label.tagName == 'LABEL') {\n              label.style.color = '';\n            }\n          }\n        }\n\n        function toggle(day) {\n          var i = _.findIndex(modelDays, function(o) {\n            if (modelAttr)\n              return o[modelAttr] == day;\n            else\n              return o == day;\n          });\n          if (i < 0) {\n            if (modelAttr) {\n              var o = {};\n              o[modelAttr] = day;\n              modelDays.push(o);\n            }\n            else\n              modelDays.push(day);\n          }\n          else\n            modelDays.splice(i, 1);\n\n          scope.$apply(function() {\n            ngModelCtrl.$setViewValue(modelDays);\n            ngModelCtrl.$setDirty();\n            ngModelCtrl.$validate();\n            setInvalid(ngModelCtrl.$invalid);\n          });\n        }\n      };\n    }\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgToggleGrid', sgToggleGrid);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /*\n   * sgToggleGrid - Convert the tiles of a grid to toggle buttons\n   * @memberof SOGo.Common\n   * @restrict attribute\n   * @param {object} sgToggleGrid - the model of the source objects\n   * @param {string} [sgToggleGridAttr] - the attribute that specifies if an object is enabled (toggled)\n   * @ngInject\n   * @example:\n\n    <md-grid-list md-cols=\"7\" md-row-height=\"1:1\"\n                  sg-toggle-grid=\"editor.event.repeat.days\"\n                  sg-toggle-grid-attr=\"day\">..</md-grid-list>\n  */\n  function sgVariableScrollShrink() {\n    return {\n      restrict: 'C',\n      link: link\n    };\n\n    function link(scope, element, attrs, ctrl) {\n      console.debug('scroll shrink height = ' + element.prop('offsetHeight'));\n    }\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgVariableScrollShrink', sgVariableScrollShrink);\n})();\n"]}