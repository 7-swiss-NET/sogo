{"version":3,"file":"Common.js","sources":["Common/utils.js","Common/Common.app.js","Common/decodeUri.filter.js","Common/encodeUri.filter.js","Common/loc.filter.js","Common/range.filter.js","Common/AclController.js","Common/navController.js","Common/Acl.service.js","Common/Alarm.service.js","Common/Authentication.service.js","Common/Dialog.service.js","Common/Gravatar.service.js","Common/Resource.service.js","Common/User.service.js","Common/sgFocus.service.js","Common/sgAvatarImage.directive.js","Common/sgColorPicker.directive.js","Common/sgCompile.directive.js","Common/sgEnter.directive.js","Common/sgEscape.directive.js","Common/sgFocus.directive.js","Common/sgFolderStylesheet.directive.js","Common/sgSearch.directive.js","Common/sgSubscribe.directive.js","Common/sgTarget.directive.js","Common/sgTimepicker.directive.js","Common/sgToggleGrid.directive.js"],"names":["l","key","arguments","value","labels","clabels","i","j","length","replace","configure","$mdThemingProvider","definePalette","50","100","200","300","400","500","600","700","800","900","A100","A200","A400","A700","contrastDefaultColor","contrastDarkColors","contrastLightColors","1000","theme","primaryPalette","default","hue-1","hue-2","hue-3","accentPalette","backgroundPalette","angular","module","baseURL","ApplicationBaseURL","activeUser","param","settings","login","UserLogin","identification","UserIdentification","email","UserEmail","language","UserLanguage","folderURL","UserFolderURL","isSuperUser","IsSuperUser","path","calendar","UserCalendarPath","contacts","UserContactsPath","mail","UserMailPath","preferences","UserPreferencesPath","administration","UserAdministrationPath","logoff","UserLogoffPath","constant","selection","sm","gt-sm","md","gt-md","lg","gt-lg","config","$inject","decodeUri","$window","decodeURIComponent","filter","encodeUri","encodeURIComponent","loc","range","n","res","parseInt","push","AclController","$mdDialog","Dialog","usersWithACL","User","folder","userFilter","$query","$filter","$acl","users","closeModal","$resetUsersRights","hide","saveModal","$saveUsersRights","then","data","status","alert","confirmChange","user","confirmation","$confirmRights","vm","showing","message","removeUser","$removeUser","uid","addUser","$addUser","userToAdd","searchText","error","selectUser","selectedUser","$rights","this","controller","navController","$scope","$timeout","$interval","$http","$mdSidenav","$mdBottomSheet","$mdMedia","$log","sgConstant","sgSettings","Alarm","currentDay","window","get","success","secondsBeforeTomorrow","toggleLeft","toggle","debug","toggleRight","openBottomSheet","show","parent","element","document","getElementById","templateUrl","toggleDetailView","detail","toggleClass","$watch","newVal","isGtMedium","getAlarms","Acl","folderId","factory","$q","Settings","Resource","extend","$$resource","$User","prototype","$users","_this","deferred","defer","resolve","promise","fetch","response","forEach","canSubscribeUser","isSubscribed","wasSubscribed","bind","_","indexOf","pluck","userClass","isGroup","reject","splice","$resetRights","deferredSave","deferredSubscribe","action","$rightsAreDirty","$omit","save","$shadowRights","copy","rights","uids","join","all","currentAlarm","AlarmService","$mdToast","$toast","now","Date","browserTime","Math","floor","getTime","alarms","sort","a","b","x","y","next","pop","utc","url","alarmTime","delay","f","showAlarm","cancel","AlarmController","scope","reminder","ok","position","hideDelay","template","summary","locals","Authentication","readCookie","name","foundCookie","prefix","pairs","currentPair","start","cookie","split","charAt","substr","readLoginCookie","loginValues","base64decode","redirectUrl","username","domain","userName","address","baseAddress","altBaseAddress","parts","hostpart","protocol","newAddress","location","href","startsWith","endsWith","getService","passwordPolicyConfig","service","d","password","rememberLogin","loginSuffix","method","loginCookie","expire","grace","msg","perr","LDAPPasswordPolicyError","PolicyNoError","PolicyAccountLocked","changePassword","newPassword","PolicyPasswordModNotAllowed","PolicyInsufficientPasswordQuality","PolicyPasswordTooShort","PolicyPasswordTooYoung","PolicyPasswordInHistory","formatted","PolicyPasswordUnknown","PolicyPasswordSystemUnknown","$get","PolicyPasswordChangeUnsupported","PolicyPasswordExpired","PolicyChangeAfterReset","PolicyMustSupplyOldPassword","provider","DialogService","$modal","title","content","confirm","options","prompt","label","PromptDialogController","o","body","clickOutsideToClose","escapeToClose","inputType","Gravatar","size","hash","s","substring","md5","_http","_q","_path","_activeUser","$factory","userResource","compact","escape","params","flatten","newguid","create","post","id","newValue","remove","userData","init","$gravatar","search","excludedUsers","when","results","index","compareUids","find","each","isUndefined","$$shortFormat","$shortFormat","$$image","image","c_email","empty","fullname","cn","no_email","$isAnonymous","$isSpecial","$confirmation","some","values","isEqual","zero","map","keys","isString","$folders","type","$$folders","folders","toString","sgFocus","$rootScope","$broadcast","sgAvatarImage","restrict","src","bindToController","controllerAs","sgAvatarImageController","$element","attributes","directive","sgColorPicker","$parse","link","iElement","iAttr","doSelect","attr","sgColorPickerController","sgColors","colors","select","color","sgCompile","$compile","sgCompileLink","attrs","ensureCompileRunsOnce","$eval","html","contents","sgEnter","ENTER_KEY","event","which","$apply","preventDefault","sgEscape","ESCAPE_KEY","elem","keyCode","sgFocusOn","$on","e","focus","sgFolderStylesheet","require","ngModel","sgSearchPreTransclude","compile","tElement","tAttr","inputEl","selectEl","buttonEl","removeAttr","compiledButtonEl","doSearch","on","cancelSearch","priority","sgSearch","transclude","clone","append","sgSearchController","previous","searchField","searchTextOptions","updateOn","debounce","blur","onChange","sgSubscribe","folderType","onFolderSelect","sgSubscribeDialogController","showDialog","sgSubscribeController","selectFolder","folderData","sgTarget","sgTargetLink","console","log","ensureTargetRunsOnce","timePaneDirective","TimePaneCtrl","controllers","ngModelCtrl","sgTimePaneCtrl","timePaneElement","configureNgModel","$attrs","$animate","$mdConstant","$mdTheming","$$mdDateUtil","$mdDateLocale","$mdInkRipple","$mdUtil","m","querySelector","KEY_CODE","dateUtil","nextTimePaneUniqueId","selectedTime","displayTime","isInitialized","hours","displayName","selected","min5","min1","ii","show5min","getToggleBtnLbl","is5min","toggleManual5min","manual5min","tabindex","self","hourClickHandler","displayVal","updated","setHours","Number","setNgModelValue","minuteClickHandler","val","setMinutes","attachTimePaneEventListeners","SELECTED_TIME_CLASS2","FOCUSED_TIME_CLASS","$render","changeSelectedTime","$viewValue","date","previousSelectedTime","changeDisplayTime","prevH","getHours","prevHCell","classList","setAttribute","prevM","getMinutes","prevMCell","prevM5Cell","mCell","newH","hCell","add","newM","isValidDate","buildInitialTimePaneDisplay","today","handleKeyEvent","ESCAPE","TAB","$emit","ENTER","mode","changed","$setViewValue","opt_date","previousFocus","timePickerDirective","placeholder","TimePickerCtrl","mdTimePickerCtrl","$$rAF","dateLocale","inputElement","inputContainer","timePane","timeButton","inputMask","isFocused","isDisabled","setDisabled","disabled","isTimeOpen","timePaneOpenedFrom","nextUid","bodyClickHandler","handleBodyClick","installPropertyInterceptors","attachChangeListeners","attachInteractionListeners","detachTimePane","EXTRA_INPUT_SIZE","INVALID_CLASS","DEFAULT_DEBOUNCE_INTERVAL","time","formatTime","resizeInputElement","t","h","closeTimePane","ngElement","handleInputEvent","keyCodes","altKey","DOWN_ARROW","openTimePane","$digest","ngDisabled","Object","defineProperty","set","inputString","arr","isDate","attachTimePane","addClass","elementRect","getBoundingClientRect","bodyRect","style","left","top","appendChild","width","removeClass","parentNode","removeChild","target","focusTime","disableScrollAround","nextTick","addEventListener","enableScrolling","removeEventListener","getTimePaneCtrl","ctrl","setFocused","isInTime","getClosest","sgToggleGrid","day","findIndex","modelDays","modelAttr","tile","ensureInitRunsOnce","tiles","days","isDefined","flattenedDays","sgToggleGridAttr","contains","String","suffix","pattern","isNumber","lastIndexOf","_base64_keyStr","base64encode","chr1","chr2","chr3","enc1","enc2","enc3","enc4","output","input","utf8encode","charCodeAt","isNaN","fromCharCode","L","k","K","G","I","F","H","r","q","p","u","aa","Z","D","Array","B","J","P","E","v","g","Y","X","W","V","C","S","Q","N","M","A","z","w","U","T","R","O","toLowerCase","capitalize","toUpperCase","slice","asDate","newDate","minutes","newString","daysUpTo","otherDate","day1","day2","tmp","nbrDays","round","setTime","isValidEmail","emailRE","test","asCSSIdentifier","characters","escapeds","re","RegExp","timeInterval","interval","stringWithSeparator","separator","month","getMonth","getDate","year","getYear","str","addDays","milliSeconds","addHours","nbrHours","addMinutes","nbrMinutes","beginOfDay","setSeconds","setMilliseconds","beginOfWeek","offset","firstDayOfWeek","getDay","endOfWeek","getDayString","getHourString"],"mappings":"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","sourcesContent":["/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\nString.prototype.endsWith = function(suffix) {\n  return this.indexOf(suffix, this.length - suffix.length) !== -1;\n};\n\nString.prototype.startsWith = function(pattern, position) {\n  position = angular.isNumber(position) ? position : 0;\n  return this.lastIndexOf(pattern, position) === position;\n};\n\nString.prototype._base64_keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\nString.prototype.base64encode = function () {\n  var output = \"\";\n  var chr1, chr2, chr3, enc1, enc2, enc3, enc4;\n  var i = 0;\n  \n  var input = this.utf8encode();\n\n  while (i < input.length) {\n    chr1 = input.charCodeAt(i++);\n    chr2 = input.charCodeAt(i++);\n    chr3 = input.charCodeAt(i++);\n    \n    enc1 = chr1 >> 2;\n    enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\n    enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\n    enc4 = chr3 & 63;\n    \n    if (isNaN(chr2)) {\n      enc3 = enc4 = 64;\n    } else if (isNaN(chr3)) {\n      enc4 = 64;\n    }\n    \n    output = output +\n      this._base64_keyStr.charAt(enc1) + this._base64_keyStr.charAt(enc2) +\n      this._base64_keyStr.charAt(enc3) + this._base64_keyStr.charAt(enc4);\n  }\n  \n  return output;\n};\n\nString.prototype.base64decode = function() { \n  var output = \"\";\n  var chr1, chr2, chr3;\n  var enc1, enc2, enc3, enc4;\n  var i = 0;\n  \n  var input = \"\" + this; // .replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\")\n  while (i < input.length) {\n    enc1 = this._base64_keyStr.indexOf(input.charAt(i++));\n    enc2 = this._base64_keyStr.indexOf(input.charAt(i++));\n    enc3 = this._base64_keyStr.indexOf(input.charAt(i++));\n    enc4 = this._base64_keyStr.indexOf(input.charAt(i++));\n\n    chr1 = (enc1 << 2) | (enc2 >> 4);\n    chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n    chr3 = ((enc3 & 3) << 6) | enc4;\n    \n    output = output + String.fromCharCode(chr1);\n    \n    if (enc3 != 64) {\n      output = output + String.fromCharCode(chr2);\n    }\n    if (enc4 != 64) {\n      output = output + String.fromCharCode(chr3);\n    }\n  }\n\n  return output;\n};\n\nString.prototype.md5 = function() {\n  if (!this.length) { return; }\n  // MD5 (Message-Digest Algorithm) by WebToolkit\n  var md5 = function(s){function L(k,d){return(k<<d)|(k>>>(32-d));}function K(G,k){var I,d,F,H,x;F=(G&2147483648);H=(k&2147483648);I=(G&1073741824);d=(k&1073741824);x=(G&1073741823)+(k&1073741823);if(I&d){return(x^2147483648^F^H);}if(I|d){if(x&1073741824){return(x^3221225472^F^H);}else{return(x^1073741824^F^H);}}else{return(x^F^H);}}function r(d,F,k){return(d&F)|((~d)&k);}function q(d,F,k){return(d&k)|(F&(~k));}function p(d,F,k){return(d^F^k);}function n(d,F,k){return(F^(d|(~k)));}function u(G,F,aa,Z,k,H,I){G=K(G,K(K(r(F,aa,Z),k),I));return K(L(G,H),F);}function f(G,F,aa,Z,k,H,I){G=K(G,K(K(q(F,aa,Z),k),I));return K(L(G,H),F);}function D(G,F,aa,Z,k,H,I){G=K(G,K(K(p(F,aa,Z),k),I));return K(L(G,H),F);}function t(G,F,aa,Z,k,H,I){G=K(G,K(K(n(F,aa,Z),k),I));return K(L(G,H),F);}function e(G){var Z;var F=G.length;var x=F+8;var k=(x-(x%64))/64;var I=(k+1)*16;var aa=Array(I-1);var d=0;var H=0;while(H<F){Z=(H-(H%4))/4;d=(H%4)*8;aa[Z]=(aa[Z]|(G.charCodeAt(H)<<d));H++;}Z=(H-(H%4))/4;d=(H%4)*8;aa[Z]=aa[Z]|(128<<d);aa[I-2]=F<<3;aa[I-1]=F>>>29;return aa;}function B(x){var k=\"\",F=\"\",G,d;for(d=0;d<=3;d++){G=(x>>>(d*8))&255;F=\"0\"+G.toString(16);k=k+F.substr(F.length-2,2);}return k;}function J(k){k=k.replace(/rn/g,\"n\");var d=\"\";for(var F=0;F<k.length;F++){var x=k.charCodeAt(F);if(x<128){d+=String.fromCharCode(x);}else{if((x>127)&&(x<2048)){d+=String.fromCharCode((x>>6)|192);d+=String.fromCharCode((x&63)|128);}else{d+=String.fromCharCode((x>>12)|224);d+=String.fromCharCode(((x>>6)&63)|128);d+=String.fromCharCode((x&63)|128);}}}return d;}var C=Array();var P,h,E,v,g,Y,X,W,V;var S=7,Q=12,N=17,M=22;var A=5,z=9,y=14,w=20;var o=4,m=11,l=16,j=23;var U=6,T=10,R=15,O=21;s=J(s);C=e(s);Y=1732584193;X=4023233417;W=2562383102;V=271733878;for(P=0;P<C.length;P+=16){h=Y;E=X;v=W;g=V;Y=u(Y,X,W,V,C[P+0],S,3614090360);V=u(V,Y,X,W,C[P+1],Q,3905402710);W=u(W,V,Y,X,C[P+2],N,606105819);X=u(X,W,V,Y,C[P+3],M,3250441966);Y=u(Y,X,W,V,C[P+4],S,4118548399);V=u(V,Y,X,W,C[P+5],Q,1200080426);W=u(W,V,Y,X,C[P+6],N,2821735955);X=u(X,W,V,Y,C[P+7],M,4249261313);Y=u(Y,X,W,V,C[P+8],S,1770035416);V=u(V,Y,X,W,C[P+9],Q,2336552879);W=u(W,V,Y,X,C[P+10],N,4294925233);X=u(X,W,V,Y,C[P+11],M,2304563134);Y=u(Y,X,W,V,C[P+12],S,1804603682);V=u(V,Y,X,W,C[P+13],Q,4254626195);W=u(W,V,Y,X,C[P+14],N,2792965006);X=u(X,W,V,Y,C[P+15],M,1236535329);Y=f(Y,X,W,V,C[P+1],A,4129170786);V=f(V,Y,X,W,C[P+6],z,3225465664);W=f(W,V,Y,X,C[P+11],y,643717713);X=f(X,W,V,Y,C[P+0],w,3921069994);Y=f(Y,X,W,V,C[P+5],A,3593408605);V=f(V,Y,X,W,C[P+10],z,38016083);W=f(W,V,Y,X,C[P+15],y,3634488961);X=f(X,W,V,Y,C[P+4],w,3889429448);Y=f(Y,X,W,V,C[P+9],A,568446438);V=f(V,Y,X,W,C[P+14],z,3275163606);W=f(W,V,Y,X,C[P+3],y,4107603335);X=f(X,W,V,Y,C[P+8],w,1163531501);Y=f(Y,X,W,V,C[P+13],A,2850285829);V=f(V,Y,X,W,C[P+2],z,4243563512);W=f(W,V,Y,X,C[P+7],y,1735328473);X=f(X,W,V,Y,C[P+12],w,2368359562);Y=D(Y,X,W,V,C[P+5],o,4294588738);V=D(V,Y,X,W,C[P+8],m,2272392833);W=D(W,V,Y,X,C[P+11],l,1839030562);X=D(X,W,V,Y,C[P+14],j,4259657740);Y=D(Y,X,W,V,C[P+1],o,2763975236);V=D(V,Y,X,W,C[P+4],m,1272893353);W=D(W,V,Y,X,C[P+7],l,4139469664);X=D(X,W,V,Y,C[P+10],j,3200236656);Y=D(Y,X,W,V,C[P+13],o,681279174);V=D(V,Y,X,W,C[P+0],m,3936430074);W=D(W,V,Y,X,C[P+3],l,3572445317);X=D(X,W,V,Y,C[P+6],j,76029189);Y=D(Y,X,W,V,C[P+9],o,3654602809);V=D(V,Y,X,W,C[P+12],m,3873151461);W=D(W,V,Y,X,C[P+15],l,530742520);X=D(X,W,V,Y,C[P+2],j,3299628645);Y=t(Y,X,W,V,C[P+0],U,4096336452);V=t(V,Y,X,W,C[P+7],T,1126891415);W=t(W,V,Y,X,C[P+14],R,2878612391);X=t(X,W,V,Y,C[P+5],O,4237533241);Y=t(Y,X,W,V,C[P+12],U,1700485571);V=t(V,Y,X,W,C[P+3],T,2399980690);W=t(W,V,Y,X,C[P+10],R,4293915773);X=t(X,W,V,Y,C[P+1],O,2240044497);Y=t(Y,X,W,V,C[P+8],U,1873313359);V=t(V,Y,X,W,C[P+15],T,4264355552);W=t(W,V,Y,X,C[P+6],R,2734768916);X=t(X,W,V,Y,C[P+13],O,1309151649);Y=t(Y,X,W,V,C[P+4],U,4149444226);V=t(V,Y,X,W,C[P+11],T,3174756917);W=t(W,V,Y,X,C[P+2],R,718787259);X=t(X,W,V,Y,C[P+9],O,3951481745);Y=K(Y,h);X=K(X,E);W=K(W,v);V=K(V,g);}var i=B(Y)+B(X)+B(W)+B(V);return i.toLowerCase();};\n  return md5(this.toLowerCase());\n};\n\nString.prototype.capitalize = function() {\n  return this.charAt(0).toUpperCase() + this.slice(1);\n};\n\nString.prototype.asDate = function () {\n    var newDate;\n    var date = this.split(\"/\");\n    if (date.length == 3)\n        newDate = new Date(date[2], date[1] - 1, date[0]); // dd/mm/yyyy\n    else {\n        date = this.split(\"-\");\n        if (date.length == 3)\n            newDate = new Date(date[0], date[1] - 1, date[2]); // yyyy-mm-dd\n        else {\n            if (this.length == 8) {\n                newDate = new Date(this.substring(0, 4),\n                                   this.substring(4, 6) - 1,\n                                   this.substring(6, 8)); // yyyymmdd\n            }\n        }\n    }\n\n    return newDate;\n};\n\nString.prototype.formatTime = function(hours, minutes) {\n    var newString = this;\n\n    // See http://www.gnustep.org/resources/documentation/Developer/Base/Reference/NSCalendarDate.html#method$NSCalendarDate-descriptionWithCalendarFormat$\n    var p = 'am', i = hours, m = minutes;\n    if (hours > 12) {\n        p = 'pm';\n        i = hours % 12;\n    }\n    if (minutes < 10) {\n        m = '0' + minutes;\n    }\n\n    // %H : hour as a decimal number using 24-hour clock\n    newString = newString.replace(\"%H\", hours < 10 ? '0' + hours : hours);\n    // %I : hour as a decimal number using 12-hour clock\n    newString = newString.replace(\"%I\", i < 10 ? '0' + i : i);\n    // %M : minute as decimal number\n    newString = newString.replace(\"%M\", m);\n    // %p : 'am' or 'pm'\n    newString = newString.replace(\"%p\", p);\n\n    return newString;\n};\n\nDate.prototype.daysUpTo = function(otherDate) {\n    var days = [];\n\n    var day1 = this.getTime();\n    var day2 = otherDate.getTime();\n    if (day1 > day2) {\n        var tmp = day1;\n        day1 = day2;\n        day2 = tmp;\n    }\n\n    var nbrDays = Math.round((day2 - day1) / 86400000) + 1;\n    for (var i = 0; i < nbrDays; i++) {\n        var newDate = new Date();\n        newDate.setTime(day1 + (i * 86400000));\n        days.push(newDate);\n    }\n\n    return days;\n};\n\nString.prototype.isValidEmail = function() {\n  var emailRE = /^([\\w\\!\\#$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`{\\|\\}\\~]+\\.)*[\\w\\!\\#$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`{\\|\\}\\~]+@((((([a-z0-9]{1}[a-z0-9\\-]{0,62}[a-z0-9]{1})|[a-z])\\.)+[a-z]{2,})|(\\d{1,3}\\.){3}\\d{1,3}(\\:\\d{1,5})?)$/i;\n  return emailRE.test(this);\n};\n\nString.prototype.asCSSIdentifier = function() {\n  var characters = [ '_'  , '\\\\.', '#'  , '@'  , '\\\\*', ':'  , ','   , ' ',    \"'\",    '&',    '\\\\+' ];\n  var escapeds =   [ '_U_', '_D_', '_H_', '_A_', '_S_', '_C_', '_CO_', '_SP_', '_SQ_', '_AM_', '_P_' ];\n\n  var newString = this;\n  for (var i = 0; i < characters.length; i++) {\n    var re = new RegExp(characters[i], 'g');\n    newString = newString.replace(re, escapeds[i]);\n  }\n\n  if (/^\\d+/.test(newString)) {\n    newString = '_' + newString;\n  }\n\n  return newString;\n};\n\nString.prototype.timeInterval = function () {\n  var interval;\n  if (this == \"once_per_hour\")\n    interval = 3600;\n  else if (this == \"every_minute\")\n    interval = 60;\n  else {\n    interval = parseInt(this.substr(6)) * 60;\n  }\n\n  return interval;\n};\n\nDate.prototype.stringWithSeparator = function(separator) {\n    var month = '' + (this.getMonth() + 1);\n    var day = '' + this.getDate();\n    var year = this.getYear();\n    if (year < 1000)\n        year = '' + (year + 1900);\n    if (month.length == 1)\n        month = '0' + month;\n    if (day.length == 1)\n        day = '0' + day;\n\n    if (separator == '-')\n        str = year + '-' + month + '-' + day;\n    else\n        str = day + '/' + month + '/' + year;\n\n    return str;\n};\n\nDate.prototype.addDays = function(nbrDays) {\n    var milliSeconds = this.getTime();\n    milliSeconds += 86400000 * nbrDays;\n    this.setTime(milliSeconds);\n};\n\nDate.prototype.addHours = function(nbrHours) {\n  var milliSeconds = this.getTime();\n  milliSeconds += 3600000 * nbrHours;\n  this.setTime(milliSeconds);\n};\n\nDate.prototype.addMinutes = function(nbrMinutes) {\n  var milliSeconds = this.getTime();\n  milliSeconds += 60000 * nbrMinutes;\n  this.setTime(milliSeconds);\n};\n\nDate.prototype.beginOfDay = function() {\n    var beginOfDay = new Date(this.getTime());\n    beginOfDay.setHours(0);\n    beginOfDay.setMinutes(0);\n    beginOfDay.setSeconds(0);\n    beginOfDay.setMilliseconds(0);\n\n    return beginOfDay;\n};\n\nDate.prototype.beginOfWeek = function() {\n    var offset = firstDayOfWeek - this.getDay();\n    if (offset > 0)\n        offset -= 7;\n\n    var beginOfWeek = this.beginOfDay();\n    beginOfWeek.setHours(12);\n    beginOfWeek.addDays(offset);\n\n    return beginOfWeek;\n};\n\nDate.prototype.endOfWeek = function() {\n    var endOfWeek = this.beginOfWeek();\n    endOfWeek.addDays(6);\n\n    endOfWeek.setHours(23);\n    endOfWeek.setMinutes(59);\n    endOfWeek.setSeconds(59);\n    endOfWeek.setMilliseconds(999);\n\n    return endOfWeek;\n};\n\n// YYYYMMDD\nDate.prototype.getDayString = function() {\n    var newString = this.getYear();\n    if (newString < 1000) newString += 1900;\n    var month = '' + (this.getMonth() + 1);\n    if (month.length == 1)\n        month = '0' + month;\n    newString += month;\n    var day = '' + this.getDate();\n    if (day.length == 1)\n        day = '0' + day;\n    newString += day;\n\n    return newString;\n};\n\n// MMHH\nDate.prototype.getHourString = function() {\n    var newString = this.getHours() + '00';\n    if (newString.length == 3)\n        newString = '0' + newString;\n\n    return newString;\n};\n\nfunction l() {\n  var key = arguments[0];\n  var value = key;\n  if (labels[key]) {\n    value = labels[key];\n  }\n  else if (clabels[key]) {\n    value = clabels[key];\n  }\n  for (var i = 1, j = 0; i < arguments.length; i++, j++) {\n    value = value.replace('%{' + j + '}', arguments[i]);\n  }\n\n  return value;\n}\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  angular.module('SOGo.Common', ['ngMaterial'])\n    .value('sgSettings', {\n      baseURL: function() {\n        return ApplicationBaseURL || null;\n      },\n      activeUser: function(param) {\n        var settings = {\n          login: UserLogin || null,\n          identification: UserIdentification || null,\n          email: UserEmail || null,\n          language: UserLanguage || null,\n          folderURL: UserFolderURL || null,\n          isSuperUser: IsSuperUser || null,\n          path: {\n            calendar: UserCalendarPath || null,\n            contacts: UserContactsPath || null,\n            mail: UserMailPath || null,\n            preferences: UserPreferencesPath || null,\n            administration: (IsSuperUser ? UserAdministrationPath : null),\n            logoff: UserLogoffPath || null\n          }\n        };\n        if (param)\n          return settings[param];\n        else\n          return settings;\n      }\n    })\n\n    .constant('sgColors', {\n      selection: [\n        '#FFFFFF',\n        '#330033',\n        '#C0C0C0',\n        '#999999',\n        '#666666',\n        '#333333',\n        '#000000',\n        '#FFCCCC',\n        '#FF6666',\n        '#FF0000',\n        '#CC0000',\n        '#990000',\n        '#660000',\n        '#330000',\n        '#FFCC99',\n        '#FF9966',\n        '#FF9900',\n        '#FF6600',\n        '#CC6600',\n        '#993300',\n        '#663300',\n        '#FFFF99',\n        '#FFFF66',\n        '#FFCC66',\n        '#FFCC33',\n        '#CC9933',\n        '#996633',\n        '#663333',\n        '#FFFFCC',\n        '#FFFF33',\n        '#FFFF00',\n        '#FFCC00',\n        '#999900',\n        '#666600',\n        '#333300',\n        '#CCCCCC',\n        '#66FF99',\n        '#33FF33',\n        '#33CC00',\n        '#009900',\n        '#006600',\n        '#003300',\n        '#99FFFF',\n        '#33FFFF',\n        '#66CCCC',\n        '#00CCCC',\n        '#339999',\n        '#336666',\n        '#003333',\n        '#CCFFFF',\n        '#66FFFF',\n        '#33CCFF',\n        '#3366FF',\n        '#3333FF',\n        '#000099',\n        '#000066',\n        '#CCCCFF',\n        '#9999FF',\n        '#6666CC',\n        '#6633FF',\n        '#6600CC',\n        '#333399',\n        '#330099',\n        '#FFCCFF',\n        '#FF99FF',\n        '#CC66CC',\n        '#CC33CC',\n        '#993399',\n        '#663366',\n        '#99FF99'\n      ]\n    })\n\n  // md break-points values are hard-coded in angular-material/src/core/util/constant.js\n  // $mdMedia has a built-in support for those values but can also evaluate others\n  // For some reasons, angular-material's break-points don't match the specs\n  // Here we define values according to specs\n    .constant('sgConstant', {\n      'sm': '(max-width: 600px)',\n      'gt-sm': '(min-width: 600px)',\n      'md': '(min-width: 600px) and (max-width: 1024px)',\n      'gt-md': '(min-width: 1025px)',\n      'lg': '(min-width: 1024px) and (max-width: 1280px)',\n      'gt-lg': '(min-width: 1280px)'\n    })\n\n    .config(configure);\n\n  configure.$inject = ['$mdThemingProvider'];\n  function configure($mdThemingProvider) {\n    $mdThemingProvider.definePalette('sogo-green', {\n      '50': 'eaf5e9',\n      '100': 'cbe5c8',\n      '200': 'aad6a5',\n      '300': '88c781',\n      '400': '66b86a',\n      '500': '56b04c',\n      '600': '4da143',\n      '700': '388e3c',\n      '800': '367d2e',\n      '900': '225e1b',\n      'A100': 'b9f6ca',\n      'A200': '69f0ae',\n      'A400': '00e676',\n      'A700': '00c853',\n      'contrastDefaultColor': 'dark',\n      'contrastDarkColors': '50 100 200',\n      'contrastLightColors': '300 400 500 600 700 800 900'\n    });\n    $mdThemingProvider.definePalette('sogo-blue', {\n      '50': 'f0faf9',\n      '100': 'e1f5f3',\n      '200': 'ceebe8',\n      '300': 'bfe0dd',\n      '400': 'b2d6d3',\n      '500': 'a1ccc8',\n      '600': '8ebfbb',\n      '700': '7db3b0',\n      '800': '639997',\n      '900': '4d8080',\n      'A100': 'd4f7fa',\n      'A200': 'c3f5fa',\n      'A400': '53e3f0',\n      'A700': '00b0c0',\n      'contrastDefaultColor': 'light',\n      'contrastDarkColors': ['50', '100', '200'],\n      'contrastLightColors': ['300', '400', '500', '600', '700', '800', '900', 'A100', 'A200', 'A400', 'A700']\n    });\n    $mdThemingProvider.definePalette('sogo-paper', {\n      '50': 'fcf7f8',\n      '100': 'f7f1dc',\n      '200': 'ede5ca',\n      '300': 'e6d8ba',\n      '400': 'e2d2a3',\n      '500': 'd6c48d',\n      '600': 'baa870',\n      '700': '857545',\n      '800': '524517',\n      '900': '433809',\n      '1000': '000000',\n      'A100': 'ffffff',\n      'A200': 'eeeeee',\n      'A400': 'bdbdbd',\n      'A700': '616161',\n      'contrastDefaultColor': 'dark',\n      'contrastLightColors': '800 900'\n    });\n    // Default theme definition\n    // .primaryColor will soon be deprecated in favor of primaryPalette (already on dev builds https://groups.google.com/forum/m/#!topic/ngmaterial/-sXR8CYBMPg)\n    $mdThemingProvider.theme('default')\n      .primaryPalette('sogo-blue', {\n        'default': '300',\n        'hue-1': '100',\n        'hue-2': '400',\n        'hue-3': 'A700'\n      })\n      .accentPalette('sogo-green', {\n        'default': '500',\n        'hue-1': '200',\n        'hue-2': '300',\n        'hue-3': 'A700'\n      })\n      .backgroundPalette('sogo-paper', {\n        'default': '100',\n        'hue-1': '200',\n        'hue-2': '50',\n        'hue-3': '500'\n      });\n  }\n\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n/**\n * @type {angular.Module}\n */\n(function () {\n  'use strict';\n\n  /**\n   * @ngInject\n   */\n  decodeUri.$inject = ['$window'];\n  function decodeUri($window) {\n    return $window.decodeURIComponent;\n  }\n\n  angular.module('SOGo.Common')\n    .filter('decodeUri', decodeUri);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n/**\n * @type {angular.Module}\n */\n(function () {\n  'use strict';\n\n  /**\n   * @ngInject\n   */\n  encodeUri.$inject = ['$window'];\n  function encodeUri($window) {\n    return $window.encodeURIComponent;\n  }\n\n  angular.module('SOGo.Common')\n    .filter('encodeUri', encodeUri);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n/**\n * loc - A simple filter to return the localized version of a string.\n * @memberof SOGo.Common\n */\n(function () {\n  'use strict';\n\n  /**\n   * @ngInject\n   */\n  function loc() {\n    return l;\n  }\n\n  angular.module('SOGo.Common')\n    .filter('loc', loc);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n/**\n * range - A simple filter that will return an array of the size of its argument.\n * @memberof SOGo.Common\n */\n(function () {\n  'use strict';\n\n  function range() {\n    return function(n) {\n      var res = [];\n      for (var i = 0; i < parseInt(n); i++) {\n        res.push(i);\n      }\n      return res;\n    };\n  }\n\n  angular.module('SOGo.Common')\n    .filter('range', range);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * @ngInject\n   */\n  AclController.$inject = ['$mdDialog', 'Dialog', 'usersWithACL', 'User', 'folder'];\n  function AclController($mdDialog, Dialog, usersWithACL, User, folder) {\n    var vm = this;\n\n    vm.users = usersWithACL; // ACL users\n    vm.folder = folder;\n    vm.selectedUser = null;\n    vm.userToAdd = '';\n    vm.searchText = '';\n    vm.userFilter = userFilter;\n    vm.closeModal = closeModal;\n    vm.saveModal = saveModal;\n    vm.confirmChange = confirmChange;\n    vm.removeUser = removeUser;\n    vm.addUser = addUser;\n    vm.selectUser = selectUser;\n    vm.confirmation = { showing: false,\n                        message: ''};\n\n    function userFilter($query) {\n      return User.$filter($query, folder.$acl.users);\n    }\n\n    function closeModal() {\n      folder.$acl.$resetUsersRights(); // cancel changes\n      $mdDialog.hide();\n    }\n\n    function saveModal() {\n      folder.$acl.$saveUsersRights().then(function() {\n        $mdDialog.hide();\n      }, function(data, status) {\n        Dialog.alert(l('Warning'), l('An error occured please try again.'));\n      });\n    }\n\n    function confirmChange(user) {\n      var confirmation = user.$confirmRights();\n      if (confirmation) {\n        vm.confirmation.showing = true;\n        vm.confirmation.message = confirmation;\n      }\n    }\n\n    function removeUser(user) {\n      folder.$acl.$removeUser(user.uid).catch(function(data, status) {\n        Dialog.alert(l('Warning'), l('An error occured please try again.'));\n      });\n    }\n\n    function addUser(data) {\n      if (data) {\n        folder.$acl.$addUser(data).then(function() {\n          vm.userToAdd = '';\n          vm.searchText = '';\n        }, function(error) {\n          Dialog.alert(l('Warning'), error);\n        });\n      }\n    }\n\n    function selectUser(user) {\n      if (vm.selectedUser == user) {\n        vm.selectedUser = null;\n      }\n      else {\n        vm.selectedUser = user;\n        vm.selectedUser.$rights();\n      }\n    }\n  }\n\n  angular\n    .module('SOGo.Common')\n    .controller('AclController', AclController);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n/**\n * @type {angular.Module}\n */\n(function () {\n  'use strict';\n\n  /**\n   * @ngInject\n   */\n  navController.$inject =  ['$scope', '$timeout', '$interval', '$http', '$mdSidenav', '$mdBottomSheet', '$mdMedia', '$log', 'sgConstant', 'sgSettings', 'Alarm'];\n  function navController($scope, $timeout, $interval, $http, $mdSidenav, $mdBottomSheet, $mdMedia, $log, sgConstant, sgSettings, Alarm) {\n\n    $scope.activeUser = sgSettings.activeUser();\n    $scope.baseURL = sgSettings.baseURL();\n\n    // Show current day in top bar\n    $scope.currentDay = window.currentDay;\n    $timeout(function() {\n      // Update date when day ends\n      $interval(function() {\n        $http.get('../date').success(function(data) {\n          $scope.currentDay = data;\n        });\n      }, 24 * 3600 * 1000);\n    }, window.currentDay.secondsBeforeTomorrow * 1000);\n\n    $scope.toggleLeft = function () {\n      $mdSidenav('left').toggle()\n        .then(function () {\n          $log.debug(\"toggle left is done\");\n        });\n    };\n    $scope.toggleRight = function () {\n      $mdSidenav('right').toggle()\n        .then(function () {\n          $log.debug(\"toggle RIGHT is done\");\n        });\n    };\n    $scope.openBottomSheet = function() {\n      $mdBottomSheet.show({\n        parent: angular.element(document.getElementById('left-sidenav')),\n        templateUrl: 'bottomSheetTemplate.html'\n      });\n    };\n    $scope.toggleDetailView = function() {\n      var detail = angular.element(document.getElementById('detailView'));\n      detail.toggleClass('sg-close');\n    };\n    $scope.$watch(function() {\n      return $mdMedia(sgConstant['gt-md']);\n    }, function(newVal) {\n      $scope.isGtMedium = newVal;\n    });\n\n    Alarm.getAlarms();\n  }\n\n  angular.module('SOGo.Common')\n    .controller('navController', navController);\n})();\n","(function() {\n  'use strict';\n\n  /**\n   * @name Acl\n   * @constructor\n   * @param {String} folderId - the folder ID associated to the ACLs\n   */\n  function Acl(folderId) {\n    this.folderId = folderId;\n  }\n\n  /**\n   * @memberof Acl\n   * @desc The factory we'll use to register with Angular.\n   * @return the Acl constructor\n   */\n  Acl.factory = ['$q', '$timeout', 'sgSettings', 'Resource', 'User', function($q, $timeout, Settings, Resource, User) {\n    angular.extend(Acl, {\n      $q: $q,\n      $timeout: $timeout,\n      $$resource: new Resource(Settings.activeUser('folderURL'), Settings.activeUser()),\n      $User: User\n    });\n\n    return Acl;\n  }];\n\n  /**\n   * @module SOGo.Common\n   * @desc Factory registration of User in Angular module.\n   */\n  angular.module('SOGo.Common').factory('Acl', Acl.factory);\n\n  /**\n   * @function $users\n   * @memberof Acl.prototype\n   * @desc Fetch the list of users that have specific rights for the current folder.\n   * @return a promise of an array of User objects\n   */\n  Acl.prototype.$users = function() {\n    var _this = this,\n        deferred = Acl.$q.defer(),\n        user;\n    if (this.users) {\n      deferred.resolve(this.users);\n    }\n    else {\n      return Acl.$$resource.fetch(this.folderId, 'acls').then(function(response) {\n        _this.users = [];\n        //console.debug(JSON.stringify(users, undefined, 2));\n        angular.forEach(response.users, function(data) {\n          user = new Acl.$User(data);\n          user.canSubscribeUser = user.isSubscribed;\n          user.wasSubscribed = user.isSubscribed;\n          user.$rights = angular.bind(user, user.$acl, _this.folderId);\n          _this.users.push(user);\n        });\n        deferred.resolve(_this.users);\n        return _this.users;\n      });\n    }\n    return deferred.promise;\n  };\n\n  /**\n   * @function $addUser\n   * @memberof Acl.prototype\n   * @param {Object} user - a User object with minimal set of attributes (uid, isGroup, cn, c_email)\n   * @see {@link User.$filter}\n   */\n  Acl.prototype.$addUser = function(user) {\n    var _this = this,\n        deferred = Acl.$q.defer(),\n        param = {uid: user.uid};\n    if (!user.uid || _.indexOf(_.pluck(this.users, 'uid'), user.uid) > -1) {\n      // No UID specified or user already in ACLs\n      deferred.resolve();\n    }\n    else {\n      Acl.$$resource.fetch(this.folderId, 'addUserInAcls', param).then(function() {\n        user.wasSubscribed = false;\n        user.userClass = user.isGroup ? 'group-user' : 'normal-user';\n        user.$rights = angular.bind(user, user.$acl, _this.folderId);\n        _this.users.push(user);\n        deferred.resolve(_this.users);\n      }, function(data, status) {\n        deferred.reject(l('An error occured please try again.'));\n      });\n    }\n    return deferred.promise;\n  };\n\n  /**\n   * @function $removeUser\n   * @memberof Acl.prototype\n   * @desc Remove a user from the folder's ACL\n   * @return a promise of the server call to remove the user from the folder's ACL\n   */\n  Acl.prototype.$removeUser = function(uid) {\n    var _this = this,\n        param = {uid: uid};\n    return Acl.$$resource.fetch(this.folderId, 'removeUserFromAcls', param).then(function() {\n      var i = _.indexOf(_.pluck(_this.users, 'uid'), uid);\n      if (i >= 0) {\n        _this.users.splice(i, 1);\n      }\n    });\n  };\n\n  /**\n   * @function $resetUsersRights\n   * @memberof Acl.prototype\n   * @desc Restore initial rights of all users.\n   */\n  Acl.prototype.$resetUsersRights = function() {\n    angular.forEach(this.users, function(user) {\n      user.$resetRights();\n    });\n  };\n\n  /**\n   * @function $saveUsersRights\n   * @memberof Acl.prototype\n   * @desc Save user rights that have changed and subscribe users that have been selected.\n   * @return a promise that resolved only if the modifications and subscriptions were successful\n   */\n  Acl.prototype.$saveUsersRights = function() {\n    var _this = this,\n        deferredSave = Acl.$q.defer(),\n        deferredSubscribe = Acl.$q.defer(),\n        param = {action: 'saveUserRights'},\n        users = [];\n\n    // Save user rights\n    angular.forEach(this.users, function(user) {\n      if (user.$rightsAreDirty()) {\n        users.push(user.$omit());\n        // console.debug('save ' + JSON.stringify(user.$omit(), undefined, 2));\n      }\n    });\n    if (users.length) {\n      Acl.$$resource.save(this.folderId, users, param)\n        .then(function() {\n          // Save was successful; copy rights to shadow rights\n          angular.forEach(_this.users, function(user) {\n            if (user.$rightsAreDirty()) {\n              user.$shadowRights = angular.copy(user.rights);\n            }\n          });\n          deferredSave.resolve();\n        }, deferredSave.reject);\n    }\n    else {\n      deferredSave.resolve();\n    }\n\n    // Subscribe users\n    users = [];\n    angular.forEach(this.users, function(user) {\n      if (!user.wasSubscribed && user.isSubscribed) {\n        users.push(user.uid);\n        // console.debug('subscribe ' + user.uid);\n      }\n    });\n    if (users.length) {\n      param = {uids: users.join(',')};\n      Acl.$$resource.fetch(this.folderId, 'subscribeUsers', param)\n        .then(function() {\n          // Subscribe was successful; reset \"wasSubscribed\" attribute\n          angular.forEach(_this.users, function(user) {\n            user.wasSubscribed = user.isSubscribed;\n          });\n          deferredSubscribe.resolve();\n        }, deferredSubscribe.reject);\n    }\n    else {\n      deferredSubscribe.resolve();\n    }\n    return Acl.$q.all([deferredSave.promise, deferredSubscribe.promise]);\n  };\n\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * @name Alarm\n   * @constructor\n   */\n  function Alarm() {\n    this.currentAlarm = null;\n  }\n\n  /**\n   * @name getAlarms\n   * @desc Fetch the list of alarms from the server and use the last one\n   */\n  Alarm.getAlarms = function() {\n    var _this = this;\n    var now = new Date();\n    var browserTime = Math.floor(now.getTime()/1000);\n\n    this.$$resource.fetch('', 'alarmslist?browserTime=' + browserTime).then(function(data) {\n      \n      var alarms = data.alarms.sort(function reverseSortByAlarmTime(a, b) {\n        var x = parseInt(a[2]);\n        var y = parseInt(b[2]);\n        return (y - x);\n      });\n\n      if (alarms.length > 0) {\n        var next = alarms.pop();\n        var now = new Date();\n        var utc = Math.floor(now.getTime()/1000);\n        var url = next[0] + '/' + next[1];\n        var alarmTime = parseInt(next[2]);\n        var delay = alarmTime;\n        if (alarmTime > 0) delay -= utc;\n        var d = new Date(alarmTime*1000);\n        //console.log (\"now = \" + now.toUTCString());\n        //console.log (\"next event \" + url + \" in \" + delay + \" seconds (on \" + d.toUTCString() + \")\");\n\n        var f = angular.bind(_this, Alarm.showAlarm, url);\n\n        if (_this.currentAlarm)\n          _this.$timeout.cancel(_this.currentAlarm);\n\n        _this.currentAlarm = _this.$timeout(f, delay*1000);\n      }\n    });\n  };\n  \n  /**\n   * @name showAlarm\n   * @desc Show the latest alarm using a toast\n   * @param url The URL of the calendar component for snoozing\n   */\n  Alarm.showAlarm = function(url) {\n    var _this = this;\n\n    this.$$resource.fetch(url, '?resetAlarm=yes').then(function(data) {\n      _this.$toast.show({\n        position: 'top right',\n        hideDelay: 0,\n        template: [\n          '<md-toast>',\n          ' <md-input-container>',\n          '   <label style=\"color: white;\">' + data.summary + '</label>',\n          '   <md-select ng-model=\"reminder\">',\n          '    <md-option value=5>',\n                 l('5 minutes'),\n          '    </md-option>',\n          '    <md-option value=10>',\n                 l('10 minutes'),\n          '    </md-option>',\n          '    <md-option value=15>',\n                 l('15 minutes'),\n          '    </md-option>',\n          '    <md-option value=30>',\n                 l('30 minutes'),\n          '    </md-option>',\n          '    <md-option value=45>',\n                 l('45 minutes'),\n          '    </md-option>',\n          '    <md-option value=60>',\n                 l('1 hour'),\n          '    </md-option>',\n          '    <md-option value=1440>',\n                 l('1 day'),\n          '    </md-option>',\n          '  </md-select>',\n          ' </md-input-container>',\n          ' <md-button ng-click=\"cancel()\">',\n              l('Cancel'),\n          ' </md-button>',\n          ' <md-button ng-click=\"ok()\">',\n              l('Ok'),\n          ' </md-button>',\n          '</md-toast>'\n        ].join(''),\n        locals: {\n          url: url\n        },\n        controller: AlarmController\n      });\n\n      /**\n       * @ngInject\n       */\n      AlarmController.$inject = ['scope', '$mdToast', 'url'];\n      function AlarmController(scope, $mdToast, url) {\n        scope.reminder = '10';\n        scope.cancel = function() {\n          $mdToast.hide();\n        };\n        scope.ok = function() {\n          _this.$$resource.fetch(url, 'view?snoozeAlarm=' + scope.reminder);\n          $mdToast.hide();\n        };\n      }\n    });\n  };\n\n  /**\n   * @memberof Alarm\n   * @desc The factory we'll register as Alarm in the Angular module SOGo.Common\n   * @ngInject\n   */\n  AlarmService.$inject = ['$timeout', 'sgSettings', 'Resource', '$mdToast'];\n  function AlarmService($timeout, Settings, Resource, $mdToast) {\n    angular.extend(Alarm, {\n      $timeout: $timeout,\n      $$resource: new Resource(Settings.activeUser('folderURL') + 'Calendar', Settings.activeUser()),\n      $toast: $mdToast\n    });\n\n    return Alarm; // return constructor\n  }\n\n  /* Factory registration in Angular module */\n  angular\n    .module('SOGo.Common')\n    .factory('Alarm', AlarmService);\n\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n/* JavaScript for Authentication */\n\n(function() {\n  /* jshint validthis: true */\n  'use strict';\n\n  angular.module('SOGo.Authentication', [])\n\n    .constant('passwordPolicyConfig', {\n      PolicyPasswordChangeUnsupported: -3,\n      PolicyPasswordSystemUnknown: -2,\n      PolicyPasswordUnknown: -1,\n      PolicyPasswordExpired: 0,\n      PolicyAccountLocked: 1,\n      PolicyChangeAfterReset: 2,\n      PolicyPasswordModNotAllowed: 3,\n      PolicyMustSupplyOldPassword: 4,\n      PolicyInsufficientPasswordQuality: 5,\n      PolicyPasswordTooShort: 6,\n      PolicyPasswordTooYoung: 7,\n      PolicyPasswordInHistory: 8,\n      PolicyNoError: 65535\n    })\n\n  // TODO: convert to a Factory recipe?\n  .provider('Authentication', Authentication);\n\n  function Authentication() {\n    function readCookie(name) {\n      var foundCookie, prefix, pairs, i, currentPair, start;\n      foundCookie = null;\n      prefix = name + '=';\n      pairs = document.cookie.split(';');\n      for (i = 0; !foundCookie && i < pairs.length; i++) {\n        currentPair = pairs[i];\n        start = 0;\n        while (currentPair.charAt(start) == ' ')\n          start++;\n        if (start > 0)\n          currentPair = currentPair.substr(start);\n        if (currentPair.indexOf(prefix) === 0)\n          foundCookie = currentPair.substr(prefix.length);\n      }\n\n      return foundCookie;\n    }\n\n    function readLoginCookie() {\n      var loginValues = null,\n          cookie = readCookie('0xHIGHFLYxSOGo'),\n          value;\n      if (cookie && cookie.length > 8) {\n        value = decodeURIComponent(cookie.substr(8));\n        loginValues = value.base64decode().split(':');\n      }\n\n      return loginValues;\n    }\n\n    function redirectUrl(username, domain) {\n      var userName, address, baseAddress, altBaseAddress, parts, hostpart, protocol, newAddress;\n\n      userName = username;\n      if (domain)\n        userName += '@' + domain.value;\n      address = '' + window.location.href;\n      baseAddress = ApplicationBaseURL + '/' + encodeURIComponent(userName);\n      if (baseAddress[0] == '/') {\n        parts = address.split('/');\n        hostpart = parts[2];\n        protocol = parts[0];\n        baseAddress = protocol + '//' + hostpart + baseAddress;\n      }\n      parts = baseAddress.split('/');\n      parts.splice(0, 3);\n      altBaseAddress = parts.join('/');\n      if ((address.startsWith(baseAddress) || address.startsWith(altBaseAddress)) &&\n          !address.endsWith('/logoff')) {\n        newAddress = address;\n      }\n      else {\n        newAddress = baseAddress;\n      }\n\n      return newAddress;\n    }\n\n    this.$get = getService;\n\n    /**\n     * @ngInject\n     */\n    getService.$inject = ['$q', '$http', 'passwordPolicyConfig'];\n    function getService($q, $http, passwordPolicyConfig) {\n      var _this = this, service;\n\n      service = {\n        login: function(data) {\n          var d = $q.defer(),\n              username = data.username,\n              password = data.password,\n              domain = data.domain,\n              language,\n              rememberLogin = data.rememberLogin ? 1 : 0;\n\n          if (data.loginSuffix && !username.endsWith(data.loginSuffix)) {\n            username += loginSuffix;\n            domain = false;\n          }\n          if (data.language && data.language != 'WONoSelectionString') {\n            language = data.language;\n          }\n\n          $http({\n            method: 'POST',\n            url: '/SOGo/connect',\n            data: {\n              userName: username,\n              password: password,\n              domain: domain,\n              language: language,\n              rememberLogin: rememberLogin\n            }\n          }).success(function(data, status) {\n            // Make sure browser's cookies are enabled\n            var loginCookie = readLoginCookie();\n            if (!loginCookie) {\n              d.reject(l('cookiesNotEnabled'));\n            }\n            else {\n              // Check password policy\n              if (typeof data.expire != 'undefined' && typeof data.grace != 'undefined') {\n                if (data.expire < 0 && data.grace > 0) {\n                  d.reject({grace: data.grace});\n                  //showPasswordDialog('grace', createPasswordGraceDialog, data['grace']);\n                } else if (data.expire > 0 && data.grace == -1) {\n                  d.reject({expire: data.expire});\n                  //showPasswordDialog('expiration', createPasswordExpirationDialog, data['expire']);\n                }\n                else {\n                  d.resolve(redirectUrl(username, domain));\n                }\n              }\n              else {\n                d.resolve(redirectUrl(username, domain));\n              }\n            }\n          }).error(function(data, status) {\n            var msg, perr;\n            if (data && data.LDAPPasswordPolicyError) {\n              perr = data.LDAPPasswordPolicyError;\n              if (perr == passwordPolicyConfig.PolicyNoError) {\n                msg = l('Wrong username or password.');\n              }\n              else if (perr == passwordPolicyConfig.PolicyAccountLocked) {\n                msg = l('Your account was locked due to too many failed attempts.');\n              }\n              else {\n                msg = l('Login failed due to unhandled error case: ') + perr;\n              }\n            }\n            else {\n              msg = l('Unhandled error response');\n            }\n            d.reject({error: msg});\n          });\n          return d.promise;\n        }, // login: function(data) { ...\n\n        changePassword: function(newPassword) {\n          var d = $q.defer(),\n              loginCookie = _this.readLoginCookie();\n\n          $http({\n            method: 'POST',\n            url: '/SOGo/so/changePassword',\n            data: {\n              userName: loginCookie[0],\n              password: loginCookie[1],\n              newPassword: newPassword }\n          }).success(function(data, status) {\n            d.resolve();\n          }).error(function(data, status) {\n            var error,\n                perr = data.LDAPPasswordPolicyError;\n\n            if (!perr) {\n              perr = passwordPolicyConfig.PolicyPasswordSystemUnknown;\n              error = _(\"Unhandled error response\");\n            }\n            else if (perr == passwordPolicyConfig.PolicyNoError) {\n              error = l(\"Password change failed\");\n            } else if (perr == passwordPolicyConfig.PolicyPasswordModNotAllowed) {\n              error = l(\"Password change failed - Permission denied\");\n            } else if (perr == passwordPolicyConfig.PolicyInsufficientPasswordQuality) {\n              error = l(\"Password change failed - Insufficient password quality\");\n            } else if (perr == passwordPolicyConfig.PolicyPasswordTooShort) {\n              error = l(\"Password change failed - Password is too short\");\n            } else if (perr == passwordPolicyConfig.PolicyPasswordTooYoung) {\n              error = l(\"Password change failed - Password is too young\");\n            } else if (perr == passwordPolicyConfig.PolicyPasswordInHistory) {\n              error = l(\"Password change failed - Password is in history\");\n            } else {\n              error = l(\"Unhandled policy error: %{0}\").formatted(perr);\n              perr = passwordPolicyConfig.PolicyPasswordUnknown;\n            }\n\n            d.reject(error);\n          });\n          return d.promise;\n        }\n      };\n      return service;\n    }\n  }\n\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * @name Dialog\n   * @constructor\n   */\n  function Dialog() {\n  }\n\n  /**\n   * @name alert\n   * @desc Show an alert dialog box with a single \"OK\" button\n   * @param {string} title\n   * @param {string} content\n   */\n  Dialog.alert = function(title, content) {\n    var alert = this.$modal.alert()\n        .title(title)\n        .content(content)\n        .ok(l('OK'));\n    this.$modal.show(alert);\n  };\n\n  /**\n   * @name confirm\n   * @desc Show a confirmation dialog box with buttons 'Cancel' and 'OK'\n   * @param {string} title\n   * @param {string} content\n   * @returns a promise that resolves if the user has clicked on the 'OK' button\n   */\n  Dialog.confirm = function(title, content, options) {\n    var confirm = this.$modal.confirm()\n        .title(title)\n        .content(content)\n        .ok((options && options.ok)? options.ok : l('OK'))\n        .cancel((options && options.cancel)? options.cancel : l('Cancel'));\n    return this.$modal.show(confirm);\n  };\n\n  /**\n   * @name prompt\n   * @desc Show a primpt dialog box with a input text field and the 'Cancel' and 'OK' buttons\n   * @param {string} title\n   * @param {string} label\n   * @param {object} [options] - use a different input type by setting 'inputType'\n   * @returns a promise that resolves with the input field value\n   */\n  Dialog.prompt = function(title, label, options) {\n    var o = options || {},\n        d = this.$q.defer();\n\n    this.$modal.show({\n      parent: angular.element(document.body),\n      clickOutsideToClose: true,\n      escapeToClose: true,\n      template: [\n        '<md-dialog flex=\"50\" flex-sm=\"100\">',\n        '  <md-dialog-content layout=\"column\">',\n        '    <h2 class=\"md-title\" ng-bind=\"title\"></h2>',\n        '    <md-input-container>',\n        '      <label>' + label + '</label>',\n        '      <input type=\"' + (o.inputType || 'text') + '\"',\n        '             aria-label=\"' + title + '\"',\n        '             ng-model=\"name\" required=\"required\"/>',\n        '    </md-input-container>',\n        '  </md-dialog-content>',\n        '    <div class=\"md-actions\">',\n        '      <md-button ng-click=\"cancel()\">',\n        '        ' + l('Cancel'),\n        '      </md-button>',\n        '      <md-button class=\"md-primary\" ng-click=\"ok()\" ng-disabled=\"!name.length\">',\n        '        ' + l('OK'),\n        '      </md-button>',\n        '    </div>',\n        '</md-dialog>'\n      ].join(''),\n      controller: PromptDialogController\n    });\n\n    /**\n     * @ngInject\n     */\n    PromptDialogController.$inject = ['scope', '$mdDialog'];\n    function PromptDialogController(scope, $mdDialog) {\n      scope.title = title;\n      scope.name = \"\";\n      scope.cancel = function() {\n        d.reject();\n        $mdDialog.hide();\n      };\n      scope.ok = function() {\n        d.resolve(scope.name);\n        $mdDialog.hide();\n      };\n    }\n\n    return d.promise;\n  };\n\n  /**\n   * @memberof Dialog\n   * @desc The factory we'll register as Dialog in the Angular module SOGo.Common\n   * @ngInject\n   */\n  DialogService.$inject = ['$q', '$mdDialog'];\n  function DialogService($q, $mdDialog) {\n    angular.extend(Dialog, { $q: $q , $modal: $mdDialog });\n\n    return Dialog; // return constructor\n  }\n\n  /* Factory registration in Angular module */\n  angular\n    .module('SOGo.Common')\n    .factory('Dialog', DialogService);\n\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * Gravatar - A service to build the Gravatar URL for an email address\n   * @memberof SOGo.Common\n   * @param {string} email\n   * @param {number} [size] - the size of the image\n   * @ngInject\n   */\n  function Gravatar() {\n    return function(email, size) {\n      var x, y, hash, s = size;\n      if (!email) {\n        return '';\n      }\n      x = email.indexOf('<');\n      if (x >= 0) {\n        y = email.indexOf('>', x);\n        if (y > x)\n          email = email.substring(x+1,y);\n      }\n      if (!size) {\n        s = 48; // default to 48 pixels\n      }\n      hash = email.md5();\n\n      // return 'https://www.gravatar.com/avatar/' + hash + '?s=' + s + '&d=identicon';\n      return 'https://www.gravatar.com/avatar/' + hash + '?s=' + s + '&d=wavatar';\n    };\n  }\n\n  angular\n    .module('SOGo.Common')\n    .factory('Gravatar', Gravatar);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * @name Resource\n   * @constructor\n   * @param {Object} $http - the Angular HTTP service\n   * @param {Object} $q - the Angular promise/deferred service\n   * @param {String} path - the base path of the external resource\n   * @param {Object} options - extra attributes to be associated to the object\n   */\n  function Resource($http, $q, path, activeUser, options) {\n    angular.extend(this, {\n      _http: $http,\n      _q: $q,\n      _path: path,\n      _activeUser: activeUser\n    });\n    angular.extend(this, options);\n    // Trim trailing slash\n    this._path = this._path.replace(/\\/$/, '');\n  }\n\n  /**\n   * @memberof Resource\n   * @desc The factory we'll use to register with Angular.\n   * @return a new Resource object\n   */\n  Resource.$factory =  ['$http', '$q', function($http, $q) {\n    return function(path, activeUser, options) {\n      return new Resource($http, $q, path, activeUser, options);\n    };\n  }];\n\n  /**\n   * @module SOGo.Common\n   * @desc Factory registration of Resource in Angular module.\n   */\n  angular.module('SOGo.Common').factory('Resource', Resource.$factory);\n\n  /**\n   * @function userResource\n   * @memberof Resource.prototype\n   * @desc Create a new Resource object associated to a username different than the active user.\n   * @param {String} uid - the user UID\n   * @return a new Resource object\n   */\n  Resource.prototype.userResource = function(uid) {\n    var path = _.compact(this._activeUser.folderURL.split('/'));\n    path.splice(path.length - 1, 1, escape(uid));\n\n    return new Resource(this._http, this._q, '/' + path.join('/'), this._activeUser);\n  };\n\n  /**\n   * @function fetch\n   * @memberof Resource.prototype\n   * @desc Fetch resource using a specific folder, action and/or parameters.\n   * @param {string} folderId - the folder on which the action will be applied (ex: addressbook, calendar)\n   * @param {string} action - the action to be used in the URL\n   * @param {Object} params - Object parameters injected through the $http service\n   * @return a promise\n   */\n  Resource.prototype.fetch = function(folderId, action, params) {\n    var deferred = this._q.defer(),\n        path = [this._path];\n    if (folderId) path.push(folderId.split('/'));\n    if (action)   path.push(action);\n    path = _.compact(_.flatten(path)).join('/');\n\n    this._http({\n      method: 'GET',\n      url: path,\n      params: params\n    })\n      .success(deferred.resolve)\n      .error(function(data, status) {\n        if (status == 404)\n          return deferred.reject();\n      });\n\n    return deferred.promise;\n  };\n\n  /**\n   * @function newguid\n   * @memberof Resource.prototype\n   * @desc Fetch a new GUID on the specified folder ID.\n   * @return a promise of the new data structure\n   */\n  Resource.prototype.newguid = function(folderId) {\n    var deferred = this._q.defer(),\n        path = this._path + '/' + folderId + '/newguid';\n\n    this._http\n      .get(path)\n      .success(deferred.resolve)\n      .error(deferred.reject);\n\n    return deferred.promise;\n  };\n\n  /**\n   * @function create\n   * @memberof Resource.prototype\n   * @desc Create a new resource using a specific action (post).\n   * @param {string} action - the action to be used in the URL\n   * @param {string} name - the new resource's name\n   * @return a promise\n   */\n  Resource.prototype.create = function(action, name) {\n    var deferred = this._q.defer(),\n        path = this._path + '/' + action;\n\n    this._http\n      .post(path, { name: name })\n      .success(deferred.resolve)\n      .error(deferred.reject);\n\n    return deferred.promise;\n  };\n\n  /**\n   * @function post\n   * @memberof Resource.prototype\n   * @desc Post a resource attributes on the server.\n   * @return a promise\n   */\n  Resource.prototype.post = function(id, action, data) {\n    var deferred = this._q.defer(),\n        path = [this._path];\n    if (id) path.push(id);\n    if (action) path.push(action);\n    path = _.compact(_.flatten(path)).join('/');\n\n    this._http\n      .post(path, data)\n      .success(deferred.resolve)\n      .error(deferred.reject);\n\n    return deferred.promise;\n  };\n\n  /**\n   * @function save\n   * @memberof Resource.prototype\n   * @desc Save a resource attributes on the server (post /save).\n   * @return a promise\n   */\n  Resource.prototype.save = function(id, newValue, options) {\n    var deferred = this._q.defer(),\n        action = (options && options.action)? options.action : 'save';\n\n    return this.post(id, action, newValue);\n  };\n\n  /**\n   * @function remove\n   * @memberof Resource.prototype\n   * @desc Delete a resource (get /delete).\n   * @return a promise\n   */\n  Resource.prototype.remove = function(uid) {\n    var deferred = this._q.defer(),\n        path = this._path + '/' + uid + '/delete';\n\n    this._http\n      .get(path)\n      .success(deferred.resolve)\n      .error(deferred.reject);\n\n    return deferred.promise;\n  };\n\n})();\n","(function() {\n  'use strict';\n\n  /**\n   * @name User\n   * @constructor\n   * @param {object} [userData] - some default values for the user\n   */\n  function User(userData) {\n    if (userData) {\n      this.init(userData);\n    }\n  }\n\n  /**\n   * @memberof User\n   * @desc The factory we'll use to register with Angular.\n   * @return the User constructor\n   */\n  User.factory = ['$q', '$log', 'sgSettings', 'Resource', 'Gravatar', function($q, $log, Settings, Resource, Gravatar) {\n    angular.extend(User, {\n      $q: $q,\n      $log: $log,\n      $$resource: new Resource(Settings.activeUser('folderURL'), Settings.activeUser()),\n      $gravatar: Gravatar,\n      $query: '',\n      $users: []\n    });\n\n    return User;\n  }];\n\n  /**\n   * @module SOGo.Common\n   * @desc Factory registration of User in Angular module.\n   */\n  angular.module('SOGo.Common').factory('User', User.factory);\n\n  /**\n   * @memberof User\n   * @desc Search for users that match a string.\n   * @param {string} search - a string used to performed the search\n   * @param {object[]} excludedUsers - a list of User objects that must be excluded from the results\n   * @return a promise of an array of matching User objects\n   */\n  User.$filter = function(search, excludedUsers) {\n    var param = {search: search};\n    var _this = this;\n\n    if (!search) {\n      // No query specified\n      User.$users = [];\n      return User.$q.when(User.$users);\n    }\n    if (User.$query == search) {\n      // Query hasn't changed\n      return User.$q.when(User.$users);\n    }\n    User.$query = search;\n\n    return User.$$resource.fetch(null, 'usersSearch', param).then(function(response) {\n      var results, index, user,\n          compareUids = function(data) {\n            return _this.uid == data.uid;\n          };\n      if (excludedUsers) {\n        // Remove excluded users from response\n        results = _.filter(response.users, function(data) {\n          return !_.find(excludedUsers, compareUids, user);\n        });\n      }\n      else {\n        results = response.users;\n      }\n      // Remove users that no longer match the search query\n      for (index = User.$users.length - 1; index >= 0; index--) {\n        user = User.$users[index];\n        if (!_.find(results, compareUids, user)) {\n          User.$users.splice(index, 1);\n        }\n      }\n      // Add new users matching the search query\n      _.each(results, function(data, index) {\n        if (_.isUndefined(_.find(User.$users, compareUids, data))) {\n          var user = new User(data);\n          User.$users.splice(index, 0, user);\n        }\n      });\n      User.$log.debug(User.$users);\n      return User.$users;\n    });\n  };\n\n  /**\n   * @function init\n   * @memberof User.prototype\n   * @desc Extend instance with required attributes and new data.\n   * @param {object} data - attributes of user\n   */\n  User.prototype.init = function(data) {\n    angular.extend(this, data);\n    if (!this.$$shortFormat)\n      this.$$shortFormat = this.$shortFormat();\n    if (!this.$$image)\n      this.$$image = this.image || User.$gravatar(this.c_email);\n\n    // An empty attribute to trick md-autocomplete when adding users from the ACLs editor\n    this.empty = ' ';\n  };\n\n  /**\n   * @function $shortFormat\n   * @memberof User.prototype\n   * @return the fullname along with the email address\n   */\n  User.prototype.$shortFormat = function(options) {\n    var fullname = this.cn || this.c_email;\n    var email = this.c_email;\n    var no_email = options && options.email === false;\n    if (!no_email && email && fullname != email) {\n      fullname += ' <' + email + '>';\n    }\n    return fullname;\n  };\n\n  /**\n   * @function $acl\n   * @memberof User.prototype\n   * @desc Fetch the user rights associated to a specific folder and populate the 'rights' attribute.\n   * @param {string} the folder ID\n   * @return a promise\n   */\n  User.prototype.$acl = function(folderId) {\n    var _this = this,\n        deferred = User.$q.defer(),\n        param = {uid: this.uid};\n    if (this.$shadowRights) {\n      deferred.resolve(this.rights);\n    }\n    else {\n      User.$$resource.fetch(folderId, 'userRights', param).then(function(data) {\n        _this.rights = data;\n        // Convert numbers (0|1) to boolean values\n        //angular.forEach(_.keys(_this.rights), function(key) {\n        //  _this.rights[key] = _this.rights[key] ? true : false;\n        //});\n        // console.debug('rights ' + _this.uid + ' => ' + JSON.stringify(data, undefined, 2));\n        // Keep a copy of the server's version\n        _this.$shadowRights = angular.copy(data);\n        deferred.resolve(data);\n        return data;\n      });\n    }\n    return deferred.promise;\n  };\n\n  /**\n   * @function $isAnonymous\n   * @memberof User.prototype\n   * @return true if it's the special anonymous user\n   */\n  User.prototype.$isAnonymous = function() {\n    return this.uid == 'anonymous';\n  };\n\n  /**\n   * @function $isSpecial\n   * @memberof User.prototype\n   * @desc Only accurate from the ACL editor.\n   * @return true if the user is not a regular system user\n   */\n  User.prototype.$isSpecial = function() {\n    return this.userClass && this.userClass == 'public-user';\n  };\n\n  /**\n   * @function $confirmRights\n   * @memberof User.prototype\n   * @desc Check if a confirmation is required before giving some rights.\n   * @return the confirmation message or false if no confirmation is required\n   */\n  User.prototype.$confirmRights = function() {\n    var confirmation = false;\n\n    if (this.$confirmation) {\n      // Don't bother the user more than once\n      return false;\n    }\n\n    if (_.some(_.values(this.rights))) {\n      if (this.uid == 'anonymous') {\n        confirmation = l('Potentially anyone on the Internet will be able to access your folder, even if they do not have an account on this system. Is this information suitable for the public Internet?');\n      }\n      else if (this.uid == '<default>') {\n        confirmation = l('Any user with an account on this system will be able to access your folder. Are you certain you trust them all?');\n      }\n    }\n\n    this.$confirmation = confirmation;\n\n    return confirmation;\n  };\n\n  /**\n   * @function $rightsAreDirty\n   * @memberof User.prototype\n   * @return whether or not the rights have changed from their initial values\n   */\n  User.prototype.$rightsAreDirty = function() {\n    return this.rights && !_.isEqual(this.rights, this.$shadowRights);\n  };\n\n  /**\n   * @function $resetRights\n   * @memberof User.prototype\n   * @desc Restore initial rights or disable all rights\n   * @param {boolean} [zero] - reset all rights to zero when true\n   */\n  User.prototype.$resetRights = function(zero) {\n    var _this = this;\n    if (zero) {\n      // Disable all rights\n      _.map(_.keys(this.rights), function(key) {\n        if (angular.isString(_this.rights[key]))\n          _this.rights[key] = 'None';\n        else\n          _this.rights[key] = 0;\n      });\n    }\n    else {\n      // Restore initial rights\n      this.rights = angular.copy(this.$shadowRights);\n    }\n  };\n\n  /**\n   * @function $folders\n   * @memberof User.prototype\n   * @desc Retrieve the list of folders of a specific type\n   * @param {string} type - either 'contact' or 'calendar'\n   * @return a promise of the HTTP query result or the cached result\n   */\n  User.prototype.$folders = function(type) {\n    var _this = this,\n        deferred = User.$q.defer(),\n        param = {type: type};\n    if (this.$$folders) {\n      deferred.resolve(this.$$folders);\n    }\n    else {\n      User.$$resource.userResource(this.uid).fetch(null, 'foldersSearch', param).then(function(response) {\n        _this.$$folders = response.folders;\n        deferred.resolve(response.folders);\n      });\n    }\n    return deferred.promise;\n  };\n\n  /**\n   * @function $omit\n   * @memberof User.prototype\n   * @desc Return a sanitized object used to send to the server.\n   * @return an object literal copy of the User instance\n   */\n  User.prototype.$omit = function() {\n    var user = {};\n    angular.forEach(this, function(value, key) {\n      if (key != 'constructor' && key[0] != '$') {\n        user[key] = value;\n      }\n    });\n    return user;\n  };\n\n  User.prototype.toString = function() {\n    return '[User ' + this.c_email + ']';\n  };\n\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n  \n  /**\n   * sgFocus - A service to set the focus on the element associated to a specific string\n   * @memberof SOGo.Common\n   * @param {string} name - the string identifier of the element\n   * @see {@link SOGo.Common.sgFocusOn}\n   * @ngInject\n  */\n  sgFocus.$inject = ['$rootScope', '$timeout'];\n  function sgFocus($rootScope, $timeout) {\n    return function(name) {\n      $timeout(function() {\n        $rootScope.$broadcast('sgFocusOn', name);\n      });\n    };\n  }\n\n  angular\n    .module('SOGo.Common')\n    .factory('sgFocus', sgFocus);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  /* jshint validthis: true, newcap: false */\n  'use strict';\n\n  /**\n   * sgAvatarImage - An avatar directive that returns un img element with either a local URL (if sg-src is specified)\n   * or a Gravatar URL built from the Gravatar factory.\n   * Based on http://blog.lingohub.com/2014/08/better-ux-with-angularjs-directives/.\n   * @memberof SOGo.Common\n   * @example:\n     <sg-avatar-image sg-email=\"test@email.com\" size=\"50\"></sg-avatar-image>\n  */\n  function sgAvatarImage() {\n    return {\n      restrict: 'AE',\n      replace: true,\n      scope: {\n        size: '@',\n        email: '=sgEmail',\n        src: '=sgSrc'\n      },\n      template: '<img ng-src=\"{{vm.url}}\"/>',\n      bindToController: true,\n      controller: 'sgAvatarImageController',\n      controllerAs: 'vm'\n    };\n  }\n\n  /**\n   * @ngInject\n   */\n  sgAvatarImageController.$inject = ['$scope', '$element', 'Gravatar'];\n  function sgAvatarImageController($scope, $element, Gravatar) {\n    var vm = this;\n\n    $scope.$watch('vm.email', function(email) {\n      if (email && !vm.url) {\n        vm.url = Gravatar(email, vm.size);\n      }\n    });\n\n    // If sg-src is defined, watch the expression for the URL of a local image\n    if ('sg-src' in $element[0].attributes) {\n      $scope.$watch('vm.src', function(src) {\n        if (src) {\n          vm.url = src;\n        }\n      });\n    }\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgAvatarImage', sgAvatarImage)\n    .controller('sgAvatarImageController', sgAvatarImageController);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  /* jshint validthis: true */\n  'use strict';\n\n  /*\n   * sgColorPicker - Color picker widget\n   * @restrict element\n   * @param {function} sgOnSelect - the function to call when clicking on a color.\n   *        One variable is available: color.\n   * @ngInject\n   * @example:\n\n     <sg-color-picker sg-on-select=\"properties.calendar.color = color\"></sg-color-picker>\n  */\n  sgColorPicker.$inject = ['$parse'];\n  function sgColorPicker($parse) {\n    return {\n      restrict: 'E',\n      template: [\n        '<md-menu>',\n        '  <md-button class=\"sg-icon-button\"',\n        '             label:aria-label=\"Options\"',\n        '             ng-click=\"$mdOpenMenu()\"',\n        '             md-menu-origin=\"md-menu-origin\">',\n        '    <md-icon>color_lens</md-icon>',\n        '  </md-button>',\n        '  <md-menu-content class=\"md-padding\" width=\"3\">',\n        '    <md-grid-list class=\"sg-color-picker\" md-cols=\"7\" md-row-height=\"1:1\" md-gutter=\"0.5em\">',\n        '      <md-grid-tile ng-repeat=\"color in $sgColorPickerController.colors\"',\n        '                    ng-style=\"{ \\'background-color\\': color }\"',\n        '                    ng-click=\"$sgColorPickerController.select(color)\"></md-grid-tile>',\n        '    </md-grid-list>',\n        '  </md-menu-content>',\n        '</md-menu>'\n      ].join(''),\n      replace: true,\n      bindToController: true,\n      controller: sgColorPickerController,\n      controllerAs: '$sgColorPickerController',\n      link: link\n    };\n\n    function link(scope, iElement, iAttr, controller) {\n      // Associate callback to controller\n      controller.doSelect = $parse(iElement.attr('sg-on-select'));\n    }\n  }\n  \n  /**\n   * @ngInject\n   */\n  sgColorPickerController.$inject = ['$scope', 'sgColors'];\n  function sgColorPickerController($scope, sgColors) {\n    var vm = this;\n\n    vm.colors = sgColors.selection;\n    vm.select = function(color) {\n      vm.doSelect($scope, { color: color });\n    };\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgColorPicker', sgColorPicker);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /*\n   * sgCompile - Assign an expression to a DOM element and compile it.\n   * @memberof SOGo.Common\n   * @restrict attribute\n   * @param {object} sgCompile - the expression to compile\n   * @ngInject\n   * @example:\n\n   <div sg-compile=\"part.content\"><!-- msg --></div>\n  */\n  sgCompile.$inject = ['$compile'];\n  function sgCompile($compile) {\n    return {\n      restrict: 'A',\n      link: sgCompileLink\n    };\n\n    function sgCompileLink(scope, element, attrs) {\n      var ensureCompileRunsOnce = scope.$watch(\n        function(scope) {\n          // Watch the sg-compile expression for changes\n          return scope.$eval(attrs.sgCompile);\n        },\n        function(value) {\n          // When the sg-compile expression changes, assign it into the current DOM\n          element.html(value);\n          \n          // Compile the new DOM and link it to the current scope.\n          // NOTE: we only compile .childNodes so that we don't get into infinite loop compiling ourselves\n          $compile(element.contents())(scope);\n          \n          // Use un-watch feature to ensure compilation happens only once.\n          ensureCompileRunsOnce();\n        }\n      );\n    }\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgCompile', sgCompile);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * sgEnter - A directive evaluated when the enter key is pressed\n   * @memberof SOGo.Common\n   * @ngInject\n   * @example:\n\n     <input type=\"text\"\n            sg-enter=\"save($index)\" />\n  */\n  function sgEnter() {\n    var ENTER_KEY = 13;\n    return function(scope, element, attrs) {\n      element.bind(\"keydown keypress\", function(event) {\n        if (event.which === ENTER_KEY) {\n          scope.$apply(function() {\n            scope.$eval(attrs.sgEnter);\n          });\n          event.preventDefault();\n        }\n      });\n    };\n  }\n  \n  angular\n    .module('SOGo.Common')\n    .directive('sgEnter', sgEnter);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * sgEscape - A directive evaluated when the escape key is pressed\n   * @memberof SOGo.Common\n   * @ngInject\n   * @example:\n\n     <input type=\"text\"\n            sg-escape=\"revertEditing($index)\" />\n   */\n  function sgEscape() {\n    var ESCAPE_KEY = 27;\n    return function(scope, elem, attrs) {\n      elem.bind('keydown', function(event) {\n        if (event.keyCode === ESCAPE_KEY) {\n          scope.$apply(attrs.sgEscape);\n        }\n      });\n    };\n  }\n    \n  angular\n    .module('SOGo.Common')\n    .directive('sgEscape', sgEscape);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /**\n   * sgFocusOn - A directive that sets the focus on its element when the specified string is broadcasted\n   * @memberof SOGo.Common\n   * @see {@link SOGo.Common.sgFocus}\n   * @ngInject\n   * @example:\n\n     <input type=\"text\"\n            sg-focus-on=\"username\" />\n   */\n  function sgFocusOn() {\n    return function(scope, elem, attr) {\n      scope.$on('sgFocusOn', function(e, name) {\n        if (name === attr.sgFocusOn) {\n          elem[0].focus();\n          elem[0].select();\n        }\n      });\n    };\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgFocusOn', sgFocusOn);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /*\n   * sgFolderStylesheet - Add CSS stylesheet for folder (addressbook or calendar)\n   * @memberof SOGo.Common\n   * @restrict attribute\n   * @param {object} ngModel - the object literal describing the folder (an Addressbook or Calendar instance)\n   * @example:\n\n    <div sg-folder-stylesheet=\"true\"\n         ng-repeat=\"calendar in calendars.list\"\n         ng-model=\"calendar\" />\n   </div>\n  */\n  function sgFolderStylesheet() {\n    return {\n      restrict: 'A',\n      require: 'ngModel',\n      scope: {\n        ngModel: '='\n      },\n      template: [\n        '<style type=\"text/css\">',\n        '  .bg-folder{{ ngModel.id }} {',\n        '    background-color: {{ ngModel.color }} !important;',\n        '  }',\n        '  .fg-folder{{ ngModel.id }} {',\n        '    color: {{ ngModel.color }} !important;',\n        '  }',\n        '  .checkbox-folder{{ ngModel.id }} .md-icon {',\n        '    background-color: {{ ngModel.color }} !important;',\n        '  }',\n        '</style>'\n      ].join('')\n    };\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgFolderStylesheet', sgFolderStylesheet);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  /* jshint validthis: true */\n  'use strict';\n\n  /*\n   * sgSearch - Search within a list of items\n   * @memberof SOGo.Common\n   * @restrict attribute\n   * @param {function} sgSearch - the function to call when performing a search.\n   *        Two variables are available: searchField and searchText.\n   * @example:\n\n   <div sg-search=\"mailbox.$filter({ sort: 'date', asc: false }, [{ searchBy: searchField, searchInput: searchText }])\">\n     <md-button class=\"sg-icon-button\"\n                sg-search-cancel=\"ctrl.cancelSearch()\">\n       <md-icon>arrow_back</md-icon>\n     </md-button>\n     <md-input-container>\n       <input name=\"search\" type=\"search\"/>\n     </md-input-container>\n     <md-select class=\"sg-toolbar-sort md-contrast-light\">\n       <md-option value=\"subject\">Subject</md-option>\n       <md-option value=\"sender\">sender</md-option>\n     </md-select>\n   </div>\n  */\n  sgSearchPreTransclude.$inject = ['$parse'];\n  function sgSearchPreTransclude($parse) {\n    return {\n      restrict: 'A',\n      controller: 'sgSearchController',\n      controllerAs: '$sgSearchController',\n      priority: 1001,\n      compile: compile\n    };\n\n    function compile(tElement, tAttr) {\n      var mdInputEl = tElement.find('md-input-container'),\n          inputEl = tElement.find('input'),\n          selectEl = tElement.find('md-select'),\n          buttonEl = tElement.find('md-button');\n\n      inputEl.attr('ng-model', '$sgSearchController.searchText');\n      inputEl.attr('ng-model-options', '$sgSearchController.searchTextOptions');\n      inputEl.attr('ng-change', '$sgSearchController.onChange()');\n      if (selectEl) {\n        selectEl.attr('ng-model', '$sgSearchController.searchField');\n        selectEl.attr('ng-change', '$sgSearchController.onChange()');\n      }\n      if (buttonEl && buttonEl.attr('sg-search-cancel')) {\n        buttonEl.attr('ng-click', buttonEl.attr('sg-search-cancel'));\n        buttonEl.removeAttr('sg-search-cancel');\n      }\n      else {\n        buttonEl = null;\n      }\n\n      return function postLink(scope, iElement, iAttr, controller) {\n        var compiledButtonEl = iElement.find('button');\n\n        // Associate callback to controller\n        controller.doSearch = $parse(iElement.attr('sg-search'));\n\n        // Reset the input field when cancelling the search\n        if (buttonEl && compiledButtonEl) {\n          compiledButtonEl.on('click', controller.cancelSearch);\n        }\n      };\n    }\n  }\n\n  function sgSearch() {\n    return {\n      restrict: 'A',\n      priority: 1000,\n      transclude: true,\n      compile: compile\n    };\n\n    function compile(tElement, tAttr) {\n      return function postLink(scope, iElement, iAttr, controller, transclude) {\n        transclude(function(clone) {\n          iElement.append(clone);\n        });\n      };\n    }\n  }\n\n  /**\n   * @ngInject\n   */\n  sgSearchController.$inject = ['$scope', '$element'];\n  function sgSearchController($scope, $element) {\n    var vm = this;\n\n    // Controller variables\n    vm.previous = { searchText: '', searchField: '' };\n    vm.searchText = null;\n\n    // Model options\n    vm.searchTextOptions = {\n      updateOn: 'default blur',\n      debounce: {\n        default: 300,\n        blur: 0\n      }\n    };\n\n    // Method to call on data changes\n    vm.onChange = function() {\n      if (vm.searchText !== null) {\n        if (vm.searchText != vm.previous.searchText || vm.searchField != vm.previous.searchField) {\n          if (vm.searchText.length > 2 || vm.searchText.length === 0) {\n            // doSearch is the compiled expression of the sg-search attribute\n            vm.doSearch($scope, { searchText: vm.searchText, searchField: vm.searchField });\n          }\n          vm.previous = { searchText: vm.searchText, searchField: vm.searchField };\n        }\n      }\n    };\n\n    // Reset input field when cancelling the search\n    vm.cancelSearch = function() {\n      vm.searchText = \"\";\n    };\n  }\n\n  angular\n    .module('SOGo.Common')\n    .controller('sgSearchController', sgSearchController)\n    .directive('sgSearch', sgSearchPreTransclude)\n    .directive('sgSearch', sgSearch);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  /* jshint validthis: true */\n  'use strict';\n\n  /*\n   * sgSubscribe - Common subscription widget\n   * @restrict attribute\n   * @param {string} sgSubscribe - the folder type\n   * @param {function} sgSubscribeOnSelect - the function to call when subscribing to a folder.\n   *        One variable is available: folderData.\n   * @ngInject\n   * @example:\n\n     <md-button sg-subscribe=\"contact\" sg-subscribe-on-select=\"subscribeToFolder\">Subscribe ..</md-button>\n  */\n  sgSubscribe.$inject = ['User'];\n  function sgSubscribe(User) {\n    return {\n      restrict: 'A',\n      scope: {\n        folderType: '@sgSubscribe',\n        onFolderSelect: '&sgSubscribeOnSelect'\n      },\n      replace: false,\n      bindToController: true,\n      controller: sgSubscribeDialogController,\n      controllerAs: '$sgSubscribeDialogController',\n      link: link\n    };\n  }\n\n  function link(scope, element, attrs, controller) {\n    var inputEl = element.find('input');\n    element.on('click', controller.showDialog);\n  }\n\n  /**\n   * @ngInject\n   */\n  sgSubscribeDialogController.$inject = ['$mdDialog'];\n  function sgSubscribeDialogController($mdDialog) {\n    var vm = this;\n    vm.showDialog = function() {\n      $mdDialog.show({\n        templateUrl: '../Contacts/UIxContactsUserFolders',\n        clickOutsideToClose: true,\n        locals: {\n          folderType: vm.folderType,\n          onFolderSelect: vm.onFolderSelect\n        },\n        controller: sgSubscribeController,\n        controllerAs: 'subscribe'\n      });\n    };\n  }\n\n  /**\n   * @ngInject\n   */\n  sgSubscribeController.$inject = ['folderType', 'onFolderSelect', 'User'];\n  function sgSubscribeController(folderType, onFolderSelect, User) {\n    var vm = this;\n\n    vm.selectedUser = null;\n    vm.users = User.$users;\n\n    vm.searchTextOptions = {\n      updateOn: 'default blur',\n      debounce: {\n        default: 300,\n        blur: 0\n      }\n    };\n\n    vm.onChange = function() {\n      User.$filter(vm.searchText).then(function() {\n        if (vm.selectedUser) {\n          // If selected user is no longer part of the matching users, unselect it\n          if (_.isUndefined(_.find(User.$users, function(user) {\n            return user.uid == vm.selectedUser.uid;\n          }))) {\n            vm.selectedUser = null;\n          }\n        }\n      });\n    };\n\n    vm.selectUser = function(i) {\n      if (vm.selectedUser == vm.users[i]) {\n        vm.selectedUser = null;\n      }\n      else {\n        // Fetch folders of specific type for selected user\n        vm.users[i].$folders(folderType).then(function() {\n          vm.selectedUser = vm.users[i];\n        });\n      }\n    };\n\n    // Callback upon subscription to a folder\n    vm.selectFolder = function(folder) {\n      onFolderSelect({folderData: folder});\n    };\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgSubscribe', sgSubscribe);\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /*\n   * sgTarget - Replace target for <a href> in DOM.\n   * @memberof SOGo.Common\n   * @restrict attribute\n   * @param {object} sgTarget - the expression to process\n   * @ngInject\n   * @example:\n\n   <div sg-target=\"part.content\"><!-- msg --></div>\n  */\n  function sgTarget() {\n    return {\n      priority: 1,\n      restrict: 'A',\n      link: sgTargetLink\n    };\n\n    function sgTargetLink(scope, element, attrs) {\n      console.log(\"sgTargetLink...\");\n\n      var ensureTargetRunsOnce = scope.$watch(\n        function(scope) {\n          // Watch the sg-target expression for changes\n          return scope.$eval(attrs.sgTarget);\n        },\n        function(value) {\n          \n          var onAnchorClick = function (event) {\n            if (this.href)\n              window.open(this.href);\n            if (event) {\n              if (event.preventDefault)\n                event.preventDefault(); // W3C DOM\n              else\n                event.returnValue = false; // IE\n            }\n          };\n          //var anchors = angular.element(value)[0].getElementsByTagName('a');\n          //for (var i = 0; i < anchors.length; i++) {\n            //var anchor = angular.element(anchors[i]);\n            // if (!anchor.href && anchor.readAttribute(\"moz-do-not-send\")) {\n            //   anchor.writeAttribute(\"moz-do-not-send\", false);\n            //   anchor.removeClassName(\"moz-txt-link-abbreviated\");\n            //   anchor.href = \"mailto:\" + anchors[i].innerHTML;\n            // }\n            // if (anchor.href.substring(0,7) == \"mailto:\") {\n            //   anchor.observe(\"click\", onEmailTo);\n            //   if (typeof onEmailAddressClick == 'function')\n            //     anchor.observe(\"contextmenu\", onEmailAddressClick);\n            //   anchor.writeAttribute(\"moz-do-not-send\", false);\n            // }\n            // els\n            //if (!anchor.id)\n            //  anchor.observe(\"click\", onAnchorClick);\n          //}\n\n          element.html(value);\n          ensureTargetRunsOnce();\n        }\n      );\n    }\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgTarget', sgTarget);\n})();\n","(function() {\n  'use strict';\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgTimePane', timePaneDirective);\n  \n    function timePaneDirective() {\n        return {\n            template:\n            '<div class=\"sg-time-pane\">' +\n            '<div class=\"hours-pane\"><div ng-repeat=\"hoursBigLine in hours\" layout=\"row\" layout-sm=\"column\" ><div ng-repeat=\"hoursLine in hoursBigLine\" layout=\"row\" class=\"hours\" >' +\n            '<div flex layout=\"row\" layout-align=\"center center\" ng-repeat=\"hour in hoursLine\">' +\n            '<md-button class=\"hourBtn md-fab md-mini\" id=\"{{hour.id}}\" ng-click=\"hourClickHandler(hour.displayName)\">{{hour.displayName}}</md-button>'+\n            '</div></div></div></div>' +\n            '<div ng-repeat=\"minutesLine in min5\" layout=\"row\" class=\"min5\" ng-show=\"is5min()\">' +\n            '<div flex layout=\"row\" layout-align=\"center center\" ng-repeat=\"minute in minutesLine\">' +\n            '<md-button class=\"minuteBtn md-fab md-mini\" id=\"{{minute.id}}\" ng-click=\"minuteClickHandler(minute.displayName)\">{{minute.displayName}}</md-button>'+\n            '</div></div>' +\n            '<div ng-repeat=\"minutesLine in min1\" layout=\"row\" class=\"min1\" ng-hide=\"is5min()\">' +\n            '<div flex layout=\"row\" layout-align=\"center center\" ng-repeat=\"minute in minutesLine\">' +\n            '<md-button class=\"minuteBtn md-fab md-mini\" id=\"{{minute.id}}\" ng-click=\"minuteClickHandler(minute.displayName)\">{{minute.displayName}}</md-button>' +\n            '</div></div>' +\n            '<div flex layout=\"row\" layout-align=\"center center\" class=\"toggle-pane\"><md-button class=\"toggleBtn md-fab md-mini\" ng-bind=\"getToggleBtnLbl()\" ng-click=\"toggleManual5min()\"></md-button></div></div>',\n            scope: {},\n            require: ['ngModel', 'sgTimePane'],\n            controller: TimePaneCtrl,\n            controllerAs: 'ctrl',\n            bindToController: true,\n            link: function(scope, element, attrs, controllers) {\n                var ngModelCtrl = controllers[0];\n                var sgTimePaneCtrl = controllers[1];\n                console.log(element);\n                var timePaneElement = element;\n                sgTimePaneCtrl.configureNgModel(ngModelCtrl,sgTimePaneCtrl, timePaneElement);\n            }\n        };\n    }\n\n    /** Class applied to the selected hour or minute cell/. */\n    //var SELECTED_TIME_CLASS = 'md-calendar-selected-date';\n    //var SELECTED_TIME_CLASS1 = 'md-raised';\n    var SELECTED_TIME_CLASS2 = 'md-primary';\n\n    /** Class applied to the focused hour or minute cell/. */\n    var FOCUSED_TIME_CLASS = 'md-focus';\n\n    /** Next identifier for calendar instance. */\n    var nextTimePaneUniqueId = 0;\n\n    function TimePaneCtrl($element, $attrs, $scope, $animate, $q, $mdConstant,\n                          $mdTheming, $$mdDateUtil, $mdDateLocale, $mdInkRipple, $mdUtil) {\n          var m;\n          this.$scope = $scope;\n          this.$element = $element;\n          this.timePaneElement = $element[0].querySelector('.sg-time-pane');\n          this.$animate = $animate;\n          this.$q = $q;\n          this.$mdInkRipple = $mdInkRipple;\n          this.$mdUtil = $mdUtil;\n          this.keyCode = $mdConstant.KEY_CODE;\n          this.dateUtil = $$mdDateUtil;\n          this.id = nextTimePaneUniqueId++;\n          this.ngModelCtrl = null;\n          this.selectedTime = null;\n          this.displayTime = null;\n          this.isInitialized = false;\n\n        $scope.hours=[];\n        $scope.hours[0]=[];\n        $scope.hours[0][0]=[];\n        $scope.hours[0][1]=[];\n        $scope.hours[1]=[];\n        $scope.hours[1][0]=[];\n        $scope.hours[1][1]=[];\n        for(var i=0; i<6; i++){\n            $scope.hours[0][0][i] = {id:'tp-'+this.id+'-hour-'+i, displayName:i<10?\"0\"+i:\"\"+i, selected:false};\n            $scope.hours[0][1][i] = {id:'tp-'+this.id+'-hour-'+(i+6),displayName:(i+6)<10?\"0\"+(i+6):\"\"+(i+6), selected:false};\n            $scope.hours[1][0][i] = {id:'tp-'+this.id+'-hour-'+(i+12), displayName:\"\"+(i+12), selected:false};\n            $scope.hours[1][1][i] = {id:'tp-'+this.id+'-hour-'+(i+18), displayName:\"\"+(i+18), selected:false};\n        }\n\n        $scope.min5=[];\n        $scope.min5[0]=[];\n        $scope.min5[1]=[];\n        for(i=0; i<6; i++){\n            m=i*5;\n            $scope.min5[0][i] = {id:'tp-'+this.id+'-minute5-'+m, displayName:m<10?\":0\"+m:\":\"+m, selected:true};\n            $scope.min5[1][i] = {id:'tp-'+this.id+'-minute5-'+(m+30), displayName:\":\"+(m+30), selected:false};\n        }\n\n        $scope.min1=[];\n        for(i=0; i<12; i++){\n            $scope.min1[i]=[];\n            for(var ii=0; ii<5; ii++){\n                m=i*5 + ii;\n                $scope.min1[i][ii] = {id:'tp-'+this.id+'-minute-'+m, displayName:m<10?\":0\"+m:\":\"+m, selected:true};\n            }\n        }\n\n        $scope.show5min=true;\n        $scope.getToggleBtnLbl = function() {\n            return ($scope.is5min()) ? '>>' : '<<';\n        };\n        $scope.toggleManual5min = function() {\n                $scope.manual5min = !$scope.is5min();\n        };\n        $scope.is5min=function(){\n            if($scope.manual5min === true || $scope.manual5min === false) {\n                return $scope.manual5min;\n            }\n            else {\n                return $scope.show5min;\n            }\n        };\n\n        if (!$attrs.tabindex) {\n            $element.attr('tabindex', '-1');\n        }\n\n        var self = this;\n\n        this.hourClickHandler = function(displayVal) {\n            var updated = new Date(self.displayTime).setHours(Number(displayVal));\n            self.setNgModelValue(updated, 'hours');\n        };\n        $scope.hourClickHandler = this.hourClickHandler;\n\n        this.minuteClickHandler = function(displayVal) {\n            //remove leading ':'\n            var val = displayVal.substr(1);\n            var updated = new Date(self.displayTime).setMinutes(Number(val));\n            self.setNgModelValue(updated, 'minutes');\n        };\n        $scope.minuteClickHandler = this.minuteClickHandler;\n\n        this.attachTimePaneEventListeners();\n    }\n    TimePaneCtrl.$inject = [\"$element\", \"$attrs\", \"$scope\", \"$animate\", \"$q\", \"$mdConstant\", \"$mdTheming\", \"$$mdDateUtil\", \"$mdDateLocale\", \"$mdInkRipple\", \"$mdUtil\"];\n\n    TimePaneCtrl.prototype.configureNgModel = function(ngModelCtrl, sgTimePaneCtrl, timePaneElement) {\n        this.ngModelCtrl = ngModelCtrl;\n        var self = this;\n        ngModelCtrl.$render = function() {\n            self.changeSelectedTime(self.ngModelCtrl.$viewValue, sgTimePaneCtrl, timePaneElement);\n        };\n    };\n\n    /**\n     * Change the selected date in the time (ngModel value has already been changed).\n     */\n    TimePaneCtrl.prototype.changeSelectedTime = function(date, sgTimePaneCtrl, timePaneElement) {\n     var self = this;\n     var previousSelectedTime = this.selectedTime;\n     this.selectedTime = new Date(date);\n     this.changeDisplayTime(date).then(function() {\n     // Remove the selected class from the previously selected date, if any.\n     if (previousSelectedTime) {\n         var prevH = previousSelectedTime.getHours();\n         var prevHCell = document.getElementById('tp-'+sgTimePaneCtrl.id+'-hour-'+prevH);\n         if (prevHCell) {\n             prevHCell.classList.remove(SELECTED_TIME_CLASS2);\n             prevHCell.setAttribute('aria-selected', 'false');\n         }\n         var prevM = previousSelectedTime.getMinutes();\n         var prevMCell = document.getElementById('tp-'+sgTimePaneCtrl.id+'-minute-'+prevM);\n         if (prevMCell) {\n             prevMCell.classList.remove(SELECTED_TIME_CLASS2);\n             prevMCell.setAttribute('aria-selected', 'false');\n         }\n         var prevM5Cell = document.getElementById('tp-'+sgTimePaneCtrl.id+'-minute5-'+prevM);\n         if (prevM5Cell) {\n             prevM5Cell.classList.remove(SELECTED_TIME_CLASS2);\n             prevM5Cell.setAttribute('aria-selected', 'false');\n         }\n     }\n\n     // Apply the select class to the new selected date if it is set.\n     if (date) {\n         var d = new Date(date);\n         var newH = d.getHours();\n         var mCell, hCell = document.getElementById('tp-'+sgTimePaneCtrl.id+'-hour-'+newH);\n         if (hCell) {\n             hCell.classList.add(SELECTED_TIME_CLASS2);\n             hCell.setAttribute('aria-selected', 'true');\n         }\n         var newM = d.getMinutes();\n         if (newM % 5 === 0) {\n             sgTimePaneCtrl.$scope.show5min = true;\n             mCell = document.getElementById('tp-'+sgTimePaneCtrl.id+'-minute5-'+newM);\n             if (mCell) {\n                 mCell.classList.add(SELECTED_TIME_CLASS2);\n                 mCell.setAttribute('aria-selected', 'true');\n             }\n         }\n         else {\n             sgTimePaneCtrl.$scope.show5min = false;\n         }\n         mCell = document.getElementById('tp-'+sgTimePaneCtrl.id+'-minute-'+newM);\n         if (mCell) {\n             mCell.classList.add(SELECTED_TIME_CLASS2);\n             mCell.setAttribute('aria-selected', 'true');\n         }\n\n     }\n     });\n     };\n\n    TimePaneCtrl.prototype.changeDisplayTime = function(date) {\n        var d = new Date(date);\n     if (!this.isInitialized) {\n     this.buildInitialTimePaneDisplay();\n     return this.$q.when();\n     }\n     if (!this.dateUtil.isValidDate(d)) {\n     return this.$q.when();\n     }\n\n     this.displayTime = d;\n\n     return this.$q.when();\n     };\n    TimePaneCtrl.prototype.buildInitialTimePaneDisplay = function() {\n     this.displayTime = this.selectedTime || this.today;\n     this.isInitialized = true;\n     };\n\n    TimePaneCtrl.prototype.attachTimePaneEventListeners = function() {\n        // Keyboard interaction.\n        this.$element.on('keydown', angular.bind(this, this.handleKeyEvent));\n    };\n\n    /*** User input handling ***/\n\n    /**\n     * Handles a key event in the calendar with the appropriate action. The action will either\n     * be to select the focused date or to navigate to focus a new date.\n     * @param {KeyboardEvent} event\n     */\n    TimePaneCtrl.prototype.handleKeyEvent = function(event) {\n        var self = this;\n        this.$scope.$apply(function() {\n            // Capture escape and emit back up so that a wrapping component\n            // (such as a time-picker) can decide to close.\n            if (event.which == self.keyCode.ESCAPE || event.which == self.keyCode.TAB) {\n                self.$scope.$emit('md-time-pane-close');\n\n                if (event.which == self.keyCode.TAB) {\n                    event.preventDefault();\n                }\n\n                return;\n            }\n\n            // Remaining key events fall into two categories: selection and navigation.\n            // Start by checking if this is a selection event.\n            if (event.which === self.keyCode.ENTER) {\n                self.setNgModelValue(self.displayTime, 'enter');\n                event.preventDefault();\n                return;\n            }\n\n            // Selection isn't occuring, so the key event is either navigation or nothing.\n            /*var date = self.getFocusDateFromKeyEvent(event);\n            if (date) {\n                event.preventDefault();\n                event.stopPropagation();\n\n                // Since this is a keyboard interaction, actually give the newly focused date keyboard\n                // focus after the been brought into view.\n                self.changeDisplayTime(date).then(function () {\n                    self.focus(date);\n                });\n            }*/\n        });\n    };\n\n    /**\n     * Sets the ng-model value for the time pane and emits a change event.\n     * @param {Date} date\n     */\n    TimePaneCtrl.prototype.setNgModelValue = function(date, mode) {\n        this.$scope.$emit('sg-time-pane-change', {date:date, changed:mode});\n        this.ngModelCtrl.$setViewValue(date);\n        this.ngModelCtrl.$render();\n    };\n\n    /**\n     * Focus the cell corresponding to the given date.\n     * @param {Date=} opt_date\n     */\n    TimePaneCtrl.prototype.focus = function(opt_date, sgTimePaneCtrl) {\n        var date = opt_date || this.selectedTime || this.today;\n\n        var previousFocus = this.timePaneElement.querySelector('.md-focus');\n        if (previousFocus) {\n            previousFocus.classList.remove(FOCUSED_TIME_CLASS);\n        }\n\n        if (date) {\n            var newH = date.getHours();\n            var hCell = document.getElementById('tp-'+sgTimePaneCtrl.id+'-hour-'+newH);\n            if (hCell) {\n                hCell.classList.add(FOCUSED_TIME_CLASS);\n                hCell.focus();\n            }\n        }\n    };\n})();\n\n(function() {\n  'use strict';\n  \n  angular.module('SOGo.Common')\n    .directive('sgTimepicker', timePickerDirective);\n\n  /**\n   * @ngdoc directive\n   * @name mdTimepicker\n   * @module material.components.timepicker\n   *\n   * @param {Date} ng-model The component's model. Expects a JavaScript Date object.\n   * @param {expression=} ng-change Expression evaluated when the model value changes.\n   * @param {boolean=} disabled Whether the timepicker is disabled.\n   *\n   * @description\n   * `<sg-timepicker>` is a component used to select a single time.\n   * For information on how to configure internationalization for the time picker,\n   * see `$mdTimeLocaleProvider`.\n   *\n   * @usage\n   * <hljs lang=\"html\">\n   *   <sg-timepicker ng-model=\"birthday\"></sg-timepicker>\n   * </hljs>\n   *\n   */\n  function timePickerDirective() {\n    return {\n      template:\n          // Buttons are not in the tab order because users can open the hours pane via keyboard\n          // interaction on the text input, and multiple tab stops for one component (picker)\n          // may be confusing.\n      '<md-button class=\"sg-timepicker-button md-icon-button\" type=\"button\" ' +\n      'tabindex=\"-1\" aria-hidden=\"true\" ' +\n      'ng-click=\"ctrl.openTimePane($event)\">' +\n      //'<md-icon class=\"md-timepicker-calendar-icon\" md-svg-icon=\"md-calendar\"></md-icon>' +\n      '<i class=\"material-icons\">access_time</i>' +\n      '</md-button>' +\n      '<div class=\"sg-timepicker-input-container\" ' +\n      'ng-class=\"{\\'sg-timepicker-focused\\': ctrl.isFocused}\">' +\n      '<input class=\"sg-timepicker-input\" aria-haspopup=\"true\" ' +\n      'ng-focus=\"ctrl.setFocused(true)\" ng-blur=\"ctrl.setFocused(false)\">' +\n      '<md-button type=\"button\" md-no-ink ' +\n      'class=\"sg-timepicker-triangle-button md-icon-button\" ' +\n      'ng-click=\"ctrl.openTimePane($event)\" ' +\n      'aria-label=\"{{::ctrl.dateLocale.msgOpenCalendar}}\">' +\n      '<div class=\"sg-timepicker-expand-triangle\"></div>' +\n      '</md-button>' +\n      '</div>' +\n        // This pane will be detached from here and re-attached to the document body.\n        '<div class=\"sg-timepicker-time-pane md-whiteframe-z1\">' +\n            '<div class=\"sg-timepicker-input-mask\">' +\n        '<div class=\"sg-timepicker-input-mask-opaque\"></div>' +\n        '</div>' +\n        '<div class=\"sg-timepicker-time\">' +\n        '<sg-time-pane role=\"dialog\" aria-label=\"{{::ctrl.dateLocale.msgCalendar}}\" ' +\n        'ng-model=\"ctrl.time\" ng-if=\"ctrl.isTimeOpen\"></sg-time-pane>' +\n        '</div>' +\n        '</div>',\n      require: ['ngModel', 'sgTimepicker'],\n      scope: {\n        placeholder: '@mdPlaceholder'\n      },\n      controller: TimePickerCtrl,\n      controllerAs: 'ctrl',\n      bindToController: true,\n      link: function(scope, element, attr, controllers) {\n        var ngModelCtrl = controllers[0];\n        var mdTimePickerCtrl = controllers[1];\n\n        mdTimePickerCtrl.configureNgModel(ngModelCtrl);\n      }\n    };\n  }\n\n  /** Additional offset for the input's `size` attribute, which is updated based on its content. */\n  var EXTRA_INPUT_SIZE = 3;\n\n  /** Class applied to the container if the date is invalid. */\n  var INVALID_CLASS = 'sg-timepicker-invalid';\n\n  /** Default time in ms to debounce input event by. */\n  var DEFAULT_DEBOUNCE_INTERVAL = 500;\n\n  /**\n   * Controller for sg-timepicker.\n   *\n   * ngInject @constructor\n   */\n  function TimePickerCtrl($scope, $element, $attrs, $compile, $timeout, $mdConstant, $mdTheming,\n      $mdUtil, $mdDateLocale, $$mdDateUtil, $$rAF) {\n    /** @final */\n    this.$compile = $compile;\n\n    /** @final */\n    this.$timeout = $timeout;\n\n    /** @final */\n    this.dateLocale = $mdDateLocale;\n\n    /** @final */\n    this.dateUtil = $$mdDateUtil;\n\n    /** @final */\n    this.$mdConstant = $mdConstant;\n\n    /* @final */\n    this.$mdUtil = $mdUtil;\n\n    /** @final */\n    this.$$rAF = $$rAF;\n\n    /** @type {!angular.NgModelController} */\n    this.ngModelCtrl = null;\n\n    /** @type {HTMLInputElement} */\n    this.inputElement = $element[0].querySelector('input');\n\n    /** @type {HTMLElement} */\n    this.inputContainer = $element[0].querySelector('.sg-timepicker-input-container');\n\n    /** @type {HTMLElement} Floating time pane. */\n    this.timePane = $element[0].querySelector('.sg-timepicker-time-pane');\n\n    /** @type {HTMLElement} Time icon button. */\n    this.timeButton = $element[0].querySelector('.sg-timepicker-button');\n\n    /**\n     * Element covering everything but the input in the top of the floating calendar pane.\n     * @type {HTMLElement}\n     */\n    this.inputMask = $element[0].querySelector('.sg-timepicker-input-mask-opaque');\n\n    /** @final {!angular.JQLite} */\n    this.$element = $element;\n\n    /** @final {!angular.Attributes} */\n    this.$attrs = $attrs;\n\n    /** @final {!angular.Scope} */\n    this.$scope = $scope;\n\n    /** @type {Date} */\n    this.date = null;\n\n    /** @type {boolean} */\n    this.isFocused = false;\n\n    /** @type {boolean} */\n    this.isDisabled = false;\n    this.setDisabled($element[0].disabled || angular.isString($attrs.disabled));\n\n    /** @type {boolean} Whether the date-picker's calendar pane is open. */\n    this.isTimeOpen = false;\n\n    /**\n     * Element from which the calendar pane was opened. Keep track of this so that we can return\n     * focus to it when the pane is closed.\n     * @type {HTMLElement}\n     */\n    this.timePaneOpenedFrom = null;\n\n    this.timePane.id = 'sg-time-pane' + $mdUtil.nextUid();\n\n    $mdTheming($element);\n\n    /** Pre-bound click handler is saved so that the event listener can be removed. */\n    this.bodyClickHandler = angular.bind(this, this.handleBodyClick);\n\n    // Unless the user specifies so, the datepicker should not be a tab stop.\n    // This is necessary because ngAria might add a tabindex to anything with an ng-model\n    // (based on whether or not the user has turned that particular feature on/off).\n    if (!$attrs.tabindex) {\n      $element.attr('tabindex', '-1');\n    }\n\n    this.installPropertyInterceptors();\n    this.attachChangeListeners();\n    this.attachInteractionListeners();\n\n    var self = this;\n    $scope.$on('$destroy', function() {\n      self.detachTimePane();\n    });\n  }\n\n    TimePickerCtrl.$inject = [\"$scope\", \"$element\", \"$attrs\", \"$compile\", \"$timeout\", \"$mdConstant\", \"$mdTheming\",\n        \"$mdUtil\", \"$mdDateLocale\", \"$$mdDateUtil\", \"$$rAF\"];\n\n  /**\n   * Sets up the controller's reference to ngModelController.\n   * @param {!angular.NgModelController} ngModelCtrl\n   */\n  TimePickerCtrl.prototype.configureNgModel = function(ngModelCtrl) {\n    this.ngModelCtrl = ngModelCtrl;\n    var self = this;\n    ngModelCtrl.$render = function() {\n        self.time = self.ngModelCtrl.$viewValue;\n        self.inputElement.value = self.formatTime(self.time);\n      self.resizeInputElement();\n    };\n  };\n\n    TimePickerCtrl.prototype.formatTime = function(time) {\n        var t = new Date(time);\n        if(t) {\n            var h= t.getHours();\n            var m= t.getMinutes();\n            return (h<10?('0'+ h) : h) + ':' + (m<10?'0'+ m : m);\n        }\n        else return '';\n    };\n  /**\n   * Attach event listeners for both the text input and the md-time.\n   * Events are used instead of ng-model so that updates don't infinitely update the other\n   * on a change. This should also be more performant than using a $watch.\n   */\n  TimePickerCtrl.prototype.attachChangeListeners = function() {\n    var self = this;\n\n    self.$scope.$on('sg-time-pane-change', function(event, data) {\n        var time = new Date(data.date);\n        self.ngModelCtrl.$setViewValue(time);\n        self.time = time;\n        self.inputElement.value = self.formatTime(self.time);\n        if(data.changed == 'minutes') {\n            self.closeTimePane();\n        }\n        self.resizeInputElement();\n        self.inputContainer.classList.remove(INVALID_CLASS);\n    });\n\n    var ngElement = angular.element(self.inputElement);\n    ngElement.on('input', angular.bind(self, self.resizeInputElement));\n    ngElement.on('input', self.$mdUtil.debounce(self.handleInputEvent,\n        DEFAULT_DEBOUNCE_INTERVAL, self));\n  };\n\n  /** Attach event listeners for user interaction. */\n  TimePickerCtrl.prototype.attachInteractionListeners = function() {\n    var self = this;\n    var $scope = this.$scope;\n    var keyCodes = this.$mdConstant.KEY_CODE;\n\n    // Add event listener through angular so that we can triggerHandler in unit tests.\n    angular.element(self.inputElement).on('keydown', function(event) {\n      if (event.altKey && event.keyCode == keyCodes.DOWN_ARROW) {\n        self.openTimePane(event);\n        $scope.$digest();\n      }\n    });\n\n    $scope.$on('md-time-close', function() {\n      self.closeTimePane();\n    });\n  };\n\n  /**\n   * Capture properties set to the time-picker and imperitively handle internal changes.\n   * This is done to avoid setting up additional $watches.\n   */\n  TimePickerCtrl.prototype.installPropertyInterceptors = function() {\n    var self = this;\n\n    if (this.$attrs.ngDisabled) {\n      // The expression is to be evaluated against the directive element's scope and not\n      // the directive's isolate scope.\n      this.$element.scope().$watch(this.$attrs.ngDisabled, function(isDisabled) {\n        self.setDisabled(isDisabled);\n      });\n    }\n\n    Object.defineProperty(this, 'placeholder', {\n      get: function() { return self.inputElement.placeholder; },\n      set: function(value) { self.inputElement.placeholder = value || ''; }\n    });\n  };\n\n  /**\n   * Sets whether the date-picker is disabled.\n   * @param {boolean} isDisabled\n   */\n  TimePickerCtrl.prototype.setDisabled = function(isDisabled) {\n    this.isDisabled = isDisabled;\n    this.inputElement.disabled = isDisabled;\n    this.timeButton.disabled = isDisabled;\n  };\n\n  /**\n   * Resizes the input element based on the size of its content.\n   */\n  TimePickerCtrl.prototype.resizeInputElement = function() {\n    this.inputElement.size = this.inputElement.value.length + EXTRA_INPUT_SIZE;\n  };\n\n  /**\n   * Sets the model value if the user input is a valid time.\n   * Adds an invalid class to the input element if not.\n   */\n  TimePickerCtrl.prototype.handleInputEvent = function(self) {\n    var inputString = this.inputElement.value;\n      var arr = inputString.split(':');\n      if(arr.length < 2) {return;}\n      var h=Number(arr[0]);\n      var m=Number(arr[1]);\n      var newVal = new Date(this.time);\n      if (h && h>=0 && h<=23 && m && m>=0 && m<= 59 && angular.isDate(newVal)) {\n          newVal.setHours(h);\n          newVal.setMinutes(m);\n          this.ngModelCtrl.$setViewValue(newVal);\n          this.time = newVal;\n          this.inputContainer.classList.remove(INVALID_CLASS);\n      }\n      else {\n      // If there's an input string, it's an invalid time.\n      this.inputContainer.classList.toggle(INVALID_CLASS, inputString);\n    }\n  };\n\n  /** Position and attach the floating calendar to the document. */\n  TimePickerCtrl.prototype.attachTimePane = function() {\n    var timePane = this.timePane;\n    this.$element.addClass('sg-timepicker-open');\n\n    var elementRect = this.inputContainer.getBoundingClientRect();\n    var bodyRect = document.body.getBoundingClientRect();\n\n    timePane.style.left = (elementRect.left - bodyRect.left) + 'px';\n    timePane.style.top = (elementRect.top - bodyRect.top) + 'px';\n    document.body.appendChild(this.timePane);\n\n    // The top of the calendar pane is a transparent box that shows the text input underneath.\n    // Since the pane is flowing, though, the page underneath the pane *adjacent* to the input is\n    // also shown unless we cover it up. The inputMask does this by filling up the remaining space\n    // based on the width of the input.\n    this.inputMask.style.left = elementRect.width + 'px';\n\n    // Add CSS class after one frame to trigger open animation.\n    this.$$rAF(function() {\n      timePane.classList.add('md-pane-open');\n    });\n  };\n\n  /** Detach the floating time pane from the document. */\n  TimePickerCtrl.prototype.detachTimePane = function() {\n    this.$element.removeClass('sg-timepicker-open');\n    this.timePane.classList.remove('md-pane-open');\n\n    if (this.timePane.parentNode) {\n      // Use native DOM removal because we do not want any of the angular state of this element\n      // to be disposed.\n      this.timePane.parentNode.removeChild(this.timePane);\n    }\n  };\n\n  /**\n   * Open the floating time pane.\n   * @param {Event} event\n   */\n  TimePickerCtrl.prototype.openTimePane = function(event) {\n    if (!this.isTimeOpen && !this.isDisabled) {\n      this.isTimeOpen = true;\n      this.timePaneOpenedFrom = event.target;\n      this.attachTimePane();\n      this.focusTime();\n\n      // Because the time pane is attached directly to the body, it is possible that the\n      // rest of the component (input, etc) is in a different scrolling container, such as\n      // an md-content. This means that, if the container is scrolled, the pane would remain\n      // stationary. To remedy this, we disable scrolling while the time pane is open, which\n      // also matches the native behavior for things like `<select>` on Mac and Windows.\n      this.$mdUtil.disableScrollAround(this.timePane);\n\n      // Attach click listener inside of a timeout because, if this open call was triggered by a\n      // click, we don't want it to be immediately propogated up to the body and handled.\n      var self = this;\n      this.$mdUtil.nextTick(function() {\n        document.body.addEventListener('click', self.bodyClickHandler);\n      }, false);\n    }\n  };\n\n  /** Close the floating time pane. */\n  TimePickerCtrl.prototype.closeTimePane = function() {\n    this.isTimeOpen = false;\n    this.detachTimePane();\n    this.timePaneOpenedFrom.focus();\n    this.timePaneOpenedFrom = null;\n    this.$mdUtil.enableScrolling();\n\n    document.body.removeEventListener('click', this.bodyClickHandler);\n  };\n\n  /** Gets the controller instance for the time in the floating pane. */\n  TimePickerCtrl.prototype.getTimePaneCtrl = function() {\n    return angular.element(this.timePane.querySelector('sg-time-pane')).controller('sgTimePane');\n  };\n\n  /** Focus the time in the floating pane. */\n  TimePickerCtrl.prototype.focusTime = function() {\n    // Use a timeout in order to allow the time to be rendered, as it is gated behind an ng-if.\n    var self = this;\n    this.$mdUtil.nextTick(function() {\n        var ctrl = self.getTimePaneCtrl();\n      self.getTimePaneCtrl().focus(null, ctrl);\n    }, false);\n  };\n\n  /**\n   * Sets whether the input is currently focused.\n   * @param {boolean} isFocused\n   */\n  TimePickerCtrl.prototype.setFocused = function(isFocused) {\n    this.isFocused = isFocused;\n  };\n\n  /**\n   * Handles a click on the document body when the floating time pane is open.\n   * Closes the floating time pane if the click is not inside of it.\n   * @param {MouseEvent} event\n   */\n  TimePickerCtrl.prototype.handleBodyClick = function(event) {\n    if (this.isTimeOpen) {\n      // TODO(jelbourn): way want to also include the md-datepicker itself in this check.\n      var isInTime = this.$mdUtil.getClosest(event.target, 'sg-time-pane');\n      if (!isInTime) {\n        this.closeTimePane();\n      }\n\n      this.$scope.$digest();\n    }\n  };\n})();\n","/* -*- Mode: javascript; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n\n(function() {\n  'use strict';\n\n  /*\n   * sgToggleGrid - Convert the tiles of a grid to toggle buttons\n   * @memberof SOGo.Common\n   * @restrict attribute\n   * @param {object} sgToggleGrid - the model of the source objects\n   * @param {string} [sgToggleGridAttr] - the attribute that specifies if an object is enabled (toggled)\n   * @ngInject\n   * @example:\n\n    <md-grid-list md-cols=\"7\" md-row-height=\"1:1\"\n                  sg-toggle-grid=\"editor.event.repeat.days\"\n                  sg-toggle-grid-attr=\"day\">..</md-grid-list>\n  */\n  sgToggleGrid.$inject = ['$parse'];\n  function sgToggleGrid($parse) {\n    return {\n      restrict: 'A',\n      link: link\n    };\n\n    function link(scope, iElement, attrs, ctrl) {\n      var tiles = iElement.find('md-grid-tile'),\n          tile,\n          i,\n          modelDays,\n          modelAttr,\n          ensureInitRunsOnce,\n          toggleClass;\n\n      ensureInitRunsOnce = scope.$watch(function() {\n        // Parse attribute until it returns a valid object\n        return $parse(attrs.sgToggleGrid)(scope);\n      }, function(days) {\n        if (angular.isDefined(days)) {\n          var flattenedDays = days;\n          modelDays = days;\n          if (attrs.sgToggleGridAttr) {\n            modelAttr = attrs.sgToggleGridAttr;\n            flattenedDays = _.pluck(days, attrs.sgToggleGridAttr);\n          }\n          _.each(tiles, function(o) {\n            var tile = angular.element(o);\n            if (_.contains(flattenedDays, tile.attr('value'))) {\n              tile.addClass('sg-active');\n            }\n          });\n          ensureInitRunsOnce();\n        }\n      });\n\n      toggleClass = function() {\n          // Toggle class on click event and call toggle function\n          var tile = angular.element(this),\n              day = tile.attr('value');\n          tile.toggleClass('sg-active');\n          toggle(day);\n      };\n\n      for (i = 0; i < tiles.length; i++) {\n        tile = angular.element(tiles[i]);\n        tile.addClass('iconButton');\n        tile.find('figure').addClass('md-icon');\n        tile.on('click', toggleClass);\n      }\n\n      function toggle(day) {\n        var i = _.findIndex(modelDays, function(o) {\n          if (modelAttr)\n            return o[modelAttr] == day;\n          else\n            return o == day;\n        });\n        if (i < 0) {\n          if (modelAttr) {\n            var o = {};\n            o[modelAttr] = day;\n            modelDays.push(o);\n          }\n          else\n            modelDays.push(day);\n        }\n        else\n          modelDays.splice(i, 1);\n      }\n    }\n  }\n\n  angular\n    .module('SOGo.Common')\n    .directive('sgToggleGrid', sgToggleGrid);\n})();\n"]}